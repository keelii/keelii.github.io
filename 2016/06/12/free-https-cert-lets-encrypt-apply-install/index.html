<!DOCTYPE html>   
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>免费 Https 证书（Let&#39;s Encrypt）申请与配置</title>
    <meta name="description" content="__ you don&#39;t know yet">
    <meta name="keywords" content="">
    <meta name="author" content="keelii">
    <meta name="generator" content="Hugo 0.29" />

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://keelii.github.io/2016/06/12/free-https-cert-lets-encrypt-apply-install/">
    <link href="https://keelii.github.io/favicon.ico" rel="icon">
    <link href="https://keelii.github.io/atom.xml" rel="alternate" type="application/rss+xml" title="Something">

    
    <link href="//fonts.crazy4code.com/css?family=PT&#43;Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
    <link href="//fonts.crazy4code.com/css?family=PT&#43;Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
    <link href="/stylesheets/screen.css" rel="stylesheet" type="text/css">
    <link href="//cdn.bootcss.com/highlight.js/9.7.0/styles/solarized-dark.min.css" rel="stylesheet" type="text/css">

    <meta name="360-site-verification" content="97274d5ff16511caf615a565d3257ce8">
    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-79264835-1', 'auto');
    ga('send', 'pageview');
    </script>

</head>
<body>

<header role="banner">
    <hgroup>
        <h1><a href="https://keelii.github.io/">Something</a></h1>
        <h2>__ you don&#39;t know yet</h2>
    </hgroup>
</header>


<nav role="navigation">
    <ul class="subscription" data-subscription="rss">
        <li>
            
        </li>
    </ul>

    <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
            <input type="hidden" name="sitesearch" value="https://keelii.github.io/">
            <input class="search" type="text" name="q" results="0" placeholder="Search" />
        </fieldset>
    </form>

    <ul class="main-navigation">
        
        <li><a href="https://keelii.github.io/">Blog</a> </li>
        
        <li><a href="https://keelii.github.io/archives">Archives</a> </li>
        
        <li><a href="https://keelii.github.io/about">About</a> </li>
        
    </ul>
</nav>


<div id="main">
    <div id="content">
        <div>
            <article class="hentry" role="article">
                <header>
                    <h1 class="entry-title">免费 Https 证书（Let&#39;s Encrypt）申请与配置</h1>
                    <p class="meta">
                        <time class="entry-date" datetime="2016-06-12 18:04:47">
                            <span class="date">2016-6-12</span>
                            <span class="time">18:04 PM</span>
                        </time>
                    </p>
                </header>

                <div class="entry-content"><p>之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。
</p>

<h2 id="1-下载-certbot">1. 下载 certbot</h2>

<pre><code class="language-bash">git clone https://github.com/certbot/certbot
cd certbot
./certbot-auto --help
</code></pre>

<p>解压打开执行就会有相关提示</p>

<h2 id="2-生成免费证书">2. 生成免费证书</h2>

<pre><code class="language-bash">./certbot-auto certonly --webroot --agree-tos -v -t --email 邮箱地址 -w 网站根目录 -d 网站域名
./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root -d note.crazy4code.com
</code></pre>

<p><strong>注意</strong> 这里 默认会自动生成到 /<strong>网站根目录</strong>/.well-known/acme-challenge 文件夹，然后 shell 脚本会对应的访问 <strong>网站域名</strong>/.well-known/acme-challenge 是否存在来确定你对网站的所属权</p>

<p>比如：我的域名是 <strong>note.crazy4code.com</strong> 那我就得保证域名下面的 <strong>.well-known/acme-challenge/</strong> 目录是可访问的</p>

<p>如果返回正常就确认了你对这个网站的所有权，就能顺利生成，完成后这个目录会被清空</p>

<h2 id="3-获取证书">3. 获取证书</h2>

<p>如果上面的步骤正常 shell 脚本会展示如下信息：</p>

<pre><code>- Congratulations! Your certificate and chain have been saved at
/etc/letsencrypt/live/网站域名/fullchain.pem
...
</code></pre>

<h2 id="4-生成-dhparams">4. 生成 dhparams</h2>

<p>使用 openssl 工具生成 dhparams</p>

<pre><code class="language-bash">openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048
</code></pre>

<h2 id="5-配置-nginx">5. 配置 Nginx</h2>

<p>打开 nginx server 配置文件加入如下设置：</p>

<pre><code class="language-nginx">listen 443

ssl on;
ssl_certificate /etc/letsencrypt/live/网站域名/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/网站域名/privkey.pem;
ssl_dhparam /etc/ssl/certs/dhparams.pem;
ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers HIGH:!aNULL:!MD5;
</code></pre>

<p>然后重启 nginx 服务就可以了</p>

<h2 id="6-强制跳转-https">6. 强制跳转 https</h2>

<p>https 默认是监听 443 端口的，没开启 https 访问的话一般默认是 80 端口。如果你确定网站 80 端口上的站点都支持 https 的话加入下面的配件可以自动重定向到 https</p>

<pre><code class="language-nginx">server {
    listen 80;
    server_name your.domain.com;
    return 301 https://$server_name$request_uri;
}
</code></pre>

<h2 id="7-证书更新">7. 证书更新</h2>

<p>免费证书只有 90 天的有效期，到时需要手动更新 renew。刚好 Let&rsquo;s encrypt 旗下还有一个 <a href="https://letsmonitor.org/">Let&rsquo;s monitor</a> 免费服务，注册账号添加需要监控的域名，系统会在证书马上到期时发出提醒邮件，非常方便。收到邮件后去后台执行 renew 即可，如果提示成功就表示 renew 成功</p>

<pre><code class="language-bash">./certbot-auto renew
</code></pre></div>
                <footer>
                    <p class="meta">
                        <span class="byline author vcard">Posted</span>
                        
                        <span class="span">on</span>
                        <span class="categories">
                            
                            
                            <a class="category 0|1" href="https://keelii.github.io/categories/WebDev">WebDev</a>
                            
                        </span>
                        
                    </p>
                    <p class="meta">
                        <span class="span">Last modified •</span>
                        <time class="entry-date" datetime="2017-05-02 15:19:43">
                            <span class="date">2017-5-2</span>
                            <span class="time">15:19 PM</span>
                        </time>
                    </p>
                    <p class="meta">
                        
                        <span class="basic-alignment left">
                            &laquo; <a href="https://keelii.github.io/2016/06/11/javascript-throttle/" title="Previous Post: JavaScript 节流函数 throttle 详解">JavaScript 节流函数 throttle 详解</a>
                        </span>
                        

                        
                        <span class="basic-alignment right">
                            <a href="https://keelii.github.io/2016/06/13/awsome-window-vimrc/" title="Nextious Post: 可能是 Windows 下最漂亮的 Gvim 配置了">可能是 Windows 下最漂亮的 Gvim 配置了</a> &raquo;
                        </span>
                        
                    </p>
                </footer>
            </article>
            <section>
    <h1>Comments</h1>
    <div id="disqus_thread"></div>
    <script>
    (function() {
    var d = document, s = d.createElement('script');
    s.src = '//keelii-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


        </div>

        <aside class="sidebar">
    
        
<section id="side-toc" class="side-toc odd" style="width: 100%;">
    <h1>Table  of contents</h1>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-下载-certbot">1. 下载 certbot</a></li>
<li><a href="#2-生成免费证书">2. 生成免费证书</a></li>
<li><a href="#3-获取证书">3. 获取证书</a></li>
<li><a href="#4-生成-dhparams">4. 生成 dhparams</a></li>
<li><a href="#5-配置-nginx">5. 配置 Nginx</a></li>
<li><a href="#6-强制跳转-https">6. 强制跳转 https</a></li>
<li><a href="#7-证书更新">7. 证书更新</a></li>
</ul></li>
</ul>
</nav>
</section>



    
</aside>

    </div>
</div>

<footer role="contentinfo">
    <p>
        Copyright &copy; 2017 - keelii -
        <span class="credit">Powered by <a href="http://gohugo.io/">Hugo</a></span>,
        <span class="credit">Theme Copied from <a href="http://octopress.org/">Octopress</a></span>
    </p>
</footer>


<script src="//cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<script src="/javascripts/octopress.js"></script>



<script src="/javascripts/highlight.pack.js"></script>
<script src="/javascripts/post.js"></script>
<script>
if (typeof hljs !=="undefined") hljs.initHighlightingOnLoad()
</script>





<!--
# There are some hotkeys for better experience #

[s] for search input
[t] for scroll to top
[h] for prev article
[l] for next article
[j] for scroll page up 300px
[k] for scroll page down 300px
[G] for scroll page bottom
-->

</body>
</html>
