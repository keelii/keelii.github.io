<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>javascript on è‡¨æ± ä¸è¼Ÿ</title>
    <link>https://keelii.com/categories/javascript/</link>
    <description>Recent content in javascript on è‡¨æ± ä¸è¼Ÿ</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Wed, 03 Jul 2019 18:33:57 +0800</lastBuildDate>
    
        <atom:link href="https://keelii.com/categories/javascript/atom.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šæ§åˆ¶å™¨ï¼‰</title>
      <link>https://keelii.com/2019/07/03/nestjs-framework-tutorial-3/</link>
      <pubDate>Wed, 03 Jul 2019 18:33:57 +0800</pubDate>
      
      <guid>https://keelii.com/2019/07/03/nestjs-framework-tutorial-3/</guid>
      <description>

&lt;p&gt;&lt;strong&gt;æ§åˆ¶å™¨&lt;/strong&gt;ï¼ˆControllerï¼‰è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶å‘é€å“åº”å†…å®¹ï¼Œåœ¨ä¼ ç»Ÿçš„ MVC æ¶æ„ä¸­æ§åˆ¶å™¨å°±æ˜¯è´Ÿè´£å¤„ç†æŒ‡å®šè¯·æ±‚ä¸åº”ç”¨ç¨‹åºçš„å¯¹åº”å…³ç³»ï¼Œè·¯ç”±åˆ™å†³å®šå…·ä½“å¤„ç†å“ªä¸ªè¯·æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/06/30/5d18c461b3cb641859.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;è·¯ç”±&#34;&gt;è·¯ç”±&lt;/h3&gt;

&lt;p&gt;å¾—ç›Šäº TypeScriptï¼Œåœ¨ Nest ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»æ¥å®ç°æ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œä½¿ç”¨è£…é¥°å™¨æ¥å®ç°è·¯ç”±åŠŸèƒ½ã€‚å®ƒä»¬åˆ†åˆ«éœ€è¦é…åˆ @Controller å’Œ @Get é¥°å™¨æ¥ä½¿ç”¨ï¼Œå‰è€…æ˜¯æ§åˆ¶å™¨ç±»çš„è£…é¥°ï¼Œåè€…æ˜¯å…·ä½“æ–¹æ³•çš„è£…é¥°å™¨ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import { Controller, Get } from &#39;@nestjs/common&#39;;

@Controller(&#39;cats&#39;)
export class CatsController {
  @Get()
  findAll(): string {
    return &#39;This action returns all cats&#39;;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªçŒ«å’ªæ§åˆ¶å™¨ç±»ï¼Œå®ç°äº† findAll æ–¹æ³•ï¼Œå½“ä½ åœ¨æµè§ˆå™¨ä¸­å‘é€è¯·æ±‚åˆ° /cates æ—¶ç¨‹åºå°±è¿”å›ç»™ä½  This action returns all cats&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;++å°æç¤º++ï¼šå¯ä»¥ä½¿ç”¨ Nest-cli å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆä¸Šé¢çš„ä»£ç ï¼š$ nest g controller cats&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;@Get()&lt;/code&gt; è¡¨ç¤º HTTP è¯·æ±‚è£…é¥°å™¨ã€‚æ§åˆ¶å™¨ç±»çš„è£…é¥°å™¨å’Œ HTTP æ–¹æ³•çš„è£…é¥°å™¨å…±åŒå†³å®šäº†ä¸€ä¸ªè·¯ç”±è§„åˆ™ã€‚findAll å°†è¿”å›ä¸€ä¸ªçŠ¶æ€ç ä¸º 200 çš„å“åº”ï¼Œå½“ç„¶ä½ æœ‰ä¸¤ç§æ–¹æ³•æ¥æŒ‡å®šè¿”å›çš„çŠ¶æ€ç ï¼š&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ ‡å‡†æ¨¡å¼ï¼ˆå»ºè®®çš„ï¼‰&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨å†…ç½®æ–¹æ³•æ—¶ï¼Œå¦‚æœè¿”å›ä¸€ä¸ª JavaScript å¯¹è±¡æˆ–è€…æ•°æ®ï¼Œå°†è‡ªåŠ¨åºåˆ—åŒ–æˆ JSONï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²å°†é»˜è®¤ä¸ä¼šåºåˆ—åŒ–ï¼Œå“åº”çš„è¿”å›çŠ¶æ€ç  &lt;strong&gt;é»˜è®¤&lt;/strong&gt; æ€»æ˜¯ 200ï¼Œé™¤éæ˜¯ POST è¯·æ±‚ä¼šé»˜è®¤è®¾ç½®æˆ 201ã€‚å¯ä»¥ä½¿ç”¨ @HttpCode() è£…é¥°å™¨æ¥æ”¹å˜å®ƒ&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;æŒ‡å®šæ¡†æ¶&lt;/td&gt;
&lt;td&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡å®šæ¡†æ¶çš„è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œæ¯”å¦‚ Express çš„å“åº”å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ @Res() è£…é¥°å™¨æ¥è£…é¥°å“åº”å¯¹è±¡ä½¿ç”¨ï¼Œè¿™æ ·ä»¥æ¥ä½ å°±å¯ä»¥ä½¿ç”¨ç±» Express API çš„æ–¹å¼å¤„ç†å“åº”äº†ï¼š&lt;code&gt;response.status(200).send()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;++è­¦å‘Š++&lt;/strong&gt;ï¼šä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸Šé¢ä¸¤ç§æ–¹æ³•ï¼Œä½†æ˜¯ Nest ä¼šæ£€æµ‹åˆ°ï¼ŒåŒæ—¶æ ‡å‡†æ¨¡å¼ä¼šåœ¨è¿™ä¸ªè·¯ç”±ä¸Šè¢«ç¦ç”¨&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;è¯·æ±‚å¯¹è±¡&#34;&gt;è¯·æ±‚å¯¹è±¡&lt;/h3&gt;

&lt;p&gt;å¤„ç†å™¨ä¸€èˆ¬éœ€è¦è®¿é—®åˆ°è¯·æ±‚å¯¹è±¡ã€‚ä¸€èˆ¬é…åˆ @Req() è£…é¥°å™¨æ¥ä½¿ç”¨ï¼Œè¯·æ±‚å¯¹è±¡åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ã€å‚æ•°ã€HTTP å¤´ï¼Œè¯·æ±‚ä½“ç­‰ã€‚ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µåªç”¨åˆ°å…¶ä¸­æŸä¸ªï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬ä½¿ç”¨æŒ‡å®šçš„è£…é¥°å™¨æ¥è£…é¥°è¯·æ±‚ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è£…é¥°å™¨&lt;/th&gt;
&lt;th&gt;å‚æ•°å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Request()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Response()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;res&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Next()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;next&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Session()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req.session&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Param(key?: string)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req.params&lt;/code&gt; / &lt;code&gt;req.params[key]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Body(key?: string)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req.body&lt;/code&gt; / &lt;code&gt;req.body[key]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Query(key?: string)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req.query&lt;/code&gt; / &lt;code&gt;req.query[key]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Headers(name?: string)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;req.headers&lt;/code&gt; / &lt;code&gt;req.headers[name]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚æˆ‘ä»¬åªéœ€è¦å¤„ç†è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨ @Query æ¥è£…é¥°å…¥å‚ï¼Œè¿™æ ·å–åˆ°çš„å€¼å°±è‡ªç„¶æ˜¯ä¸€ä¸ª query string çš„å­—å…¸äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Get()
getHello(@Query() q: String): string {
    console.log(q)
    return this.appService.getHello();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬çš„è¯·æ±‚æ˜¯ï¼š&lt;a href=&#34;http://localhost:3000/?test=a&#34;&gt;http://localhost:3000/?test=a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæ§åˆ¶å°å°†æ‰“å°ä¸€ä¸ª &lt;code&gt;{ test: &#39;a&#39; }&lt;/code&gt; å­—å…¸&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;++å°æç¤º++&lt;/strong&gt;ï¼šå»ºè®®å®‰è£… @types/express åŒ…æ¥è·å– Request çš„ç›¸å…³ç±»å‹æç¤º&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;èµ„æº&#34;&gt;èµ„æº&lt;/h3&gt;

&lt;p&gt;é™¤äº†ä½¿ç”¨ @Get è£…é¥°å™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶å®ƒ HTTP æ–¹æ³•è£…é¥°å™¨ã€‚æ¯”å¦‚ï¼š&lt;code&gt;@Put()&lt;/code&gt;, &lt;code&gt;@Delete()&lt;/code&gt;, &lt;code&gt;@Patch()&lt;/code&gt;, &lt;code&gt;@Options()&lt;/code&gt;, &lt;code&gt;@Head()&lt;/code&gt;, and &lt;code&gt;@All()&lt;/code&gt;ï¼Œæ³¨æ„ All å¹¶ä¸æ˜¯ HTTP çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Nest æä¾›çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œè¡¨ç¤ºæ¥æ”¶ä»»ä½•ç±»å‹çš„ HTTP è¯·æ±‚ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è·¯ç”±é€šé…ç¬¦&#34;&gt;è·¯ç”±é€šé…ç¬¦&lt;/h3&gt;

&lt;p&gt;Nest æ”¯æŒåŸºäºæ¨¡å¼çš„è·¯ç”±è§„åˆ™åŒ¹é…ï¼Œæ¯”å¦‚ï¼šæ˜Ÿå·ï¼ˆ*ï¼‰è¡¨ç¤ºåŒ¹é…ä»»æ„çš„å­—æ¯ç»„åˆã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Get(&#39;ab*cd&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;&#39;ab*cd&#39;&lt;/code&gt; è·¯ç”±å°†åŒ¹é… &lt;code&gt;abcd&lt;/code&gt;, &lt;code&gt;ab_cd&lt;/code&gt;, &lt;code&gt;abecd&lt;/code&gt; ç­‰è§„åˆ™ã€‚åŒæ—¶ï¼š&lt;code&gt;?&lt;/code&gt;, &lt;code&gt;+&lt;/code&gt;, &lt;code&gt;*&lt;/code&gt;, and &lt;code&gt;()&lt;/code&gt; é€šé…ç¬¦ï¼ˆwildcardï¼‰éƒ½å¯ä»¥ä½¿ç”¨&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é€šé…ç¬¦&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;th&gt;åŒ¹é…&lt;/th&gt;
&lt;th&gt;ä¸åŒ¹é…&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Law*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Law&lt;/code&gt;, &lt;code&gt;Laws&lt;/code&gt;, or &lt;code&gt;Lawyer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;GrokLaw&lt;/code&gt;, &lt;code&gt;La&lt;/code&gt;, or &lt;code&gt;aw&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;*Law*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Law&lt;/code&gt;, &lt;code&gt;GrokLaw&lt;/code&gt;, or &lt;code&gt;Lawyer&lt;/code&gt;.&lt;/td&gt;
&lt;td&gt;&lt;code&gt;La&lt;/code&gt;, or &lt;code&gt;aw&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;?&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä»»æ„&lt;strong&gt;å•ä¸ª&lt;/strong&gt;å­—ç¬¦&lt;/td&gt;
&lt;td&gt;&lt;code&gt;?at&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Cat&lt;/code&gt;, &lt;code&gt;cat&lt;/code&gt;, &lt;code&gt;Bat&lt;/code&gt; or &lt;code&gt;bat&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;at&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[abc]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„&lt;strong&gt;ä¸€ä¸ª&lt;/strong&gt;å­—ç¬¦&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[CB]at&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Cat&lt;/code&gt; or &lt;code&gt;Bat&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;cat&lt;/code&gt; or &lt;code&gt;bat&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[a-z]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…å­—æ¯ã€æ•°å­—åŒºé—´&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Letter[0-9]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Letter0&lt;/code&gt;, &lt;code&gt;Letter1&lt;/code&gt;, &lt;code&gt;Letter2&lt;/code&gt; up to &lt;code&gt;Letter9&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Letters&lt;/code&gt;, &lt;code&gt;Letter&lt;/code&gt; or &lt;code&gt;Letter10&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;çŠ¶æ€ç &#34;&gt;çŠ¶æ€ç &lt;/h3&gt;

&lt;p&gt;å“åº”çš„é»˜è®¤çŠ¶æ€ç æ˜¯ 200ï¼ŒPOST åˆ™æ˜¯ 201ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨ &lt;code&gt;@HttpCode(204)&lt;/code&gt; æ¥æŒ‡å®š&lt;strong&gt;å¤„ç†å™¨&lt;/strong&gt;çº§åˆ«çš„ é»˜è®¤ HttpCode ä¸º 204&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Post()
@HttpCode(204)
create() {
  return &#39;This action adds a new cat&#39;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæƒ³åŠ¨æ€æŒ‡å®šçŠ¶æ€ç ï¼Œå°±è¦ä½¿ç”¨ @Res() è£…é¥°å™¨æ¥æ³¨å…¥å“åº”å¯¹è±¡ï¼ŒåŒæ—¶è°ƒç”¨å“åº”çš„çŠ¶æ€ç è®¾ç½®æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è¯·æ±‚å¤´&#34;&gt;è¯·æ±‚å¤´&lt;/h3&gt;

&lt;p&gt;åŒæ ·çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;@Header()&lt;/code&gt; æ¥è®¾ç½®è‡ªå®šä¹‰çš„è¯·æ±‚å¤´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;response.header()&lt;/code&gt; è®¾ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Post()
@Header(&#39;Cache-Control&#39;, &#39;none&#39;)
create() {
  return &#39;This action adds a new cat&#39;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;è·¯ç”±å‚æ•°&#34;&gt;è·¯ç”±å‚æ•°&lt;/h3&gt;

&lt;p&gt;é€šå¸¸æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€äº›åŠ¨æ€çš„è·¯ç”±æ¥æ¥æ”¶ä¸€äº›å®¢æˆ·ç«¯çš„æŸ¥è¯¢å‚æ•°ï¼Œé€šè¿‡æŒ‡å®šè·¯ç”±å‚æ•°å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ•è·åˆ° URL ä¸Šçš„åŠ¨æ€å‚æ•°åˆ°æ§åˆ¶å™¨ä¸­ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Get(&#39;:id&#39;)
findOne(@Param() params): string {
  console.log(params.id);
  return `This action returns a #${params.id} cat`;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šè¿‡ä½¿ç”¨ @Param() è£…é¥°å™¨å¯ä»¥åœ¨æ–¹æ³•ä¸­ç›´æ¥è®¿é—®åˆ°è·¯ç”±è£…é¥°å™¨ &lt;code&gt;@Get()&lt;/code&gt; ä¸­çš„çš„å‚æ•°å­—å…¸ï¼Œ:id å°±è¡¨ç¤ºåŒ¹é…åˆ°æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨ params.id åœ¨æ–¹æ³•ä¸­è®¿é—®åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;å½“ç„¶ï¼Œå°±åƒå‰é¢å­¦åˆ°çš„å‚æ•°è£…é¥°å™¨ä¹Ÿå¯ä»¥æŒ‡å®šåˆ°å…·ä½“çš„æŸä¸ªå‚æ•°å€¼ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Get(&#39;:id&#39;)
findOne(@Param(&#39;id&#39;) id): string {
  return `This action returns a #${id} cat`;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;è·¯ç”±é¡ºåº&#34;&gt;è·¯ç”±é¡ºåº&lt;/h3&gt;

&lt;p&gt;è·¯ç”±çš„æ³¨å†Œé¡ºåºä¸æ§åˆ¶å™¨ç±»ä¸­çš„&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;é¡ºåºç›¸å…³ï¼Œå¦‚æœä½ å…ˆè£…é¥°äº†ä¸€ä¸ª cats/:id çš„è·¯ç”±ï¼Œåé¢åˆè£…é¥°äº†ä¸€ä¸ª cats è·¯ç”±ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·è®¿é—®åˆ° GET /cats æ—¶ï¼Œåé¢çš„è·¯ç”±å°†ä¸ä¼šè¢«æ•è·ï¼Œå› ä¸ºå‚æ•°æ‰éƒ½æ˜¯&lt;strong&gt;éå¿…é€‰&lt;/strong&gt;çš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬äºŒç¯‡ï¼šå…¥é—¨ï¼‰</title>
      <link>https://keelii.com/2019/07/03/nestjs-framework-tutorial-2/</link>
      <pubDate>Wed, 03 Jul 2019 18:32:57 +0800</pubDate>
      
      <guid>https://keelii.com/2019/07/03/nestjs-framework-tutorial-2/</guid>
      <description>

&lt;p&gt;è¿™ç¯‡æ•™ç¨‹èµ·ï¼Œä½ å°†ä¼šå­¦ä¹ åˆ° Nest çš„å‡ ä¸ªæ ¸å¿ƒç‚¹ã€‚ä¸ºäº†æ›´å¥½çš„äº†è§£ Nest åº”ç”¨ä¸­çš„æ¨¡å—ï¼Œæˆ‘ä»¬å°†å¼€å‘ä¸€ä¸ªæœ‰åŸºæœ¬ CRUD&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:Create-Read-Upda&#34;&gt;&lt;a href=&#34;#fn:Create-Read-Upda&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; åŠŸèƒ½çš„å…¥é—¨çº§åº”ç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®ç°è¯­è¨€&#34;&gt;å®ç°è¯­è¨€&lt;/h2&gt;

&lt;p&gt;Nest æ˜¯ TypeScript å†™çš„ï¼Œæ‰€ä»¥å¤©ç”Ÿå°±å¾ˆå¥½çš„å¹¶ä¸”æ¸è¿›åœ°æ”¯æŒ JavaScriptã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¾èµ–&#34;&gt;ä¾èµ–&lt;/h2&gt;

&lt;p&gt;ä¿è¯ä½ çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…çš„ Node.js ç‰ˆæœ¬å¤§äº 8.9.0 å³å¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆå§‹åŒ–&#34;&gt;åˆå§‹åŒ–&lt;/h2&gt;

&lt;p&gt;å°±åƒä¸ŠèŠ‚è®²åˆ°çš„ç›´æ¥ç”¨ nest new project-name å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬æ¥å›é¡¾ä¸‹ç›®å½•ç»“æ„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;src
â”œâ”€â”€ app.controller.spec.ts
â”œâ”€â”€ app.controller.ts
â”œâ”€â”€ app.module.ts
â”œâ”€â”€ app.service.ts
â””â”€â”€ main.ts
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ†åˆ«å¯¹åº”çš„åŠŸèƒ½å¦‚ä¸‹è¡¨ï¼š&lt;/p&gt;

&lt;p&gt;| app.controller.ts | åªæœ‰ä¸€ä¸ªè·¯ç”±çš„æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰ç¤ºä¾‹ |
| app.module.ts | åº”ç”¨ç¨‹åºçš„æ ¹æ¨¡å—ï¼ˆroot moduleï¼‰ |
| main.ts | åº”ç”¨ç¨‹åºçš„å…¥å£æ–‡ä»¶ï¼Œä½¿ç”¨ &lt;code&gt;NestFactory&lt;/code&gt; æ–¹æ³•åˆ›å»ºåº”ç”¨å®ä¾‹ |
åœ¨ main.ts ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤ä½¿ç”¨äº† NestFactory çš„ create() é™æ€æ–¹æ³•è¿”å›åˆ›å»ºçš„åº”ç”¨å¯¹è±¡ï¼Œæ­¤å¯¹åº”ä¼šå®ç° INestApplication æ¥å£ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å¹³å°&#34;&gt;å¹³å°&lt;/h2&gt;

&lt;p&gt;Nest çš„ç›®æ ‡æ˜¯ä¸€ä¸ªå¹³å°æ— å…³çš„æ¡†æ¶ã€‚è¿™ä¸ªæ„æ€å°±æ˜¯è¯´ Nest æœ¬èº«å¹¶ä¸é€ æŸä¸ªç»†åˆ†é¢†åŸŸçš„è½®å­ï¼Œä»–åªæ„å»ºä¸€å¥—æ„æ¶ä½“ç³»ï¼Œç„¶åæŠŠä¸€äº›å¥½ç”¨çš„åº“æˆ–è€…å¹³å°èåˆè¿›æ¥ã€‚æ‰€ä»¥ Nest å¯ä»¥è¡”æ¥ä»»ä½• HTTP æ¡†æ¶ï¼Œé»˜è®¤æ”¯æŒ express å’Œ fastify ä¸¤ä¸ª web æ¡†æ¶ã€‚&lt;/p&gt;

&lt;p&gt;| &lt;code&gt;platform-express&lt;/code&gt; | &lt;strong&gt;&lt;a href=&#34;https://expressjs.com/&#34;&gt;Express&lt;/a&gt;&lt;/strong&gt; æ˜¯ä¸€ä¸ª Node web æ¡†æ¶ï¼Œæœ‰å¾ˆå¤šç¤¾åŒºæˆç†Ÿçš„èµ„æºã€‚@nestjs/platform-express é»˜è®¤ä¼šè¢«å¼•å…¥ï¼Œå¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œç”¨èµ·æ¥ä¼šå®¹æ˜“ä¸Šæ‰‹ |
| &lt;code&gt;platform-fastify&lt;/code&gt; | &lt;strong&gt;&lt;a href=&#34;https://www.fastify.io/&#34;&gt;Fastify&lt;/a&gt;&lt;/strong&gt; æ˜¯ä¸€ä¸ªé«˜èƒ½ä½è€—çš„æ¡†æ¶ï¼Œè‡´åŠ›äºæœ€å¤§åŒ–æ•ˆç‡ä¸é€Ÿåº¦ |
æ— è®ºä½¿ç”¨å“ªä¸ªå¹³å°ï¼Œéƒ½è¦æš´éœ²è‡ªå·±çš„åº”ç”¨æ¥å£ã€‚ä¸Šé¢ä¸¤ä¸ªå¹³å°æš´éœ²äº†å¯¹åº”çš„ä¸¤ä¸ªå˜é‡ &lt;code&gt;NestExpressApplication&lt;/code&gt; and &lt;code&gt;NestFastifyApplication&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹çš„ä»£ç ä¼šåˆ›å»ºä¸€ä¸ª app å¯¹è±¡ï¼Œå¹¶ä¸”æŒ‡å®šäº†ä½¿ç”¨ NestExpressApplication å¹³å°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;const app = await NestFactory.create&amp;lt;NestExpressApplication&amp;gt;(ApplicationModule);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦æŒ‡å®šè¿™ä¸ªç±»å‹ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:Create-Read-Upda&#34;&gt;Create, Read, Update, Delete é€šå¸¸å¯¹åº”äºæ•°æ®çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:Create-Read-Upda&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸€ç¯‡ï¼šç®€ä»‹ï¼‰</title>
      <link>https://keelii.com/2019/07/03/nestjs-framework-tutorial-1/</link>
      <pubDate>Wed, 03 Jul 2019 18:31:57 +0800</pubDate>
      
      <guid>https://keelii.com/2019/07/03/nestjs-framework-tutorial-1/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/06/30/5d185dfb87f5e21948.png&#34; alt=&#34;Nestjs&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ•™ç¨‹ç›®å½•&#34;&gt;æ•™ç¨‹ç›®å½•&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼šæœ¬æ•™ç¨‹ç»“åˆå®˜æ–¹æ–‡æ¡£å†…å®¹å¹¶æ·»åŠ äº†è®¸å¤šæˆ‘è‡ªå·±å­¦ä¹ è¿‡ç§ä¸­çš„ç†è§£ï¼Œå­˜åœ¨è®¸å¤šä¸ªäººè§‚ç‚¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸€ç¯‡ï¼š&lt;a href=&#34;nestjs-framework-tutorial-1&#34;&gt;ç®€ä»‹&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬äºŒç¯‡ï¼šå…¥é—¨ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šæ§åˆ¶å™¨ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬å››ç¯‡ï¼šProvidersï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬äº”ç¯‡ï¼šæ¨¡å—ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šä¸­é—´ä»¶ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šå¼‚å¸¸è¿‡æ»¤å™¨ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šç®¡é“ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šå®ˆå«ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šæ‹¦æˆªå™¨ï¼‰&lt;/li&gt;
&lt;li&gt;Nestjs æ¡†æ¶æ•™ç¨‹ï¼ˆç¬¬ä¸‰ç¯‡ï¼šè‡ªå®šä¹‰è£…é¥°å™¨ï¼‰&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;p&gt;Nest æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ Node.js æœåŠ¡ç«¯åº”ç”¨æ¡†æ¶ï¼ŒåŸºäº TypeScript ç¼–å†™å¹¶ä¸”ç»“åˆäº† OOP&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:Object-Oriented&#34;&gt;&lt;a href=&#34;#fn:Object-Oriented&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€FP&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:Functional-Progr&#34;&gt;&lt;a href=&#34;#fn:Functional-Progr&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€FRP&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:Functional-React&#34;&gt;&lt;a href=&#34;#fn:Functional-React&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; çš„ç›¸å…³ç†å¿µã€‚å¹¶ä¸”è®¾è®¡ä¸Šå¾ˆå¤šçµæ„Ÿæ¥è‡ªäº Angularã€‚&lt;/p&gt;

&lt;p&gt;Angular çš„å¾ˆå¤šæ¨¡å¼åˆæ¥è‡ªäº Java ä¸­çš„ Spring æ¡†æ¶ï¼Œä¾èµ–æ³¨å…¥ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ç­‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¤ä¸ºï¼š &lt;strong&gt;Nest æ˜¯ Node.js ç‰ˆçš„ Spring æ¡†æ¶&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æˆ–è®¸å¾ˆå¤šå‰ç«¯å·¥ç¨‹å¸ˆçœ‹åˆ°è¿™é‡Œå°±è‡ªåŠ¨åŠé€€äº†ï¼Œäº‹å®ä¸Šæˆ‘ä»¥å‰ä¹ŸæŒºè®¨åŒ Java çš„ï¼ˆç°åœ¨ä¹Ÿä¸æ€ä¹ˆå–œæ¬¢ï¼‰ï¼Œåæ¥ç”±äºå·¥ä½œåŸå› å­¦ä¹ åˆ°äº†ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†åæ‰å‘ç°è‡ªå·±çš„è®¤è¯†å¾ˆç‰‡é¢ã€‚ç°åœ¨ WEB åç«¯ä¸»æµçš„æŠ€æœ¯æ ˆéƒ½åŸºäº Spring æ¡†æ¶ï¼Œæ¡†æ¶å¿…ç„¶æ˜¯è§£å†³äº†å¾ˆå¤šå®é™…é—®é¢˜ï¼Œèƒ½å­¦ä¹ åˆ°å®ƒçš„æ€æƒ³æ¯”å®ƒè‡ªå·±çš„å‡ºèº«ã€æ´¾ç³»æ›´é‡è¦ã€‚åŒæ—¶å»ºè®®é‚£äº›æ²¡æœ‰å­¦ä¹ æˆ–è€…æ¥è§¦è¿‡ Java çš„å‰ç«¯å¯ä»¥äº†è§£ä¸€äº›ç›¸å…³æ¦‚å¿µï¼Œä¸è¦æ‹’ç»ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šä¸ºä½ æ‰“å¼€å¦ä¸€æ‰‡é—¨ã€‚&lt;/p&gt;

&lt;p&gt;å¯èƒ½åœ¨å¾ˆå¤šä¼ª FP çˆ±å¥½è€…æ¥çœ‹ OOP æ˜¯è‡ƒè‚¿æ— ç”¨çš„ä¸œè¥¿ã€‚ä½†æ˜¯ä»ä½¿ç”¨è§’åº¦è®²ï¼š&lt;strong&gt;FP å°è€Œç¾ï¼ŒOOP å¤§è€Œå…¨&lt;/strong&gt;ï¼Œå¦‚æœä¸å…³æ³¨åœºæ™¯å»è®¨è®ºå¥½åæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚è€Œä¸”äº‹å®ä¸Šè¿™ä¸¤è€…å®Œå…¨æ˜¯ä¸å†²çªçš„ï¼Œå¯ä»¥ç»“åˆå¾—éå¸¸å®Œç¾ã€‚ä¸è¦è¢«é‚£äº›æ‰€è°“çš„&lt;strong&gt;çº¯&lt;/strong&gt;å‡½æ•°ã€&lt;strong&gt;çº¯&lt;/strong&gt;é¡µé¢å¯¹è±¡çš„æ¦‚å¿µè¯¯å¯¼ï¼Œèƒ½å†™å‡ºçœŸæ­£çš„å¥½ä»£ç æ‰æ˜¯é‡è¦çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä»¥å‰åœ¨ä½¿ç”¨ Node.js å¼€å‘åç«¯åº”ç”¨æ—¶å¸¸å¸¸ä¸çŸ¥é“å¦‚ä½•è§„åˆ’ä»£ç å…³ç³»ï¼Œæä¸æ¸…æ¥šæ§åˆ¶å™¨ã€æœåŠ¡ã€æ¨¡å‹å’Œæ•°æ®çš„å…³ç³»ï¼Œæˆ–è€…æ˜¯ä½ æ‰“ç®—ä½¿ç”¨ Node.js æ„å»ºå¤§å‹åº”ç”¨ï¼Œé‚£å°±å»ºè®®ä½ äº†è§£ä¸€ä¸‹ Nestã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ¡†æ¶çš„å“²å­¦&#34;&gt;æ¡†æ¶çš„å“²å­¦&lt;/h3&gt;

&lt;p&gt;åœ¨å¼€å§‹ä½“éªŒå‰ï¼Œæœ‰å¿…è¦ç®€å•ä»‹ç»ä¸‹ Nest æ¡†æ¶çš„çš„è®¾è®¡ç†å¿µï¼Œæˆ‘ç»“åˆæˆ‘è‡ªå·±çš„ç†è§£å¤§æ¦‚æ¢³ç†ä¸‹ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿‘å‡ å¹´ç”±äº Node.js çš„å‡ºç°ï¼ŒJavaScript æˆä¸ºäº†å‰ç«¯å’Œåç«¯çš„ã€Œlingua franca&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:-&#34;&gt;&lt;a href=&#34;#fn:-&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€ï¼Œå‰ç«¯æ–¹é¢å‡ºç°äº† Angular, React, Vue ç­‰ä¼—å¤šçš„ UI æ¡†æ¶ï¼Œåç«¯æ–¹é¢ä¹Ÿæœ‰åƒ Express, Koa è¿™æ ·ä¼˜ç§€çš„æ¡†æ¶å‡ºç°ï¼Œä½†è¿™äº›æ¡†æ¶éƒ½æ²¡æœ‰é«˜æ•ˆåœ°è§£å†³ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ â€” &lt;strong&gt;æ¶æ„&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å®˜æ–¹çš„è¿™æ®µä»‹ç»å’Œæˆ‘çœ‹åˆ°çš„éå¸¸ä¸€è‡´ï¼Œæ³¨æ„ä½œè€…è¯´æ˜¯&lt;strong&gt;é«˜æ•ˆåœ°&lt;/strong&gt;è§£å†³ï¼Œæˆ‘çš„ç†è§£æ˜¯ç°åœ¨ Node.js æˆ–è€…è¯´ JavaScript æ¡†æ¶éƒ½æ˜¯å„åšå„çš„ï¼Œéƒ½æ˜¯äº›ç‚¹ï¼Œå¯èƒ½ç¡®å®æœ‰åšçš„å¾ˆä¸é”™çš„ï¼Œä½†æ˜¯æ•´ä½“è€Œè¨€å¹¶æ²¡æœ‰ä¸€ä¸ªæŠŠå„ç§å¥½ä¸œè¥¿ä¸²é“¾èµ·æ¥åšæˆä¸€ç§é€šç”¨æ¨¡å¼çš„æ¡†æ¶ï¼Œæˆ–è€…è¯´æ˜¯æ¶æ„ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªé—®é¢˜ä¸»è¦æœ‰ä¸‰æ–¹é¢åŸå› ï¼šå…¶ä¸€ï¼Œç°åœ¨å¤§å¤šå‰ç«¯å·¥ç¨‹å¸ˆçš„å·¥ä½œèŒƒå›´è¿˜æ˜¯å±€é™äºå‰ç«¯ UI å±‚ï¼Œæˆ–è€…è¯´è§†å›¾å±‚ï¼Œåç«¯ä¸€èˆ¬éƒ½ç”±æ›´åŠ æˆç†Ÿçš„ä¸€æŠ€æœ¯æ ˆæ¥å®ç°ï¼›å…¶äºŒï¼ŒNode.js è¯ç”Ÿäº 2009 å¹´ï¼Œç›¸æ¯”äº 2002 å°±å‘ç¬¬ä¸€ç‰ˆçš„ Spring å·®çš„å¾ˆè¿œï¼›å…¶ä¸‰ï¼ŒNode.js å®é™…ä¸Šå°±æ˜¯ JavaScriptï¼Œè¿™é—¨è¯­è¨€æœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šç¼ºé™·ï¼Œä»¥è‡³äºæ— æ³•èƒœä»»å¤§å‹åº”ç”¨çš„æ¶æ„åœºæ™¯ã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶æœ‰è¿™äº›é—®é¢˜ä½†æ˜¯æˆ‘å§‹ç»ˆè®¤ä¸º Nest æ˜¯ä¸ªå¾ˆå¥½çš„å¼€ç«¯ï¼Œæˆ–è€…è¯´å¯¹äºæ‰€è°“çš„ã€Œå…¨æ ˆã€å·¥ç¨‹å¸ˆæ¥è®²æ˜¯ä¸ªå¥½äº‹ã€‚å› ä¸ºæˆ‘è®¤ä¸ºåœ¨å¤§å‹é¡¹ç›®ä¸­æ„æ¶å±‚é¢çš„å¤ç”¨æ¯”ä»£ç å±‚é¢çš„å¤ç”¨æ›´é‡è¦ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;

&lt;p&gt;å®‰è£… Nest æœ€æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨å®ƒé¢å¤–æä¾›çš„ä¸€ä¸ª CLI å·¥å…·ï¼ˆéœ€è¦å®‰è£… Node.js &amp;gt; 8.9 ç‰ˆæœ¬ï¼‰ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®ƒå¯ä»¥å¸®ä½ è‡ªå·±ç”Ÿæˆé¡¹ç›®çš„ç›®å½•ç»“æ„å’Œé¢„å®šä¹‰çš„æœ€å°æ¨¡å—ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;npm i -g @nestjs/cli
nest new project-name
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œåå‘½ä»¤è¡Œå¯ä»¥çœ‹è§å®ƒè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;âœ  github.com nest new project-name
âš¡  We will scaffold your app in a few seconds..

CREATE /project-name/.prettierrc (51 bytes)
CREATE /project-name/README.md (3370 bytes)
CREATE /project-name/nest-cli.json (84 bytes)
CREATE /project-name/nodemon-debug.json (163 bytes)
CREATE /project-name/nodemon.json (67 bytes)
CREATE /project-name/package.json (1808 bytes)
CREATE /project-name/tsconfig.build.json (97 bytes)
CREATE /project-name/tsconfig.json (325 bytes)
CREATE /project-name/tslint.json (426 bytes)
CREATE /project-name/src/app.controller.spec.ts (617 bytes)
CREATE /project-name/src/app.controller.ts (274 bytes)
CREATE /project-name/src/app.module.ts (249 bytes)
CREATE /project-name/src/app.service.ts (142 bytes)
CREATE /project-name/src/main.ts (208 bytes)
CREATE /project-name/test/app.e2e-spec.ts (561 bytes)
CREATE /project-name/test/jest-e2e.json (183 bytes)

? Which package manager would you â¤ï¸  to use? yarn
â–¹â–¸â–¹â–¹â–¹ Installation in progress... â˜•
ğŸš€  Successfully created project project-name
ğŸ‘‰  Get started with the following commands:

$ cd project-name
$ yarn run start
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ—¶å¯ä»¥æŒ‰æç¤ºï¼Œè¿›å…¥åˆ° &lt;code&gt;project-name&lt;/code&gt; è¿è¡Œé¡¹ç›®ã€‚å¦‚æœçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºå°±è¡¨ç¤ºæˆåŠŸäº†ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;âœ  github.com cd project-name
âœ  project-name git:(master) âœ— yarn run start
yarn run v1.10.1
$ ts-node -r tsconfig-paths/register src/main.ts
[Nest] 26470   - 2019/06/30 ä¸‹åˆ8:58   [NestFactory] Starting Nest application...
[Nest] 26470   - 2019/06/30 ä¸‹åˆ8:58   [InstanceLoader] AppModule dependencies initialized +11ms
[Nest] 26470   - 2019/06/30 ä¸‹åˆ8:58   [RoutesResolver] AppController {/}: +5ms
[Nest] 26470   - 2019/06/30 ä¸‹åˆ8:58   [RouterExplorer] Mapped {/, GET} route +3ms
[Nest] 26470   - 2019/06/30 ä¸‹åˆ8:58   [NestApplication] Nest application successfully started +3ms
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åæˆ‘ä»¬è®¿é—® &lt;code&gt;http://localhost:3000&lt;/code&gt; å°±å¯ä»¥çœ‹åˆ° &lt;code&gt;Hello World!&lt;/code&gt; äº†ã€‚ç”¨ç¼–è¾‘å™¨æ‰“å¼€ç›®å½•ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/06/30/5d18b3033825c45837.png&#34; alt=&#34;nestjs init&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶è¿˜æ˜¯æŒºå¤šçš„ï¼Œæˆ‘ä»¬ç°åœ¨æš‚ä¸ç”¨å…³æ³¨è¿™äº›ï¼Œåªéœ€è¦çŸ¥é“å¤§æ¦‚æ˜¯åšä»€ä¹ˆçš„å°±è¡Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;ä»ä¸Šé¢çš„å‘½ä»¤è¡Œä¸­å¯ä»¥çœ‹å‡ºæ¥æ•´ä¸ªé¡¹ç›®æ˜¯ç”¨ ts-node è·‘èµ·æ¥çš„ï¼Œè¿™æ ·çš„ç›®çš„å°±æ˜¯åœ¨å¼€å‘ç¯å¢ƒèŠ‚å»äº†ç¼–è¯‘ .ts çš„è¿‡ç¨‹ï¼ˆå®é™…ä¸Šæ˜¯ ts-node åœ¨èƒŒååšäº†è¿™ä¸ªäº‹æƒ…ï¼‰ã€‚æˆ‘ä»¬åªéœ€è¦å…³æ³¨ &lt;code&gt;src/main.ts&lt;/code&gt; è¿™ä¸ªå…¥å£æ–‡ä»¶å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ª main.ts æ–‡ä»¶å°± 8 è¡Œä»£ç ï¼Œä½¿ç”¨ Nest çš„å·¥å‚å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œå¹¶ä¸”ç›‘å¬ 3000 ç«¯å£ã€‚æ³¨æ„ï¼ŒNest é»˜è®¤ä¼šä½¿ç”¨ ES çš„ async/await è¯­æ³•ï¼Œæ‰€ä»¥ä½ å†ä¹Ÿä¸ç”¨æ€•åµŒå¥—å›è°ƒå‡½æ•°äº†ï¼Œä»¥åŒæ­¥çš„ç¼–ç æ–¹å¼è·å–å¼‚æ­¥çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:Object-Oriented&#34;&gt;Object Oriented Programming &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:Object-Oriented&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:Functional-Progr&#34;&gt;Functional Programming &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:Functional-Progr&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:Functional-React&#34;&gt;Functional Reactive Programming &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:Functional-React&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:-&#34;&gt;ä¸€ç§æœ¯è¯­ï¼Œè¡¨ç¤ºé€šç”¨è¯­è¨€ &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:-&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>ProseMirror ç¼–è¾‘å™¨æŒ‡å—ä¸­æ–‡ç¿»è¯‘ç‰ˆ</title>
      <link>https://keelii.com/2018/12/09/prosemirror-guide-cn/</link>
      <pubDate>Sun, 09 Dec 2018 17:59:45 +0800</pubDate>
      
      <guid>https://keelii.com/2018/12/09/prosemirror-guide-cn/</guid>
      <description>

&lt;p&gt;è¿™ä¸ªæŒ‡å—ä»‹ç»äº†å¾ˆå¤šç¼–è¾‘å™¨çš„è®¾è®¡ç†å¿µï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚æƒ³å®Œæ•´çš„äº†è§£æ•´ä¸ªç³»ç»Ÿï¼Œå»ºè®®æŒ‰é¡ºåºé˜…è¯»ï¼Œæˆ–è€…è‡³å°‘é˜…è¯»è§†å›¾ç»„ä»¶éƒ¨åˆ†&lt;/p&gt;

&lt;h2 id=&#34;ç®€ä»‹-introduction&#34;&gt;ç®€ä»‹ Introduction&lt;/h2&gt;

&lt;p&gt;ProseMirror æä¾›äº†ä¸€ç»„å·¥å…·å’Œè®¾è®¡æ¦‚å¿µç”¨æ¥æ„å»ºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒUI çš„ä½¿ç”¨æºäº WYSIWYG çš„ä¸€äº›çµæ„Ÿï¼ŒProseMirror è¯•ç€å±è”½ä¸€äº›æ’ç‰ˆä¸­çš„ç—›ç‚¹&lt;/p&gt;

&lt;p&gt;ProseMirror çš„ä¸»è¦åŸåˆ™æ˜¯ï¼š*ä½ çš„ä»£ç å¯¹äº &lt;strong&gt;æ–‡æ¡£&lt;/strong&gt; åŠå…¶äº‹ä»¶å˜æ›´æœ‰å®Œæ•´çš„æ§åˆ¶æƒ*ã€‚è¿™ä¸ªÂ &lt;strong&gt;æ–‡æ¡£&lt;/strong&gt;Â å¹¶ä¸æ˜¯åŸç”Ÿçš„ HTML æ–‡æ¡£ï¼Œè€Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„åŒ…å«äº†é€šè¿‡ä½ æ˜ç¡®å…è®¸åº”è¯¥è¢«åŒ…å«çš„å…ƒç´ ï¼Œå®ƒä»¬çš„å…³ç³»ä¹Ÿç”±ä½ æŒ‡å®šã€‚æ‰€æœ‰çš„æ›´æ–°éƒ½ä¼šåœ¨ä¸€ä¸ªä½ å¯ä»¥æŸ¥çœ‹å¹¶åšå‡ºå“åº”çš„åœ°æ–¹è¿›è¡Œ&lt;/p&gt;

&lt;p&gt;æ ¸å¿ƒçš„ä»£ç åº“å¹¶ä¸æ˜¯ä¸€ä¸ªå®¹æ˜“æ‹¿æ¥å°±ç”¨çš„ç»„åˆ â€” æˆ‘ä»¬ä¼šä¼˜å…ˆè€ƒè™‘Â &lt;strong&gt;æ¨¡å—åŒ–&lt;/strong&gt;Â å’Œ &lt;strong&gt;å¯è‡ªå®šä¹‰&lt;/strong&gt;Â åŒ–èƒœè¿‡ç®€å•åŒ–ï¼Œå¸Œæœ›å°†æ¥æœ‰ç”¨æˆ·ä¼šåŸºäº ProseMirror åˆ†å‘ä¸€ä¸ªæ‹¿æ¥å°±ç”¨çš„ç‰ˆæœ¬ã€‚å› æ­¤ï¼ŒProseMirror æ›´åƒæ˜¯ä¹é«˜ç§¯æœ¨è€Œä¸æ˜¯ç«æŸ´ç›’æ‹¼æˆçš„ç©å…·è½¦&lt;/p&gt;

&lt;p&gt;æ€»å…±æœ‰å››ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œä»»ä½•ç¼–è¾‘è¡Œä¸ºéƒ½éœ€è¦ç”¨åˆ°å®ƒä»¬ï¼Œè¿˜æœ‰å¾ˆå¤šæ ¸å¿ƒå›¢é˜Ÿç»´æŠ¤çš„æ‰©å±•æ¨¡å—ï¼Œç±»ä¼¼äºä¸‰æ–¹æ¨¡å— â€” å®ƒä»¬æä¾›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä½ å¯ä»¥åˆ é™¤æˆ–è€…æ›¿æ¢æˆå…¶å®ƒå®ç°äº†ç›¸åŒåŠŸèƒ½çš„æ¨¡å—&lt;/p&gt;

&lt;p&gt;æ ¸å¿ƒæ¨¡å—åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;prosemirror-model&lt;/code&gt; å®šä¹‰äº†ç¼–è¾‘å™¨çš„æ–‡æ¡£æ¨¡å‹ï¼Œæ•°æ®ç»“æ„ç”¨æ¥æè¿°ç¼–è¾‘å™¨çš„å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prosemirror-state&lt;/code&gt; æä¾›äº†æ•´ä¸ªç¼–è¾‘å™¨çŠ¶æ€çš„æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬é€‰åŒºå’Œç»´æŠ¤çŠ¶æ€å˜åŒ–çš„äº‹åŠ¡ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prosemirror-view&lt;/code&gt; å®ç°ä¸€ä¸ªç”¨æˆ·ç•Œé¢ç»„ä»¶ï¼Œç”¨æ¥åœ¨æµè§ˆå™¨ä¸­æŠŠç¼–è¾‘å™¨çš„çŠ¶æ€å±•ç¤ºæˆå¯ç¼–è¾‘å…ƒç´ ï¼Œå¹¶ä¸”ä¸å…¶è¿›è¡Œäº¤äº’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prosemirror-transform&lt;/code&gt; åŒ…å«äº†ä¸€ç§å¯ä»¥è®°å½•/é‡æ”¾æ–‡æ¡£ä¿®æ”¹å†å²çš„åŠŸèƒ½ç»„ä»¶ï¼Œè¿™æ˜¯ &lt;code&gt;state&lt;/code&gt;Â æ¨¡å—ä¸­äº‹åŠ¡çš„åŸºç¡€ï¼Œè€Œä¸”è¿™è¿˜ä½¿å¾—ç¼–è¾‘å™¨çš„æ¢å¤å†å²å’Œåä½œç¼–è¾‘åŠŸèƒ½æˆä¸ºå¯èƒ½&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›è¯¸å¦‚ åŸºç¡€çš„ç¼–è¾‘å‘½ä»¤ã€å¿«æ·é”®ç»‘å®šã€æ¢å¤å†å²ã€è¾“å…¥å®ã€åä½œç¼–è¾‘ï¼Œç®€å•çš„æ–‡æ¡£éª¨æ¶ çš„æ¨¡å—ã€‚&lt;a href=&#34;https://github.com/prosemirror/&#34; title=&#34;Prosemirror org&#34;&gt;Github prosemirror ç»„ç»‡&lt;/a&gt; ä»£ç åº“ä¸­è¿˜æœ‰æ›´å¤š&lt;/p&gt;

&lt;p&gt;äº‹å®ä¸ŠÂ ProseMirror å¹¶æ²¡æœ‰åˆ†å‘ä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆå™¨å¯ä»¥åŠ è½½çš„è„šæœ¬ï¼Œè¿™è¡¨ç¤ºä½ å¯èƒ½éœ€è¦ä¸€äº›æ¨¡å— bunder æ¥é…åˆä½¿ç”¨å®ƒã€‚æ¨¡å— Bunder å°±æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥è‡ªåŠ¨åŒ–æŸ¥æ‰¾ä½ çš„è„šæœ¬ä¾èµ–ï¼Œç„¶ååˆå¹¶åˆ°ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ï¼Œä½¿ä½ èƒ½å¾ˆå®¹æ˜“çš„åœ¨ web é¢é¡µä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥é˜…è¯»æ›´å¤šå…³äºÂ bundling çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š&lt;a href=&#34;https://medium.freecodecamp.org/javascript-modules-part-2-module-bundling-5020383cf306&#34; title=&#34;JavaScript Modules Part 2: Module Bundling&#34;&gt;è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;æˆ‘çš„ç¬¬ä¸€ä¸ªç¼–è¾‘å™¨-my-first-editor&#34;&gt;æˆ‘çš„ç¬¬ä¸€ä¸ªç¼–è¾‘å™¨ My first editor&lt;/h3&gt;

&lt;p&gt;å°±åƒæ‹¼ä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼Œä¸‹é¢çš„ä»£ç å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ€å°åŒ–çš„ç¼–è¾‘å™¨ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;import {schema} from &amp;quot;prosemirror-schema-basic&amp;quot;
import {EditorState} from &amp;quot;prosemirror-state&amp;quot;
import {EditorView} from &amp;quot;prosemirror-view&amp;quot;

let state = EditorState.create({schema})
let view = new EditorView(document.body, {state})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ProseMirror éœ€è¦ä½ ä¸ºæ–‡æ¡£æŒ‡å®šä¸€ä¸ªè‡ªå·±è§‰å¾—åˆé€‚çš„éª¨æ¶ï¼ˆschemaï¼‰ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å¼•å…¥ä¸€ä¸ªåŸºç¡€éª¨æ¶æ¨¡å—&lt;/p&gt;

&lt;p&gt;æ¥ç€è¿™ä¸ªéª¨æ¶è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªçŠ¶æ€ï¼Œå®ƒå°†æŒ‰éª¨æ¶çš„å®šä¹‰ç”Ÿæˆä¸€ä¸ªç©ºçš„æ–‡æ¡£ï¼Œå…‰æ ‡ä¼šåœ¨æ–‡æ¡£æœ€å¼€å§‹çš„åœ°æ–¹ã€‚æœ€ååˆ›å»ºäº†ä¸€ä¸ªä¸çŠ¶æ€å…³è”çš„è§†å›¾ï¼Œå¹¶ä¸”æ’å…¥åˆ° &lt;code&gt;document.body&lt;/code&gt;ã€‚è¿™å°†ä¼šæŠŠçŠ¶æ€çš„æ–‡æ¡£æ¸²æŸ“æˆä¸€ä¸ªå¯ç¼–è¾‘çš„ DOM èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸€æ—¦ç”¨æˆ·è¾“å…¥å†…å®¹å°±ä¼šç”Ÿæˆä¸€ä¸ªçŠ¶æ€äº‹åŠ¡ï¼ˆtransactionsï¼‰&lt;/p&gt;

&lt;p&gt;ç°åœ¨è¿™ä¸ªç¼–è¾‘å™¨è¿˜æ²¡ä»€ä¹ˆç”¨å¤„ã€‚æ¯”å¦‚è¯´å½“ä½ æŒ‰ä¸‹å›è½¦é”®æ—¶æ²¡æœ‰ä»»ä½•ååº”ï¼Œå› ä¸ºæ ¸å¿ƒåº“å¹¶ä¸å…³å¿ƒå›è½¦é”®åº”è¯¥ç”¨æ¥åšä»€ä¹ˆã€‚æˆ‘ä»¬é©¬ä¸Šå°±ä¼šè°ˆåˆ°è¿™ä¸€ç‚¹&lt;/p&gt;

&lt;h3 id=&#34;äº‹åŠ¡-transactions&#34;&gt;äº‹åŠ¡ Transactions&lt;/h3&gt;

&lt;p&gt;å½“ç”¨æˆ·è¾“å…¥æˆ–è€…ä¸è§†å›¾äº¤äº’æ—¶ï¼Œå°†ä¼šç”Ÿæˆã€ŒçŠ¶æ€äº‹åŠ¡ã€ã€‚è¿™æ„å‘³ç€å®ƒä¸ä»…ä»…æ˜¯åªä¿®æ”¹æ–‡æ¡£å¹¶ä»¥è¿™ç§æ–¹å¼éšå¼æ›´æ–°å…¶çŠ¶æ€ã€‚ç›¸åï¼Œæ¯æ¬¡æ›´æ”¹éƒ½ä¼šè§¦å‘ä¸€ä¸ªäº‹åŠ¡çš„åˆ›å»ºï¼Œè¯¥äº‹åŠ¡æè¿°å¯¹çŠ¶æ€æ‰€åšçš„æ›´æ”¹ï¼Œè€Œä¸”å®ƒå¯ä»¥è¢«åº”ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çŠ¶æ€ï¼Œéšåç”¨è¿™ä¸ªæ–°çŠ¶æ€æ¥æ›´æ–°è§†å›¾&lt;/p&gt;

&lt;p&gt;è¿™äº›è¿‡ç¨‹éƒ½ä¼šé»˜è®¤åœ°åœ¨åå°å¤„ç†ï¼Œä½†æ˜¯ä½ å¯ä»¥å†™ä¸€ä¸ªæ’ä»¶æ¥æŒ‚è½½è¿›å»ï¼Œæˆ–è€…é€šè¿‡é…ç½®è§†å›¾çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ·»åŠ äº†ä¸€ä¸ª &lt;code&gt;dispatchTransaction&lt;/code&gt;Â å±æ€§ï¼ˆpropsï¼‰ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ—¶éƒ½ä¼šè°ƒç”¨å®ƒ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;// (çœç•¥äº†å¯¼å…¥ä»£ç åº“)

let state = EditorState.create({schema})
let view = new EditorView(document.body, {
  state,
  dispatchTransaction(transaction) {
    console.log(&amp;quot;Document size went from&amp;quot;, transaction.before.content.size,
                &amp;quot;to&amp;quot;, transaction.doc.content.size)
    let newState = view.state.apply(transaction)
    view.updateState(newState)
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¯æ¬¡çŠ¶æ€å˜åŒ–éƒ½ä¼šç»è¿‡ &lt;code&gt;updateState&lt;/code&gt;ï¼Œè€Œä¸”æ¯ä¸ªæ™®é€šçš„ç¼–è¾‘æ›´æ–°éƒ½å°†é€šè¿‡è°ƒåº¦ä¸€ä¸ªäº‹åŠ¡æ¥è§¦å‘&lt;/p&gt;

&lt;h3 id=&#34;æ’ä»¶-plugins&#34;&gt;æ’ä»¶ Plugins&lt;/h3&gt;

&lt;p&gt;æ’ä»¶ç”¨äºä»¥å„ç§æ–¹å¼æ‰©å±•ç¼–è¾‘å™¨å’Œç¼–è¾‘å™¨çŠ¶æ€çš„çŠ¶æ€ï¼Œæœ‰çš„ä¼šéå¸¸ç®€å•ï¼Œæ¯”å¦‚ å¿«æ·é”® æ’ä»¶ â€” ä¸ºé”®ç›˜è¾“å…¥ç»‘å®šå…·ä½“åŠ¨ä½œï¼›æœ‰çš„ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚ ç¼–è¾‘å†å² æ’ä»¶ â€” é€šè¿‡è§‚å¯Ÿäº‹åŠ¡å¹¶é€†åºå­˜å‚¨æ¥å®ç°æ’¤é”€å†å²è®°å½•ï¼Œä»¥é˜²ç”¨æˆ·æƒ³è¦æ’¤æ¶ˆå®ƒä»¬&lt;/p&gt;

&lt;p&gt;è®©æˆ‘ä»¬ä¸ºç¼–è¾‘å™¨æ·»åŠ è¿™ä¸¤ä¸ªæ’ä»¶æ¥è·å–æ’¤æ¶ˆï¼ˆundoï¼‰/é‡åšï¼ˆredoï¼‰çš„åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;// (Omitted repeated imports)
import {undo, redo, history} from &amp;quot;prosemirror-history&amp;quot;
import {keymap} from &amp;quot;prosemirror-keymap&amp;quot;

let state = EditorState.create({
  schema,
  plugins: [
    history(),
    keymap({&amp;quot;Mod-z&amp;quot;: undo, &amp;quot;Mod-y&amp;quot;: redo})
  ]
})
let view = new EditorView(document.body, {state})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“åˆ›å»ºä¸€ä¸ªçŠ¶æ€çš„æ—¶å€™æ’ä»¶å°±ä¼šè¢«æ³¨å†Œï¼ˆå› ä¸ºæ’ä»¶éœ€è¦è®¿é—®çŠ¶æ€äº‹åŠ¡ï¼‰ï¼Œå½“è¿™ä¸ªå¼€å¯äº†ç¼–è¾‘å†å²çŠ¶æ€çš„è§†å›¾è¢«åˆ›å»ºæ—¶ï¼Œä½ å°†å¯ä»¥é€šè¿‡æŒ‰ &lt;code&gt;Ctrl-Z&lt;/code&gt;Â æˆ–è€… &lt;code&gt;Cmd-Z&lt;/code&gt;Â æ¥æ’¤æ¶ˆæœ€è¿‘çš„ä¸€æ¬¡å˜æ›´&lt;/p&gt;

&lt;h3 id=&#34;å‘½ä»¤-commands&#34;&gt;å‘½ä»¤ Commands&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­çš„ &lt;code&gt;undo&lt;/code&gt;Â å’Œ &lt;code&gt;redo&lt;/code&gt;Â å˜é‡å€¼æ˜¯ç»‘å®šåˆ°æŒ‡å®šé”®ä½çš„ä¸€ç§å«åš *å‘½ä»¤*Â çš„ç‰¹æ®Šå€¼ã€‚å¤§å¤šæ•°ç¼–è¾‘åŠ¨ä½œéƒ½æ˜¯ä½œä¸ºå¯ç»‘å®šåˆ°é”®çš„å‘½ä»¤ç¼–å†™çš„ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŒ‚è½½åˆ°èœå•æ ï¼Œæˆ–è€…ç›´æ¥æš´éœ²ç»™ç”¨æˆ·&lt;/p&gt;

&lt;p&gt;&lt;code&gt;prosemirror-commands&lt;/code&gt; åŒ…æä¾›äº†è®¸å¤šåŸºæœ¬çš„ç¼–è¾‘å‘½ä»¤ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ä½ å¯ä»¥éœ€è¦ç”¨åˆ°çš„åŸºæœ¬çš„å¿«æ·é”®ï¼Œæ¯”å¦‚ å›è½¦ï¼Œåˆ é™¤ç¼–è¾‘å™¨ä¸­æŒ‡å®šçš„å†…å®¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;// (Omitted repeated imports)
import {baseKeymap} from &amp;quot;prosemirror-commands&amp;quot;

let state = EditorState.create({
  schema,
  plugins: [
    history(),
    keymap({&amp;quot;Mod-z&amp;quot;: undo, &amp;quot;Mod-y&amp;quot;: redo}),
    keymap(baseKeymap)
  ]
})
let view = new EditorView(document.body, {state})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨ï¼Œä½ å·²ç»æœ‰äº†ä¸€ä¸ªç®—å¾—ä¸Šå¯ä»¥ä½¿ç”¨çš„ç¼–è¾‘å™¨äº†&lt;/p&gt;

&lt;p&gt;æ·»åŠ èœå•ï¼Œé¢å¤–çš„ä¸ºç‰¹å®šéª¨æ¶æŒ‡å®šçš„å¿«æ·é”®ç»‘å®š ç­‰åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹Â &lt;a href=&#34;https://github.com/prosemirror/prosemirror-example-setup&#34; title=&#34;prosemirror-example-setup&#34;&gt;prosemirror-example-setup&lt;/a&gt; åŒ…äº†è§£æ›´å¤šã€‚è¿™ä¸ªæ¨¡å—æä¾›ç»™ä½ ä¸€ç»„æ’ä»¶ç”¨æ¥åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ç¼–è¾‘å™¨ï¼Œä½†æ˜¯å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œåªæ˜¯ä¸ªä¾‹å­ï¼Œå¹¶ä¸æ˜¯ç”Ÿäº§ç¯å¢ƒçº§åˆ«çš„ä»£ç åº“ã€‚çœŸæ­£çš„å¼€å‘ä¸­ï¼Œä½ å¯èƒ½ä¼šéœ€è¦æ›¿æ¢æˆè‡ªå®šä¹‰çš„ä»£ç æ¥ç²¾ç¡®å®ç°ä½ æƒ³è¦çš„åŠŸèƒ½&lt;/p&gt;

&lt;h3 id=&#34;å†…å®¹-content&#34;&gt;å†…å®¹ Content&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªçŠ¶æ€çš„æ–‡æ¡£è¢«æŒ‚åœ¨å®ƒçš„ &lt;code&gt;doc&lt;/code&gt; å±æ€§ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æ„ï¼Œç”¨å„ç§çº§åˆ«çš„èŠ‚ç‚¹æ¥è¡¨ç¤ºæ–‡æ¡£ï¼Œå°±åƒæ˜¯æµè§ˆå™¨çš„ DOMã€‚ä¸€ä¸ªç®€å•çš„æ–‡æ¡£å¯èƒ½ä¼šç”±ä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ªã€Œæ®µè½ã€èŠ‚ç‚¹ï¼Œæ¯ä¸ªã€Œæ®µè½ã€èŠ‚ç‚¹åˆåŒ…å«ä¸€ä¸ªã€Œæ–‡æœ¬ã€èŠ‚ç‚¹çš„ã€Œæ–‡æ¡£ã€èŠ‚ç‚¹æ„æˆ&lt;/p&gt;

&lt;p&gt;å½“åˆå§‹åŒ–ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œä½ å¯ä»¥ç»™å®ƒä¸€ä¸ªåˆå§‹æ–‡æ¡£ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ&lt;code&gt;schema&lt;/code&gt; å°±å˜æˆéå¿…ä¼ é¡¹äº†ï¼Œå› ä¸º &lt;code&gt;schame&lt;/code&gt; å¯ä»¥ä»æ–‡æ¡£ä¸­è·å–&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¼ å…¥ä¸€ä¸ª DOM å…ƒç´  ï¼ˆID ä¸º contentï¼‰åšä¸º DOM parser çš„å‚æ•°åˆå§‹åŒ–ä¸€ä¸ªçŠ¶æ€ï¼Œå®ƒå°†åˆ©ç”¨ &lt;code&gt;schema&lt;/code&gt; ä¸­çš„ä¿¡æ¯æ¥è§£æå‡ºå¯¹åº”çš„èŠ‚ç‚¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;import {DOMParser} from &amp;quot;prosemirror-model&amp;quot;
import {EditorState} from &amp;quot;prosemirror-state&amp;quot;
import {schema} from &amp;quot;prosemirror-schema-basic&amp;quot;

let content = document.getElementById(&amp;quot;content&amp;quot;)
let state = EditorState.create({
  doc: DOMParser.fromSchema(schema).parse(content)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ–‡æ¡£-documents&#34;&gt;æ–‡æ¡£ Documents&lt;/h3&gt;

&lt;p&gt;ProseMirror å®šä¹‰äº†ä»–è‡ªå·±çš„ä¸€ç§ç”¨æ¥è¡¨ç¤ºæ–‡æ¡£å†…å®¹çš„æ•°æ®ç»“æ„ã€‚ç”±äºæ–‡æ¡£æ˜¯æ„å»ºæ‰€æœ‰ç¼–è¾‘å™¨çš„æ ¸å¿ƒå…ƒç´ ï¼Œäº†è§£å®ƒä»¬çš„å·¥ä½œåŸç†ä¼šå¯¹æˆ‘ä»¬å¾ˆæœ‰å¸®åŠ©&lt;/p&gt;

&lt;h3 id=&#34;ç»“æ„-structure&#34;&gt;ç»“æ„ Structure&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ª ProseMirror æ–‡æ¡£å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒåŒ…å«ä¸€ä¸ªç‰‡æ®µï¼Œå…¶ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­èŠ‚ç‚¹&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªå’Œæµè§ˆå™¨ DOM éå¸¸ç›¸ä¼¼ï¼Œæµè§ˆå™¨ DOM æ˜¯ä¸€ä¸ªé€’å½’çš„æ ‘å‹ç»“æ„ã€‚ä½†æ˜¯Â ProseMirror çš„ä¸åŒç‚¹åœ¨äºå®ƒå­˜å‚¨å†…è”å…ƒç´ çš„æ–¹å¼&lt;/p&gt;

&lt;p&gt;åœ¨ HTML ä¸­ï¼Œä¸€ä¸ªæ®µè½çš„æ ‡è®°è¡¨ç¤ºä¸ºä¸€ä¸ªæ ‘ï¼Œå°±åƒè¿™ä¸ªï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;p&amp;gt;This is &amp;lt;strong&amp;gt;strong text with &amp;lt;em&amp;gt;emphasis&amp;lt;/em&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://img13.360buyimg.com/devfe/jfs/t1/14129/3/786/35284/5c0cc441E403d82b0/ef0b3f850962b393.png&#34; alt=&#34;prosemirror-1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåœ¨ ProseMirror ä¸­ï¼Œå†…è”å†…å®¹è¢«å»ºæ¨¡ä¸ºÂ &lt;strong&gt;æ‰å¹³&lt;/strong&gt;Â çš„åºåˆ—ï¼Œæ ‡è®°ä½œä¸ºå…ƒæ•°æ®é™„åŠ åˆ°èŠ‚ç‚¹&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://img20.360buyimg.com/devfe/jfs/t1/15813/40/792/39752/5c0cc4e0Ee27f5876/150f7e117aa64233.png&#34; alt=&#34;prosemirror-2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ›´ç¬¦åˆæˆ‘ä»¬æ€è€ƒå’Œä½¿ç”¨æ­¤ç±»æ–‡æœ¬çš„æ–¹å¼ï¼Œè¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨å­—ç¬¦æ¥è¡¨ç¤ºä½ç½®è€Œä¸æ˜¯æ ‘çš„è·¯å¾„ï¼Œè¿™ä½¿å¾—ä¸€äº›æ“ä½œå¦‚åˆ†å‰²ã€æ›´æ”¹å†…å®¹æ ·å¼å˜å¾—æ¯”ç»´æŠ¤æ ‘ç®€å•&lt;/p&gt;

&lt;p&gt;è¿™ä¹Ÿæ„å‘³ç€æ¯ä¸ªæ–‡æ¡£éƒ½åªæœ‰ä¸€ç§åˆæ³•çš„è¡¨ç°å±‚ã€‚å…·æœ‰ç›¸åŒæ ‡è®°é›†çš„ç›¸é‚»æ–‡æœ¬èŠ‚ç‚¹æ€»æ˜¯ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ä¸å…è®¸æœ‰ç©ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ ‡è®°å‡ºç°çš„é¡ºåºç”±éª¨æ¶æŒ‡å®š&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥è¯´ä¸€ä¸ªÂ ProseMirror æ–‡æ¡£å°±æ˜¯ä¸€é¢—å—çº§èŠ‚ç‚¹æ ‘ï¼Œå…¶ä¸­å¤§å¤šæ•°å¶å­èŠ‚ç‚¹éƒ½æ˜¯æ–‡æœ¬å—ï¼Œå—çº§èŠ‚ç‚¹å¯ä»¥åŒ…å«è¿™äº›æ–‡æœ¬å—å„¿ã€‚ä½ ä¹Ÿå¯ä»¥æœ‰ä¸€äº›ç©ºçš„å¶å­èŠ‚ç‚¹ï¼Œæ¯”å¦‚æ°´å¹³åˆ†éš”çº¿æˆ–è€…è§†é¢‘å…ƒç´ &lt;/p&gt;

&lt;p&gt;èŠ‚ç‚¹å¯¹è±¡æœ‰å¾ˆå¤šå±æ€§ï¼Œå®ƒä»¬ä»£è¡¨æ‰€å¤„æ–‡æ¡£ä¸­çš„è§’è‰²ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;isBlock&lt;/code&gt; å’Œ isInline å‘Šè¯‰ä½ ç»™å®šçš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå—çº§èŠ‚ç‚¹è¿˜æ˜¯å†…è”èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;inlineContent&lt;/code&gt; è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹å¸Œæœ›å®ƒçš„å†…å®¹æ˜¯æ˜¯å†…è”å…ƒç´ &lt;/li&gt;
&lt;li&gt;&lt;code&gt;isTextblock&lt;/code&gt; è¡¨ç¤ºä¸€ä¸ªå—çº§èŠ‚ç‚¹åŒ…å«å†…è”å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;isLeaf&lt;/code&gt; å‘Šè¯‰ä½ èŠ‚ç‚¹ä¸å…è®¸æœ‰ä»»ä½•å†…å®¹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¸å‹çš„ã€Œæ®µè½ã€èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œã€Œå¼•ç”¨å—ã€å¯èƒ½æ˜¯ä¸€ä¸ªåŒ…å«å…¶å®ƒå—çº§å…ƒç´ çš„å…ƒç´ ã€‚æ–‡æœ¬ã€ç¡¬æ¢è¡Œï¼ˆ&lt;br&gt;ï¼‰ä»¥åŠå†…è”å›¾ç‰‡éƒ½æ˜¯å†…è”å¶å­èŠ‚ç‚¹ï¼Œæ°´å¹³åˆ†éš”çº¿èŠ‚ç‚¹åˆ™æ˜¯ä¸€ç§å—çº§å¶å­èŠ‚ç‚¹&lt;/p&gt;

&lt;p&gt;éª¨æ¶å…è®¸ä½ æ›´å‡†ç¡®åœ°æŒ‡å®šä»€ä¹ˆä¸œè¥¿åº”è¯¥å‡ºç°åœ¨ä»€ä¹ˆä½ç½®ï¼Œä¾‹å¦‚ã€‚å³ä½¿ä¸€ä¸ªèŠ‚ç‚¹å…è®¸å—çº§å†…å®¹ï¼Œè¿™å¹¶ä¸è¡¨ç¤ºä»–ä¼šå…è®¸æ‰€æœ‰çš„èŠ‚ç‚¹åšä¸ºå®ƒçš„å†…å®¹&lt;/p&gt;

&lt;h3 id=&#34;æ ‡è¯†ä¸å­˜å‚¨-identity-and-persistence&#34;&gt;æ ‡è¯†ä¸å­˜å‚¨ Identity and persistence&lt;/h3&gt;

&lt;p&gt;å¦å¤–ä¸€ä¸ª DOM æ ‘å’ŒÂ ProseMirror æ–‡æ¡£ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œå¯¹è±¡è¡¨ç¤ºèŠ‚ç‚¹çš„è¡Œä¸ºã€‚åœ¨ DOM ä¸­ï¼ŒèŠ‚ç‚¹æ˜¯å…·æœ‰æ ‡è¯†çš„å¯å˜çš„å¯¹è±¡ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸­ï¼Œå½“èŠ‚ç‚¹æ›´æ–°çš„æ—¶å€™å¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹&lt;/p&gt;

&lt;p&gt;å¦å¤–ä¸€æ–¹é¢ï¼Œåœ¨Â ProseMirror ä¸­ï¼ŒèŠ‚ç‚¹ä»…ä»…æ˜¯ä¸€äº›Â *å€¼*ï¼Œå’Œä½ æƒ³è¡¨ç¤ºæ•°å­— 3 ä¸€æ ·ï¼Œ3 å¯ä»¥åŒæ—¶å‡ºç°åœ¨å¾ˆå¤šæ•°æ®ç»“æ„ä¸­ï¼Œå®ƒè‡ªå·±æ‰€å¤„çš„éƒ¨åˆ†ä¸çˆ¶å…ƒç´ æ²¡æœ‰è¿ç³»ï¼Œå¦‚æœä½ ç»™å®ƒåŠ  1ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ–°å€¼ 4ï¼Œå¹¶ä¸”ä¸ç”¨æ”¹å˜å’ŒåŸæ¥ 3 ç›¸å…³çš„ä»»ä½•ä¸œè¥¿&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥å®ƒæ˜¯ ProseMirror æ–‡æ¡£çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬ä¸ä¼šæ›´æ”¹ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä½œè®¡ç®—ä¿®æ”¹åçš„æ–‡æ¡£çš„èµ·å§‹å€¼ã€‚å®ƒä»¬ä¹Ÿä¸çŸ¥é“è‡ªå·±å¤„åœ¨ä»€ä¹ˆæ•°æ®ç»“æ„å½“ä¸­ï¼Œä½†å¯ä»¥æ˜¯å¤šä¸ªç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œç”šè‡³å¤šæ¬¡å‡ºç°åœ¨ä¸€ä¸ªç»“æ„ä¸­ã€‚å®ƒä»¬æ˜¯å€¼ï¼Œä¸æ˜¯çŠ¶æ€åŒ–çš„å¯¹è±¡&lt;/p&gt;

&lt;p&gt;è¿™è¡¨ç¤ºæ¯å½“ä½ æ›´æ–°æ–‡æ¡£ï¼Œä½ å°†ä¼šè·å¾—ä¸€ä¸ªæ–°çš„æ–‡æ¡£å€¼ã€‚æ–‡æ¡£å€¼å°†å…±äº«æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šä¿®æ”¹åŸæ¥çš„æ–‡æ¡£å€¼ï¼Œè¿™ä½¿å¾—å®ƒåˆ›å»ºèµ·æ¥ç›¸å¯¹å»‰ä»·&lt;/p&gt;

&lt;p&gt;è¿™æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚å®ƒå¯ä»¥ä½¿ä¸¤æ¬¡æ›´æ–°ä¹‹é—´çš„è¿‡ç¨‹æ— æ•ˆï¼ˆä¸¥æ ¼æ§åˆ¶æ›´æ–°çš„å†…å®¹å’Œè¿‡ç¨‹ï¼‰ï¼Œå› ä¸ºå…·æœ‰æ–°æ–‡æ¡£çš„æ–°çŠ¶æ€å¯ä»¥ç¬é—´è½¬æ¢ã€‚å®ƒè¿˜ä½¿å¾—æ–‡æ¡£ä»¥æŸç§æ•°å­¦æ–¹å¼æ¨ç†å˜å¾—æ›´å®¹æ˜“ï¼Œç›¸åçš„å¦‚æœä½ çš„å€¼ä¸æ–­çš„åœ¨åå°å‘ç”Ÿå˜åŒ–è¿™å°†ä¼šå¾ˆéš¾åšåˆ°ã€‚è¿™ä¹Ÿä½¿å¾—åä½œç¼–è¾‘æˆä¸ºå¯èƒ½ï¼Œå¹¶å…è®¸ ProseMirror é€šè¿‡å°†æœ€åä¸€ä¸ªç»˜åˆ¶åˆ°å±å¹•çš„æ–‡æ¡£ä¸å½“å‰æ–‡æ¡£è¿›è¡Œæ¯”è¾ƒæ¥è¿è¡Œéå¸¸é«˜æ•ˆçš„ DOM æ›´æ–°ç®—æ³•&lt;/p&gt;

&lt;p&gt;ç”±äºæ­¤ç±»èŠ‚ç‚¹ä½¿ç”¨äº†å¸¸è§„çš„ JavaScript å¯¹è±¡æ¥è¡¨ç¤ºï¼Œå¦‚æœå¹¶ä¸”æ˜ç¡®åœ°å†»ç»“ï¼ˆ&lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze&#34; title=&#34;freeze&#34;&gt;freezing&lt;/a&gt;ï¼‰å…¶å±æ€§å¯èƒ½ä¼šå½±å“åˆ°æ€§èƒ½ï¼Œå®é™…ä¸Šå±æ€§æ˜¯Â *å¯ä»¥*Â æ”¹å˜çš„ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®ä½ è¿™ä¹ˆåšï¼Œè¿™å°†ä¼šå¯¼è‡´ç¨‹åºä¸­æ–­ï¼Œå› ä¸ºå®ƒä»¬å‡ ä¹æ€»æ˜¯åœ¨å¤šä¸ªæ•°æ®ç»“æ„ä¹‹é—´å…±äº«ã€‚æ‰€ä»¥è¦å°å¿ƒï¼è¯·æ³¨æ„ï¼Œè¿™ä¹Ÿé€‚ç”¨äºä½œä¸ºèŠ‚ç‚¹å¯¹è±¡ä¸€éƒ¨åˆ†çš„æ•°ç»„å’Œæ™®é€šå¯¹è±¡ï¼Œä¾‹å¦‚ç”¨äºå­˜å‚¨èŠ‚ç‚¹å±æ€§çš„å¯¹è±¡æˆ–ç‰‡æ®µä¸­å­èŠ‚ç‚¹çš„æ•°ç»„ï¼ˆè¯‘æ³¨ï¼šæ„æ€æ˜¯ä½ æœ€å¥½ä¸è¦æ›´æ”¹ç±»ä¼¼çš„å†…éƒ¨å¯¹è±¡ï¼Œç»™å¯¹è±¡æ·»åŠ æˆ–è€…åˆ é™¤å±æ€§ï¼‰&lt;/p&gt;

&lt;h3 id=&#34;æ•°æ®ç»“æ„-data-structures&#34;&gt;æ•°æ®ç»“æ„Â Data structures&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªæ–‡æ¡£çš„å¯¹è±¡çœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://img20.360buyimg.com/devfe/jfs/t1/9284/27/8310/83213/5c0cc4f2E3dca8ae6/dcc5b46f77995593.png&#34; alt=&#34;prosemirror-3&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª Node ç±»çš„å®ä¾‹ã€‚éƒ½æœ‰ä¸€ä¸ª type åšä¸ºæ ‡ç­¾ï¼Œé€šè¿‡ type å¯ä»¥çŸ¥é“èŠ‚ç‚¹çš„åå­—ï¼ŒèŠ‚ç‚¹çš„å±æ€§å­—æ®µä¹Ÿæ˜¯æœ‰æ•ˆçš„ç­‰ç­‰ã€‚èŠ‚ç‚¹çš„ç±»å‹ï¼ˆå’Œæ ‡è¯†ç±»å‹ï¼‰æ¯éª¨æ¶ä¼šåˆ›å»ºä¸€æ¬¡ï¼Œä»–ä»¬çŸ¥é“è‡ªå·±å±äºéª¨æ¶çš„å“ªä¸ªéƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;èŠ‚ç‚¹çš„å†…å®¹å­˜å‚¨åœ¨ Fragment çš„ä¸€ä¸ªå®ä¾‹ä¸­ï¼Œå®ƒæŒæ¡ç€èŠ‚ç‚¹åºåˆ—ã€‚å³ä½¿èŠ‚ç‚¹æ²¡æœ‰æˆ–è€…ä¸å…è®¸æœ‰å†…å®¹ï¼Œè¿™ä¸ªå­—æ®µä¹Ÿä¼šæœ‰å€¼ï¼ˆå…±äº«çš„ç©º fragmentï¼‰&lt;/p&gt;

&lt;p&gt;ä¸€äº›èŠ‚ç‚¹ç±»å‹å…è®¸æ·»åŠ å±æ€§ï¼Œå®ƒäº›å€¼è¢«å­˜å‚¨åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚æ¯”å¦‚ï¼Œå›¾ç‰‡èŠ‚ç‚¹ä¸€èˆ¬ä¼šä½¿ç”¨å±æ€§æ¥å­˜å‚¨ alt æ–‡æœ¬å’Œå›¾ç‰‡çš„ URL&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œå†…è”èŠ‚ç‚¹åŒ…å«ä¸€ç»„æ´»åŠ¨æ ‡è®° â€” ä¾‹å¦‚å¼ºè°ƒï¼ˆemphasisï¼‰æˆ–é“¾æ¥ï¼ˆlinkï¼‰â€” æ´»åŠ¨æ ‡è®°å°±æ˜¯ä¸€ç»„ Mark å®ä¾‹&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªæ–‡æ¡£å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ–‡æ¡£å†…å®¹è¡¨ç°ä¸ºä¸€ä¸ªé¡¶çº§èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚é€šå¸¸ï¼Œå®ƒå°†åŒ…å«ä¸€ç³»åˆ—å—èŠ‚ç‚¹ï¼Œå…¶ä¸­ä¸€äº›å—èŠ‚ç‚¹å¯èƒ½æ˜¯åŒ…å«å†…è”å†…å®¹çš„æ–‡æœ¬å—ã€‚ä½†é¡¶çº§èŠ‚ç‚¹æœ¬èº«ä¹Ÿå¯ä»¥æ˜¯æ–‡æœ¬å—ï¼Œè¿™æ ·çš„è¯æ–‡æ¡£å°±åªåŒ…å«å†…è”å†…å®¹&lt;/p&gt;

&lt;p&gt;ä»€ä¹ˆæ ·çš„èŠ‚ç‚¹å¯ä»¥è¢«å…è®¸ï¼Œæ˜¯ç”±æ–‡æ¡£çš„éª¨æ¶å†³å®šçš„ã€‚ç”¨ä»£ç çš„æ–¹å¼åˆ›å»ºèŠ‚ç‚¹ï¼ˆè€Œä¸æ˜¯ç›´æ¥ç”¨åŸºç¡€éª¨æ¶åº“ï¼‰ï¼Œä½ å¿…é¡»é€šè¿‡éª¨æ¶æ¥å®ç°ï¼Œæ¯”å¦‚ä½¿ç”¨ &lt;code&gt;node&lt;/code&gt; å’Œ &lt;code&gt;text&lt;/code&gt; æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;import {schema} from &amp;quot;prosemirror-schema-basic&amp;quot;

// å¦‚æœéœ€è¦çš„è¯å¯ä»¥æŠŠ null å‚æ•°æ›¿æ¢æˆä½ æƒ³ç»™èŠ‚ç‚¹æ·»åŠ çš„å±æ€§
let doc = schema.node(&amp;quot;doc&amp;quot;, null, [
  schema.node(&amp;quot;paragraph&amp;quot;, null, [schema.text(&amp;quot;One.&amp;quot;)]),
  schema.node(&amp;quot;horizontal_rule&amp;quot;),
  schema.node(&amp;quot;paragraph&amp;quot;, null, [schema.text(&amp;quot;Two!&amp;quot;)])
])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ç´¢å¼•-indexing&#34;&gt;ç´¢å¼•Â Indexing&lt;/h3&gt;

&lt;p&gt;ProseMirror èŠ‚ç‚¹æ”¯æŒä¸¤ç§ç´¢å¼• â€” å®ƒä»¬å¯ä»¥çœ‹åšæ˜¯æ ‘ï¼Œä½¿ç”¨å•ä¸ªèŠ‚ç‚¹çš„åç§»é‡ï¼Œæˆ–è€…å®ƒä»¬å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæ‰å¹³çš„æ ‡è¯†ï¼ˆtokensï¼‰åºåˆ—&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ç¬¬ä¸€ç§&lt;/em&gt; å…è®¸ä½ æ‰§è¡Œç±»ä¼¼äºå¯¹ DOM ä¸å•ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œçš„äº¤äº’ï¼Œä½¿ç”¨ &lt;code&gt;child&lt;/code&gt; æ–¹æ³•å’Œ &lt;code&gt;childCount&lt;/code&gt; ç›´æ¥è®¿é—®å­èŠ‚ç‚¹ï¼Œç¼–å†™æ‰«ææ–‡æ¡£çš„é€’å½’å‡½æ•°ï¼ˆå¦‚æœä½ åªæƒ³æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¯·ä½¿ç”¨ &lt;code&gt;descendants&lt;/code&gt; æˆ– &lt;code&gt;nodesBetween&lt;/code&gt;ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ç¬¬äºŒç§&lt;/em&gt; å½“è®¿é—®ä¸€ä¸ªæ–‡æ¡£ä¸­æŒ‡å®šçš„ä½ç½®æ—¶æ›´å¥½ç”¨ã€‚å®ƒå…è®¸æŠŠæ–‡æ¡£ä»»æ„ä½ç½®è¡¨ç¤ºä¸ºä¸€ä¸ªæ•´æ•° â€” å³æ ‡è®°åºåˆ—ä¸­çš„ç´¢å¼•ã€‚è¿™äº›æ ‡è¯†å¹¶ä¸åšä¸ºå¯¹è±¡åœ¨å†…å­˜ä¸­ â€” å®ƒä»¬ä»…ä»…æ˜¯ç”¨æ¥è®¡æ•°çš„æƒ¯ä¾‹ â€”Â ä½†æ˜¯æ–‡æ¡£çš„æ ‘å½¢çŠ¶ä»¥åŠæ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“å®ƒçš„å¤§å°ï¼Œè¿™ä½¿å¾—æŒ‰ä½ç½®è®¿é—®å˜çš„å»‰ä»·ï¼ˆè¯‘æ³¨ï¼šç±»ä¼¼äºç”¨ä¸‹æ ‡è®¿é—®æ‰å¹³æ•°ç»„ï¼Œè€Œä¸æ˜¯é€’å½’éå†åµŒå¥—ç»“æ„çš„æ ‘ï¼‰&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨ç¬¬ä¸€ä¸ªå†…å®¹ä¹‹å‰ï¼Œæ–‡æ¡£çš„å¼€å¤´æ˜¯ä½ç½® 0&lt;/li&gt;
&lt;li&gt;è¿›å…¥æˆ–ç¦»å¼€ä¸æ˜¯å¶å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼ˆå³æ”¯æŒå†…å®¹ï¼‰è®¡ä¸ºä¸€ä¸ª&lt;strong&gt;æ ‡è¯†ç´¢å¼•ä½&lt;/strong&gt;ã€‚å› æ­¤ï¼Œå¦‚æœæ–‡æ¡£ä»¥æ®µè½å¼€å¤´ï¼Œåˆ™è¯¥æ®µè½çš„å¼€å¤´è®¡ä¸ºä½ç½® 1&lt;/li&gt;
&lt;li&gt;æ–‡æœ¬èŠ‚ç‚¹ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½ç®—ä½œä¸€ä¸ªæ ‡è¯†ç´¢å¼•ä½ã€‚å› æ­¤ï¼Œå¦‚æœæ–‡æ¡£å¼€å¤´çš„æ®µè½åŒ…å«å•è¯ã€Œhiã€ï¼Œåˆ™ä½ç½® 2 ä½äºã€Œhã€ä¹‹åï¼Œä½ç½® 3 ä½äºã€Œiã€ä¹‹åï¼Œä½ç½® 4 ä½äºæ•´ä¸ªæ®µè½ä¹‹å&lt;/li&gt;
&lt;li&gt;ä¸å…è®¸æœ‰å†…å®¹ï¼ˆä¾‹å¦‚å›¾åƒï¼‰çš„å¶å­èŠ‚ç‚¹ä¹Ÿç®—ä½œÂ &lt;strong&gt;å•ä¸ª&lt;/strong&gt;Â æ ‡è¯†ç´¢å¼•ä½&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ–‡æ¡£ï¼Œå½“è¡¨ç¤ºä¸º HTML æ—¶ï¼Œå°†å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;p&amp;gt;One&amp;lt;/p&amp;gt;
&amp;lt;blockquote&amp;gt;&amp;lt;p&amp;gt;Two&amp;lt;img src=&amp;quot;...&amp;quot;&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/blockquote&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ ‡è¯†åºåˆ—ä»¥åŠä½ç½®ä¸‹æ ‡ï¼Œå°†ä¼šæ˜¯è¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;0   1 2 3 4    5
 &amp;lt;p&amp;gt; O n e &amp;lt;/p&amp;gt;

5            6   7 8 9 10    11   12            13
 &amp;lt;blockquote&amp;gt; &amp;lt;p&amp;gt; T w o &amp;lt;img&amp;gt; &amp;lt;/p&amp;gt; &amp;lt;/blockquote&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª &lt;code&gt;nodeSize&lt;/code&gt; å±æ€§ï¼Œå¯ä»¥ä¸ºå‘Šè¯‰ä½ æ•´ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œä½ å¯ä»¥è®¿é—® &lt;code&gt;.content.size&lt;/code&gt; æ¥è·å–èŠ‚ç‚¹Â *å†…å®¹*Â çš„å¤§å°ã€‚æ³¨æ„ï¼Œå¯¹äºå¤–éƒ¨æ–‡æ¡£èŠ‚ç‚¹ï¼Œæ‰“å¼€å’Œå…³é—­æ ‡è®°ä¸è¢«è§†ä¸ºæ–‡æ¡£çš„ä¸€éƒ¨åˆ†ï¼ˆå› ä¸ºä½ æ— æ³•å°†å…‰æ ‡æ”¾åœ¨æ–‡æ¡£å¤–é¢ï¼‰ï¼Œå› æ­¤æ–‡æ¡£çš„å¤§å°ä¸º &lt;code&gt;doc.content.size&lt;/code&gt;ï¼Œè€Œä¸æ˜¯ &lt;code&gt;doc.nodeSize&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æ‰‹åŠ¨è§£é‡Šè¿™æ ·çš„ä½ç½®ä¼šæ¶‰åŠç›¸å½“å¤šçš„è®¡æ•°æ“ä½œã€‚ä½ å¯ä»¥è°ƒç”¨ &lt;code&gt;Node.resolve&lt;/code&gt; æ¥è·å–å…³äºèŠ‚ç‚¹ä½ç½®çš„æ›´å…·æœ‰æè¿°æ€§çš„æ•°æ®ç»“æ„ã€‚è¿™ä¸ªæ•°æ®ç»“æ„å°†å‘Šè¯‰ä½ è¯¥ä½ç½®çš„çˆ¶èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œå®ƒä¸çˆ¶èŠ‚ç‚¹çš„åç§»é‡æ˜¯ä»€ä¹ˆï¼Œçˆ¶èŠ‚ç‚¹çš„ç¥–å…ˆæ˜¯ä»€ä¹ˆï¼Œä»¥åŠå…¶ä»–ä¸€äº›ä¸œè¥¿&lt;/p&gt;

&lt;p&gt;æ³¨æ„åŒºåˆ†å­ç´¢å¼•ï¼ˆæ¯ä¸ª childCountï¼‰ï¼Œæ–‡æ¡£èŒƒå›´çš„ä½ç½®å’Œ &lt;code&gt;node-local&lt;/code&gt; åç§»ï¼ˆæœ‰æ—¶åœ¨é€’å½’å‡½æ•°ä¸­ç”¨äºè¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹ä¸­çš„ä½ç½®ï¼‰&lt;/p&gt;

&lt;h3 id=&#34;åˆ‡ç‰‡-slices&#34;&gt;åˆ‡ç‰‡ Slices&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†å¤„ç†ä¸€äº›è¯¸å¦‚å¤åˆ¶/ç²˜è´´å’Œæ‹–æ‹½ä¹‹ç±»çš„æ“ä½œï¼Œé€šè¿‡åˆ‡ç‰‡ä¸æ–‡æ¡£è¿›è¡Œé€šä¿¡æ˜¯éå¸¸å¿…è¦çš„ï¼Œæ¯”å¦‚ï¼Œä¸¤ä¸ªä½ç½®ä¹‹é—´çš„å†…å®¹ã€‚è¿™æ ·çš„åˆ‡ç‰‡ä¸åŒäºæ•´ä¸ªèŠ‚ç‚¹æˆ–è€…ç‰‡æ®µï¼Œä¸€äº›èŠ‚ç‚¹å¯èƒ½ä½äºåˆ‡ç‰‡å¼€å§‹æˆ–è€…ç»“æŸï¼ˆè¯‘æ³¨ï¼šåˆ‡ç‰‡çš„å¼€å§‹ä½ç½®å¯èƒ½åœ¨æŸä¸ªèŠ‚ç‚¹çš„ä¸­é—´ï¼‰&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œä»ä¸€ä¸ªæ®µè½çš„ä¸­é—´é€‰æ‹©åˆ°ä¸‹ä¸€ä¸ªæ®µè½çš„ä¸­é—´ï¼Œä½ æ‰€é€‰æ‹©çš„åˆ‡ç‰‡ä¸­ä¼šæœ‰ä¸¤ä¸ªæ®µè½ï¼Œé‚£ä¹ˆåˆ‡ç‰‡çš„å¼€å§‹ä½ç½®åœ¨ç¬¬ä¸€ä¸ªæ®µè½æ‰“å¼€çš„åœ°æ–¹ï¼Œç»“æŸä½ç½®å°±åœ¨ç¬¬äºŒä¸ªæ®µè½æ‰“å¼€çš„åœ°æ–¹ã€‚ç„¶è€Œå¦‚æœä½ Â node-select ä¸€ä¸ªæ®µè½ï¼Œä½ å°±é€‰æ‹©äº†ä¸€æ•´ä¸ªæœ‰å…³é—­çš„èŠ‚ç‚¹ã€‚å¯èƒ½çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœå°†æ­¤ç±»å¼€æ”¾èŠ‚ç‚¹ä¸­çš„å†…å®¹è§†ä¸ºèŠ‚ç‚¹çš„å®Œæ•´å†…å®¹ï¼Œåˆ™ä¼šè¿åéª¨æ¶çº¦æŸï¼ˆæ ‡ç­¾å¯èƒ½æ²¡å…³é—­ï¼‰ï¼Œå› ä¸ºæŸäº›æ‰€éœ€èŠ‚ç‚¹è½åœ¨åˆ‡ç‰‡ä¹‹å¤–&lt;/p&gt;

&lt;p&gt;Slice æ•°æ®ç»“æ„ç”¨äºè¡¨ç¤ºè¿™æ ·çš„åˆ‡ç‰‡ã€‚å®ƒå­˜å‚¨ä¸€ä¸ª fragment ä»¥åŠä¸¤ä¾§çš„ èŠ‚ç‚¹æ‰“å¼€æ·±åº¦ï¼ˆopen depthï¼‰ã€‚ä½ å¯ä»¥åœ¨èŠ‚ç‚¹ä¸Šä½¿ç”¨åˆ‡ç‰‡æ–¹æ³•ä»æ–‡æ¡£å¤–å‰ªåˆ‡åˆ‡ç‰‡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;/*
0   1 2 3   4
 &amp;lt;p&amp;gt; a b &amp;lt;/p&amp;gt;
4   5 6 7   8 
 &amp;lt;p&amp;gt; a b &amp;lt;/p&amp;gt;
*/
// doc holds two paragraphs, containing text &amp;quot;a&amp;quot; and &amp;quot;b&amp;quot;
let slice1 = doc.slice(0, 3) // The first paragraph
/*
0|   1 2 3   |4
 &amp;lt;p&amp;gt; a b &amp;lt;/p&amp;gt;
*/
console.log(slice1.openStart, slice1.openEnd) // â†’ 0 0
let slice2 = doc.slice(1, 5) // From start of first paragraph
                             // to end of second
/*
0  1| 2 3   4
 &amp;lt;p&amp;gt; a b &amp;lt;/p&amp;gt;
4    5|6 7   8 
 &amp;lt;p&amp;gt; a b &amp;lt;/p&amp;gt;
*/
console.log(slice2.openStart, slice2.openEnd) // â†’ 1 1
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ›´æ”¹-changing&#34;&gt;æ›´æ”¹Â Changing&lt;/h3&gt;

&lt;p&gt;ç”±äºèŠ‚ç‚¹å’Œç‰‡æ®µæ˜¯æŒä¹…å­˜å‚¨çš„ï¼Œå› æ­¤Â &lt;strong&gt;æ°¸è¿œ&lt;/strong&gt;Â ä¸è¦ä¿®æ”¹å®ƒä»¬ã€‚å¦‚æœä½ æœ‰æ–‡æ¡£ï¼ˆæˆ–èŠ‚ç‚¹æˆ–ç‰‡æ®µï¼‰çš„å¥æŸ„ï¼Œé‚£è¿™ä¸ªå¥æŸ„å¼•ç”¨çš„å¯¹è±¡å°†ä¿æŒä¸å˜ï¼ˆè¯‘æ³¨ï¼šè¿™æ„å‘³ç€å¹¶ä¸èƒ½é€šè¿‡æ‹¿åˆ°çš„å¼•ç”¨ç›´æ¥ä¿®æ”¹èŠ‚ç‚¹ï¼Œå› ä¸ºè¿™ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨æ˜¯ä¸å¯å˜çš„å€¼ï¼Œå½“ä½ æƒ³æ”¹å˜çš„æ—¶å€™èŠ‚ç‚¹å¯èƒ½å·²ç»æˆä¸ºå†å²ï¼‰&lt;/p&gt;

&lt;p&gt;å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å°†ä½¿ç”¨è½¬æ¢ï¼ˆtransformationsï¼‰æ¥æ›´æ–°æ–‡æ¡£ï¼Œè€Œä¸å¿…ç›´æ¥æ¥è§¦èŠ‚ç‚¹ã€‚è¿™äº›ä¹Ÿä¼šç•™ä¸‹æ›´æ”¹è®°å½•ï¼Œå½“æ–‡æ¡£æ˜¯ç¼–è¾‘å™¨çŠ¶æ€çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œè¿™æ˜¯å¿…è¦çš„&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ç¡®å®æƒ³è¦ã€Œæ‰‹åŠ¨ã€æ´¾å‘æ›´æ–°çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆ &lt;code&gt;Node&lt;/code&gt; å’Œ &lt;code&gt;Fragment&lt;/code&gt; ç±»å‹ä¸Šæœ‰ä¸€äº›è¾…åŠ©æ–¹æ³•å¯ç”¨ã€‚è¦åˆ›å»ºæ•´ä¸ªæ–‡æ¡£çš„æ›´æ–°ç‰ˆæœ¬ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨&lt;code&gt;Node.replace&lt;/code&gt;ï¼Œå®ƒç”¨ä¸€ä¸ªæ–°çš„å†…å®¹åˆ‡ç‰‡æ›¿æ¢æ–‡æ¡£çš„ç»™å®šèŒƒå›´ã€‚è¦å°‘é‡åœ°æ›´æ–°èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ copy æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨æ–°å†…å®¹åˆ›å»ºç±»ä¼¼çš„èŠ‚ç‚¹ã€‚Fragments è¿˜æœ‰å„ç§æ›´æ–°æ–¹æ³•ï¼Œä¾‹å¦‚ &lt;code&gt;replaceChild&lt;/code&gt; æˆ– &lt;code&gt;append&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;éª¨æ¶-schemas&#34;&gt;éª¨æ¶ Schemas&lt;/h2&gt;

&lt;p&gt;æ¯ä¸ª ProseMirror æ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„éª¨æ¶ï¼Œéª¨æ¶æè¿°äº†æ–‡æ¡£ä¸­å¯èƒ½å‡ºç°çš„èŠ‚ç‚¹ç±»å‹ä»¥åŠå®ƒä»¬åµŒå¥—çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šæŒ‡å®šé¡¶çº§èŠ‚ç‚¹å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå—ï¼Œå¹¶ä¸”æ®µè½èŠ‚ç‚¹å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å†…è”èŠ‚ç‚¹ï¼Œå†…è”èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ä»»ä½•æ ‡è®°&lt;/p&gt;

&lt;p&gt;æœ‰ä¸€ä¸ªåŒ…å«åŸºç¡€éª¨æ¶çš„åŒ…ï¼Œä½† ProseMirror çš„ä¼˜ç‚¹åœ¨äºå®ƒå…è®¸ä½ å®šä¹‰è‡ªå·±çš„éª¨æ¶&lt;/p&gt;

&lt;h3 id=&#34;èŠ‚ç‚¹ç±»å‹-node-types&#34;&gt;èŠ‚ç‚¹ç±»å‹Â Node Types&lt;/h3&gt;

&lt;p&gt;æ–‡æ¡£ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè¡¨ç¤ºå…¶è¯­ä¹‰å’Œå±æ€§ï¼Œæ­£å¦‚å…¶åœ¨ç¼–è¾‘å™¨ä¸­å‘ˆç°çš„æ–¹å¼&lt;/p&gt;

&lt;p&gt;å®šä¹‰éª¨æ¶æ—¶ï¼Œå¯ä»¥æšä¸¾å…¶ä¸­å¯èƒ½å‡ºç°çš„èŠ‚ç‚¹ç±»å‹ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;spec&lt;/code&gt; å¯¹è±¡æè¿°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;const trivialSchema = new Schema({
  nodes: {
    doc: {content: &amp;quot;paragraph+&amp;quot;},
    paragraph: {content: &amp;quot;text*&amp;quot;},
    text: {inline: true},
    /* ... and so on */
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªéª¨æ¶ï¼Œå…¶ä¸­æ–‡æ¡£å¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ®µè½ï¼Œæ¯ä¸ªæ®µè½å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„æ–‡æœ¬&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªéª¨æ¶å¿…é¡»è‡³å°‘å®šä¹‰é¡¶çº§èŠ‚ç‚¹ç±»å‹ï¼ˆé»˜è®¤ä¸ºåç§°ã€Œdocã€ï¼Œä½†ä½ å¯ä»¥è®¾ç½®ï¼‰ï¼Œä»¥åŠæ–‡æœ¬å†…å®¹çš„ï¼ˆtextï¼‰ç±»å‹&lt;/p&gt;

&lt;p&gt;æ³¨æ„å†…è”çš„èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ inline å±æ€§å£°æ˜ï¼ˆä½†å¯¹äºæ–‡æœ¬ç±»å‹ï¼Œæ ¹æ®å®šä¹‰æ˜¯å†…è”çš„ï¼Œå¯ä»¥çœç•¥å®ƒï¼‰&lt;/p&gt;

&lt;h3 id=&#34;å†…å®¹è¡¨è¾¾å¼-content-expressions&#34;&gt;å†…å®¹è¡¨è¾¾å¼Â Content Expressions&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢ç¤ºä¾‹æ¨¡å¼ä¸­çš„å†…å®¹å­—æ®µï¼ˆparagraph+, text*ï¼‰ä¸­çš„å­—ç¬¦ä¸²ç§°ä¸ºå†…å®¹è¡¨è¾¾å¼ã€‚å®ƒä»¬æ§åˆ¶å­èŠ‚ç‚¹çš„å“ªäº›åºåˆ—å¯¹æ­¤èŠ‚ç‚¹ç±»å‹æœ‰æ•ˆ&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚Â &lt;code&gt;paragraph&lt;/code&gt;Â è¡¨ç¤ºã€Œä¸€ä¸ªæ®µè½ã€,Â &lt;code&gt;paragraph+&lt;/code&gt;Â è¡¨ç¤ºã€Œä¸€ä¸ªæˆ–è€…å¤šä¸ªæ®µè½ã€ã€‚ç›¸ä¼¼åœ°ï¼Œ&lt;code&gt;paragraph*&lt;/code&gt;Â è¡¨ç¤ºã€Œé›¶ä¸ªæˆ–è€…æ›´å¤šä¸ªæ®µè½ã€,Â &lt;code&gt;caption?&lt;/code&gt; è¡¨ç¤ºã€Œé›¶ä¸ªæˆ–è€…ä¸€ä¸ªè¯´æ˜æ–‡å­—ã€ã€‚ä½ å¯ä»¥ä½¿ç”¨ç±»æ­£åˆ™çš„èŒƒå›´åŒºé—´ï¼Œæ¯”å¦‚Â &lt;code&gt;{2}&lt;/code&gt; è¡¨ç¤ºç²¾ç¡®çš„ä¸¤æ¬¡ï¼Œ&lt;code&gt;{1, 5}&lt;/code&gt; è¡¨ç¤º 1~5 æ¬¡ï¼Œ&lt;code&gt;{2,}&lt;/code&gt; è¡¨ç¤º 2~æ›´å¤šå¤šæ¬¡&lt;/p&gt;

&lt;p&gt;å¯ä»¥ç»„åˆè¿™äº›è¡¨è¾¾å¼æ¥åˆ›å»ºåºåˆ—ï¼Œæ¯”å¦‚Â &lt;code&gt;heading paragraph+&lt;/code&gt; è¡¨ç¤ºã€Œé¦–å…ˆæ˜¯æ ‡é¢˜ï¼Œç„¶åæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ®µè½ã€ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç®¡é“è¿ç®—ç¬¦ &lt;code&gt;|&lt;/code&gt; è¡¨ç¤ºä¸¤ä¸ªè¡¨è¾¾å¼ä¹‹é—´çš„é€‰æ‹©ï¼Œå¦‚Â &lt;code&gt;(paragraph|blockquote)+&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æŸäº›å…ƒç´ ç±»å‹ç»„å°†åœ¨ä½ çš„æ¨¡å¼ä¸­å‡ºç°å¤šç§ç±»å‹ â€” ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªã€Œå—ã€èŠ‚ç‚¹çš„æ¦‚å¿µï¼Œå®ƒå¯èƒ½å‡ºç°åœ¨é¡¶å±‚ä½†ä¹ŸåµŒå¥—åœ¨å—å¼•ç”¨å†…ã€‚ä½ å¯ä»¥é€šè¿‡ä¸ºèŠ‚ç‚¹è§„èŒƒæä¾› group å±æ€§æ¥åˆ›å»ºèŠ‚ç‚¹ç»„ï¼Œç„¶ååœ¨è¡¨è¾¾å¼ä¸­æŒ‰åç§°å¼•ç”¨è¯¥ç»„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;const groupSchema = new Schema({
  nodes: {
    doc: {content: &amp;quot;block+&amp;quot;},
    paragraph: {group: &amp;quot;block&amp;quot;, content: &amp;quot;text*&amp;quot;},
    blockquote: {group: &amp;quot;block&amp;quot;, content: &amp;quot;block+&amp;quot;},
    text: {}
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œçš„Â &lt;code&gt;block+&lt;/code&gt;Â ç›¸å½“äºÂ &lt;code&gt;(paragraph | blockquote)+&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å»ºè®®åœ¨å…·æœ‰å—å†…å®¹çš„èŠ‚ç‚¹ä¸­å§‹ç»ˆéœ€è¦è‡³å°‘ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„ &lt;code&gt;doc&lt;/code&gt; å’Œ &lt;code&gt;blockquote&lt;/code&gt;ï¼‰ï¼Œå› ä¸ºå½“èŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œæµè§ˆå™¨å°†å®Œå…¨æŠ˜å èŠ‚ç‚¹ï¼Œä¸æ–¹ä¾¿ç¼–è¾‘&lt;/p&gt;

&lt;p&gt;èŠ‚ç‚¹åœ¨ or-è¡¨è¾¾å¼ä¸­çš„æ˜¾ç¤ºé¡ºåºéå¸¸é‡è¦ã€‚ä¸ºéå¯é€‰èŠ‚ç‚¹åˆ›å»ºé»˜è®¤å®ä¾‹æ—¶ï¼Œä¾‹å¦‚ï¼Œä¸ºäº†ç¡®ä¿åœ¨æ›¿æ¢æ­¥éª¤åæ–‡æ¡£ä»ç¬¦åˆæ¨¡å¼ï¼Œå°†ä½¿ç”¨è¡¨è¾¾å¼ä¸­çš„ç¬¬ä¸€ä¸ªç±»å‹ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªç»„ï¼Œåˆ™ä½¿ç”¨ç»„ä¸­çš„ç¬¬ä¸€ä¸ªç±»å‹ï¼ˆç”±ç»„æˆå‘˜åœ¨èŠ‚ç‚¹æ˜ å°„ä¸­æ˜¾ç¤ºçš„é¡ºåºç¡®å®šï¼‰ã€‚å¦‚æœæˆ‘åœ¨ç¤ºä¾‹éª¨æ¶ä¸­åˆ‡æ¢ &lt;code&gt;paragraph&lt;/code&gt; å’ŒÂ &lt;code&gt;blockquote&lt;/code&gt; çš„ä½ç½®ï¼Œç¼–è¾‘å™¨å°è¯•åˆ›å»ºä¸€ä¸ªå—èŠ‚ç‚¹æ—¶ï¼Œä½ ä¼šå¾—åˆ°å †æ ˆæº¢å‡º - å®ƒä¼šåˆ›å»ºä¸€ä¸ªÂ &lt;code&gt;blockquote&lt;/code&gt; èŠ‚ç‚¹ï¼Œå…¶å†…å®¹è‡³å°‘éœ€è¦ä¸€ä¸ªå—ï¼Œå› æ­¤å®ƒä¼šå°è¯•åˆ›å»ºå¦ä¸€ä¸ª &lt;code&gt;blockquote&lt;/code&gt; ä½œä¸ºå†…å®¹ï¼Œ ç­‰ç­‰&lt;/p&gt;

&lt;p&gt;åº“ä¸­çš„èŠ‚ç‚¹æ“ä½œå‡½æ•°å¹¶éæ¯ä¸ªéƒ½ä¼šæ£€æŸ¥å®ƒæ˜¯å¦æ­£åœ¨å¤„ç†æœ‰æ•ˆçš„å†…å®¹ - é«˜å±‚æ¬¡çš„æ¦‚å¿µï¼Œä¾‹å¦‚ è½¬æ¢ï¼ˆtransformsï¼‰ä¼šï¼Œä½†åŸå§‹èŠ‚ç‚¹åˆ›å»ºæ–¹æ³•é€šå¸¸ä¸ä¼šï¼Œè€Œæ˜¯è´Ÿè´£ä¸ºå…¶è°ƒç”¨è€…æä¾›åˆç†çš„è¾“å…¥ã€‚å®Œå…¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚ NodeType.create æ¥åˆ›å»ºå…·æœ‰æ— æ•ˆå†…å®¹çš„èŠ‚ç‚¹ã€‚å¯¹äºåœ¨åˆ‡ç‰‡è¾¹ç¼˜ &lt;code&gt;æ‰“å¼€&lt;/code&gt; çš„èŠ‚ç‚¹ï¼Œè¿™ç”šè‡³æ˜¯åˆç†çš„äº‹æƒ…ã€‚æœ‰ä¸€ä¸ªå•ç‹¬çš„ createChecked æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªäº‹å check æ–¹æ³•ï¼Œå¯ç”¨äºæ–­è¨€ç»™å®šèŠ‚ç‚¹çš„å†…å®¹æ˜¯æœ‰æ•ˆçš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ ‡è®°-marks&#34;&gt;æ ‡è®° Marks&lt;/h3&gt;

&lt;p&gt;æ ‡è®°ç”¨äºå‘å†…è”å†…å®¹æ·»åŠ é¢å¤–æ ·å¼æˆ–å…¶ä»–ä¿¡æ¯ã€‚éª¨æ¶å¿…é¡»å£°æ˜å…è®¸çš„æ‰€æœ‰æ ‡è®°ç±»å‹ã€‚&lt;strong&gt;æ ‡è®°ç±»å‹&lt;/strong&gt;Â æ˜¯ä¸ &lt;strong&gt;èŠ‚ç‚¹ç±»å‹&lt;/strong&gt; éå¸¸ç›¸ä¼¼çš„å¯¹è±¡ï¼Œç”¨äºæ ‡è®°æ ‡è®°å¯¹è±¡å¹¶æä¾›å…¶ä»–ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå…·æœ‰å†…è”å†…å®¹çš„èŠ‚ç‚¹å…è®¸å°†éª¨æ¶ä¸­å®šä¹‰çš„æ‰€æœ‰æ ‡è®°åº”ç”¨äºå…¶å­é¡¹ã€‚ä½ å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹è§„èŒƒä¸Šçš„ marks å±æ€§å¯¹å…¶è¿›è¡Œé…ç½®&lt;/p&gt;

&lt;p&gt;è¿™æœ‰ä¸€ä¸ªç®€å•çš„éª¨æ¶ï¼Œæ”¯æŒæ®µè½ä¸­æ–‡æœ¬çš„ strong å’Œ emphasis æ ‡è®°ï¼Œä½†ä¸æ”¯æŒæ ‡é¢˜ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;const markSchema = new Schema({
  nodes: {
    doc: {content: &amp;quot;block+&amp;quot;},
    paragraph: {group: &amp;quot;block&amp;quot;, content: &amp;quot;text*&amp;quot;, marks: &amp;quot;_&amp;quot;},
    heading: {group: &amp;quot;block&amp;quot;, content: &amp;quot;text*&amp;quot;, marks: &amp;quot;&amp;quot;},
    text: {inline: true}
  },
  marks: {
    strong: {},
    em: {}
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ ‡è®°é›†è¢«è§£é‡Šä¸ºä»¥ç©ºæ ¼åˆ†éš”çš„æ ‡è®°åç§°æˆ–æ ‡è®°ç»„å­—ç¬¦ä¸² â€” &lt;code&gt;_&lt;/code&gt; å……å½“é€šé…ç¬¦ï¼Œç©ºå­—ç¬¦ä¸²å¯¹åº”äºç©ºé›†&lt;/p&gt;

&lt;h3 id=&#34;å±æ€§-attributes&#34;&gt;å±æ€§ Attributes&lt;/h3&gt;

&lt;p&gt;æ–‡æ¡£éª¨æ¶è¿˜å®šä¹‰äº†æ¯ä¸ªèŠ‚ç‚¹æˆ–æ ‡è®°å…·æœ‰çš„å±æ€§ã€‚å¦‚æœä½ çš„èŠ‚ç‚¹ç±»å‹éœ€è¦å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ ‡é¢˜èŠ‚ç‚¹çš„çº§åˆ«ï¼Œé‚£å°±æœ€å¥½ä½¿ç”¨å±æ€§&lt;/p&gt;

&lt;p&gt;å±æ€§é›†å¯ä»¥è®¤ä¸ºå°±æ˜¯æ™®é€šå¯¹è±¡ï¼Œå…·æœ‰é¢„å®šä¹‰ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æˆ–æ ‡è®°ï¼‰å±æ€§é›†ï¼ŒåŒ…å«ä»»ä½• JSON å¯åºåˆ—åŒ–å€¼ã€‚è¦æŒ‡å®šå®ƒå…è®¸çš„å±æ€§ï¼Œè¯·ä½¿ç”¨èŠ‚ç‚¹ä¸­çš„å¯é€‰ attrs å­—æ®µæˆ–æ ‡è®°è§„èŒƒ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;heading: {
  content: &amp;quot;text*&amp;quot;,
  attrs: {level: {default: 1}}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ä¸Šé¢çš„éª¨æ¶ä¸­ï¼Œæ ‡é¢˜èŠ‚ç‚¹çš„æ¯ä¸ªå®ä¾‹éƒ½å°†å…·æœ‰ level å±æ€§ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º 1&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸æŒ‡å®šå±æ€§é»˜è®¤å€¼ï¼Œåœ¨å°è¯•åˆ›å»ºæ­¤ç±»èŠ‚ç‚¹åˆä¸ä¼ å±æ€§æ—¶å°†å¼•å‘é”™è¯¯ã€‚åœ¨æ»¡è¶³æ¨¡å¼çº¦æŸæ¡ä»¶ä¸‹è¿›è¡Œè½¬æ¢æˆ–è°ƒç”¨ createAndFill æ—¶ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨åº“ç”Ÿæˆæ­¤ç±»èŠ‚ç‚¹å¹¶å¡«å……&lt;/p&gt;

&lt;h3 id=&#34;åºåˆ—åŒ–ä¸è§£æ-serialization-and-parsing&#34;&gt;åºåˆ—åŒ–ä¸è§£æ Serialization and Parsing&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­ç¼–è¾‘å®ƒä»¬ï¼Œå¿…é¡»èƒ½å¤Ÿåœ¨æµè§ˆå™¨ DOM ä¸­è¡¨ç¤ºæ–‡æ¡£èŠ‚ç‚¹ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ node spec ä¸­çš„ &lt;code&gt;toDOM&lt;/code&gt; å­—æ®µåŒ…å«æœ‰å…³éª¨æ¶ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ DOM è¡¨ç¤ºçš„ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;è¯¥å­—æ®µåº”åŒ…å«ä¸€ä¸ªå‡½æ•°ï¼Œå½“ä»¥èŠ‚ç‚¹ä½œä¸ºå‚æ•°è°ƒç”¨æ—¶ï¼Œè¯¥å‡½æ•°è¿”å›è¯¥èŠ‚ç‚¹çš„DOM ç»“æ„çš„æè¿°ã€‚è¿™å¯ä»¥æ˜¯ç›´æ¥ DOM èŠ‚ç‚¹æˆ–æè¿°å®ƒçš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;const schema = new Schema({
  nodes: {
    doc: {content: &amp;quot;paragraph+&amp;quot;},
    paragraph: {
      content: &amp;quot;text*&amp;quot;,
      toDOM(node) { return [&amp;quot;p&amp;quot;, 0] }
    },
    text: {}
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¡¨è¾¾å¼Â &lt;code&gt;[â€œpâ€, 0]&lt;/code&gt;Â å£°æ˜äº†ä¸€ä¸ªæ®µè½ä¼šè¢«æ¸²æŸ“æˆ HTMLÂ &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt;Â æ ‡ç­¾ã€‚é›¶æ˜¯ä¸€ä¸ªã€Œå­”ã€ç”¨æ¥è¡¨ç¤ºå†…å®¹è¢«æ¸²æŸ“çš„åœ°æ–¹ï¼Œä½ è¿˜å¯ä»¥åœ¨æ ‡è®°åç§°åé¢åŒ…å«å…·æœ‰ HTML å±æ€§çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š&lt;code&gt;[&amp;quot;div&amp;quot;, {class: &amp;quot;c&amp;quot;}, 0]&lt;/code&gt;ã€‚å¶èŠ‚ç‚¹åœ¨å…¶ DOM è¡¨ç¤ºä¸­ä¸éœ€è¦ã€Œæ´ã€ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å†…å®¹&lt;/p&gt;

&lt;p&gt;Mark specs å…è®¸ç±»ä¼¼äº toDOM æ–¹æ³•ï¼Œä½†å®ƒä»¬éœ€è¦æ¸²æŸ“æˆç›´æ¥åŒ…è£…å†…å®¹çš„å•ä¸ªæ ‡è®°ï¼Œå› æ­¤å†…å®¹å§‹ç»ˆç›´æ¥åœ¨è¿”å›çš„èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”ä¸éœ€è¦æŒ‡å®šã€Œå­”ã€&lt;/p&gt;

&lt;p&gt;ä½ å¯èƒ½ç»å¸¸éœ€è¦ä» DOM æ•°æ®ä¸­Â *è§£æ*Â æ–‡æ¡£ï¼Œä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å°†æŸäº›å†…å®¹ç²˜è´´æˆ–æ‹–åŠ¨åˆ°ç¼–è¾‘å™¨ä¸­æ—¶ã€‚æ¨¡å‹ï¼ˆModelï¼‰ æ¨¡å—å…·æœ‰ç›¸åº”çš„åŠŸèƒ½ï¼Œå»ºè®®ä½ ä½¿ç”¨ &lt;code&gt;parseDOM&lt;/code&gt; å±æ€§ç›´æ¥åœ¨éª¨æ¶ä¸­åŒ…å«è§£æä¿¡æ¯&lt;/p&gt;

&lt;p&gt;è¿™å¯ä»¥åˆ—å‡ºä¸€ä¸ªè§£æè§„åˆ™æ•°ç»„ï¼Œå®ƒæè¿°æ˜ å°„åˆ°ç»™å®šèŠ‚ç‚¹æˆ–æ ‡è®°çš„ DOM ç»“æ„ã€‚ä¾‹å¦‚ï¼ŒåŸºç¡€éª¨æ¶å…·æœ‰ä»¥ä¸‹è¡¨ç¤ºÂ emphasis æ ‡è®°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;parseDOM: [
  {tag: &amp;quot;em&amp;quot;},                 // Match &amp;lt;em&amp;gt; nodes
  {tag: &amp;quot;i&amp;quot;},                  // and &amp;lt;i&amp;gt; nodes
  {style: &amp;quot;font-style=italic&amp;quot;} // and inline &#39;font-style: italic&#39;
]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è§£æè§„åˆ™ä¸­æ ‡è®°çš„å€¼å¯ä»¥æ˜¯ CSS é€‰æ‹©å™¨ï¼Œå› æ­¤ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;div.myclass&lt;/code&gt; ä¹‹ç±»çš„æ“ä½œã€‚åŒæ ·ï¼Œstyle å±æ€§åŒ¹é…å†…è” CSS æ ·å¼&lt;/p&gt;

&lt;p&gt;å½“éª¨æ¶åŒ…å« parseDOM æ³¨è§£æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ DOMParser.fromSchema ä¸ºå…¶åˆ›å»ºDOMParser å¯¹è±¡ã€‚è¿™æ˜¯ç”±ç¼–è¾‘å™¨å®Œæˆçš„ï¼Œç”¨äºåˆ›å»ºé»˜è®¤å‰ªè´´æ¿è§£æå™¨ï¼Œä½†ä½ ä¹Ÿå¯ä»¥è¦†å†™å®ƒ&lt;/p&gt;

&lt;p&gt;æ–‡æ¡£è¿˜å¸¦æœ‰å†…ç½®çš„ JSON åºåˆ—åŒ–æ ¼å¼ã€‚ä½ å¯ä»¥åœ¨æ–‡æ¡£ä¸Šè°ƒç”¨ toJSON ä»¥è·å–å¯ä»¥å®‰å…¨åœ°ä¼ é€’ç»™ JSON.stringify çš„å¯¹è±¡ï¼Œå¹¶ä¸”éª¨æ¶å¯¹è±¡å…·æœ‰å°†æ­¤è¡¨ç¤ºå½¢å¼è§£æå›æ–‡æ¡£çš„ nodeFromJSON æ–¹æ³•&lt;/p&gt;

&lt;h3 id=&#34;æ‰©å±•ä¸€ä¸ªéª¨æ¶-extending-a-schema&#34;&gt;æ‰©å±•ä¸€ä¸ªéª¨æ¶Â Extending a schema&lt;/h3&gt;

&lt;p&gt;ä¼ é€’ç»™ Schema æ„é€ å‡½æ•°çš„ nodes å’ŒÂ marks é€‰é¡¹é‡‡ç”¨äº† OrderedMap å¯¹è±¡ä»¥åŠçº¯ JavaScript å¯¹è±¡ã€‚éª¨æ¶çš„ spec.nodes å’Œ spec.marks å±æ€§å§‹ç»ˆæ˜¯ä¸€ç»„ OrderedMapï¼Œå¯ä»¥ç”¨ä½œå…¶å®ƒéª¨æ¶çš„åŸºç¡€&lt;/p&gt;

&lt;p&gt;æ­¤ç±»æ˜ å°„æ”¯æŒè®¸å¤šæ–¹æ³•ä»¥æ–¹ä¾¿åœ°åˆ›å»ºæ›´æ–°ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è°ƒç”¨ &lt;code&gt;schema.markSpec.remove(â€œblockquoteâ€)&lt;/code&gt; æ¥æ´¾ç”Ÿä¸€ç»„æ²¡æœ‰ blockquote èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œç„¶åå¯ä»¥å°†å…¶ä½œä¸ºæ–°éª¨æ¶çš„èŠ‚ç‚¹å­—æ®µä¼ å…¥&lt;/p&gt;

&lt;p&gt;schema-list æ¨¡å—å¯¼å‡ºä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼Œå°†è¿™äº›æ¨¡å—å¯¼å‡ºçš„èŠ‚ç‚¹æ·»åŠ åˆ°èŠ‚ç‚¹é›†ä¸­&lt;/p&gt;

&lt;h2 id=&#34;æ–‡æ¡£è½¬æ¢-document-transformations&#34;&gt;æ–‡æ¡£è½¬æ¢ Document transformations&lt;/h2&gt;

&lt;p&gt;è½¬æ¢æ˜¯ ProseMirror å·¥ä½œæ–¹å¼çš„æ ¸å¿ƒã€‚å®ƒä»¬æ„æˆäº†äº‹åŠ¡çš„åŸºç¡€ï¼Œè½¬æ¢ä½¿å¾—å†å²è¿½è¸ªå’Œåä½œç¼–è¾‘æˆä¸ºå¯èƒ½&lt;/p&gt;

&lt;h3 id=&#34;ä¸ºä»€ä¹ˆ-why&#34;&gt;ä¸ºä»€ä¹ˆ Why?&lt;/h3&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ”¹å˜æ–‡æ¡£ï¼Ÿæˆ–è€…è‡³å°‘åˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œç„¶åå°†å…¶æ”¾å…¥ç¼–è¾‘å™¨ä¸­ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æœ‰å‡ ä¸ªåŸå› ã€‚ä¸€ä¸ªæ˜¯ä»£ç æ¸…æ™°åº¦ã€‚ä¸å¯å˜æ•°æ®ç»“æ„ç¡®å®ä½¿å¾—ä»£ç æ›´ç®€å•ã€‚ä½†æ˜¯ï¼Œè½¬æ¢ç³»ç»Ÿçš„ä¸»è¦å·¥ä½œæ˜¯ç•™ä¸‹æ›´æ–°çš„ç—•è¿¹ï¼Œä»¥å€¼çš„å½¢å¼è¡¨ç¤ºæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åˆ°æ–°ç‰ˆæœ¬æ‰€é‡‡å–çš„å„ä¸ªæ­¥éª¤&lt;/p&gt;

&lt;p&gt;æ’¤æ¶ˆå†å²è®°å½•å¯ä»¥ä¿å­˜è¿™äº›æ­¥éª¤å¹¶åè½¬åº”ç”¨å®ƒä»¬ä»¥ä¾¿åŠæ—¶è¿”å›ï¼ˆProseMirror å®ç°é€‰æ‹©æ€§æ’¤æ¶ˆï¼Œè¿™æ¯”ä»…å›æ»šåˆ°å…ˆå‰çŠ¶æ€æ›´å¤æ‚ï¼‰&lt;/p&gt;

&lt;p&gt;åä½œç¼–è¾‘ç³»ç»Ÿå°†è¿™äº›æ­¥éª¤å‘é€ç»™å…¶ä»–ç¼–è¾‘å™¨ï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡æ–°æ’åºï¼Œä»¥ä¾¿æ¯ä¸ªäººæœ€ç»ˆéƒ½ä½¿ç”¨ç›¸åŒçš„æ–‡æ¡£&lt;/p&gt;

&lt;p&gt;æ›´ä¸€èˆ¬åœ°è¯´ï¼Œç¼–è¾‘å™¨æ’ä»¶èƒ½å¤Ÿæ£€æŸ¥æ¯ä¸ªæ›´æ”¹å¹¶å¯¹å…¶è¿›è¡Œå“åº”æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¸ºäº†ä¿æŒå…¶è‡ªèº«çŠ¶æ€ä¸ç¼–è¾‘å™¨çš„å…¶ä½™çŠ¶æ€ä¿æŒä¸€è‡´&lt;/p&gt;

&lt;h3 id=&#34;æ­¥éª¤-steps&#34;&gt;æ­¥éª¤ Steps&lt;/h3&gt;

&lt;p&gt;å¯¹æ–‡æ¡£çš„æ›´æ–°ä¼šåˆ†è§£ä¸ºæ­¥éª¤ï¼ˆstepï¼‰æ¥æè¿°ä¸€æ¬¡æ›´æ–°ã€‚é€šå¸¸ä¸éœ€è¦ä½ ç›´æ¥ä½¿ç”¨è¿™äº›ï¼Œä½†äº†è§£å®ƒä»¬çš„å·¥ä½œæ–¹å¼å¾ˆæœ‰ç”¨&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ä½¿ç”¨ &lt;code&gt;ReplaceStep&lt;/code&gt; æ¥æ›¿æ¢ä¸€ä»½æ–‡æ¡£ï¼Œæˆ–è€…ä½¿ç”¨Â &lt;code&gt;AddMarkStep&lt;/code&gt; æ¥ç»™æŒ‡å®šçš„èŒƒå›´ï¼ˆRangeï¼‰æ·»åŠ æ ‡è®°&lt;/p&gt;

&lt;p&gt;å¯ä»¥å°†æ­¥éª¤åº”ç”¨äºæ–‡æ¡£æ¥æˆæ–°æ–‡æ¡£&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;console.log(myDoc.toString()) // â†’ p(&amp;quot;hello&amp;quot;)
// A step that deletes the content between positions 3 and 5
let step = new ReplaceStep(3, 5, Slice.empty)
let result = step.apply(myDoc)
console.log(result.doc.toString()) // â†’ p(&amp;quot;heo&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åº”ç”¨ä¸€ä¸ªæ­¥éª¤æ˜¯ä¸€ä»¶ç›¸å¯¹å¥‡æ€ªçš„è¿‡ç¨‹ â€”Â å®ƒæ²¡æœ‰åšä»»ä½•å·§å¦™çš„äº‹æƒ…ï¼Œæ¯”å¦‚æ’å…¥èŠ‚ç‚¹ä»¥ä¿ç•™éª¨æ¶çš„çº¦æŸï¼Œæˆ–è€…è½¬æ¢åˆ‡ç‰‡ä»¥ä½¿å…¶é€‚åº”çº¦æŸã€‚è¿™æ„å‘³ç€åº”ç”¨æ­¥éª¤å¯èƒ½ä¼šå¤±è´¥ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ å°è¯•ä»…åˆ é™¤èŠ‚ç‚¹çš„æ‰“å¼€æ ‡è®°ï¼Œè¿™ä¼šä½¿æ ‡è®°å¤±è¡¡ï¼Œè¿™å¯¹ä½ æ¥è¯´æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ apply è¿”å›ä¸€ä¸ª result å¯¹è±¡çš„åŸå› ï¼Œresult å¯¹è±¡åŒ…å«ä¸€ä¸ªæ–°æ–‡æ¡£æˆ–è€…ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯&lt;/p&gt;

&lt;p&gt;ä½ é€šå¸¸ä¼šä½¿ç”¨å·¥å…·å‡½æ•°æ¥ç”Ÿæˆæ­¥éª¤ï¼Œè¿™æ ·å°±ä¸å¿…æ‹…å¿ƒç»†èŠ‚&lt;/p&gt;

&lt;h3 id=&#34;è½¬æ¢-transforms&#34;&gt;è½¬æ¢ Transforms&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªç¼–è¾‘åŠ¨ä½œå¯ä»¥äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ï¼ˆstepï¼‰ã€‚å¤„ç†ä¸€ç³»åˆ—æ­¥éª¤æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª &lt;code&gt;Transform&lt;/code&gt; å¯¹è±¡ï¼ˆæˆ–è€…ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨æ•´ä¸ªç¼–è¾‘å™¨çŠ¶æ€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code&gt;Transaction&lt;/code&gt;ï¼Œå®ƒæ˜¯ &lt;code&gt;Transform&lt;/code&gt; çš„å­ç±»ï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let tr = new Transform(myDoc)
tr.delete(5, 7) // Delete between position 5 and 7
tr.split(5)     // Split the parent node at position 5
console.log(tr.doc.toString()) // The modified document
console.log(tr.steps.length)   // â†’ 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¤§å¤šæ•°è½¬æ¢æ–¹æ³•éƒ½è¿”å›è½¬æ¢æœ¬èº«ï¼Œæ–¹ä¾¿é“¾å¼è°ƒç”¨Â &lt;code&gt;tr.delete(5,7).split(5)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¼šæœ‰å¾ˆå¤šå…³äºè½¬æ¢çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œåˆ é™¤ã€æ›¿æ¢ã€æ·»åŠ ã€åˆ é™¤æ ‡è®°ï¼Œä»¥åŠç»´æŠ¤æ ‘å‹ç»“æ„çš„æ–¹æ³•å¦‚ åˆ†å‰²ã€åˆå¹¶ã€åŒ…è£¹ç­‰&lt;/p&gt;

&lt;h3 id=&#34;æ˜ å°„-mapping&#34;&gt;æ˜ å°„ Mapping&lt;/h3&gt;

&lt;p&gt;å½“ä½ å¯¹æ–‡æ¡£è¿›è¡Œæ›´æ”¹æ—¶ï¼ŒæŒ‡å‘è¯¥æ–‡æ¡£çš„æŒ‡é’ˆå¯èƒ½ä¼šå˜æˆæ— æ•ˆæˆ–å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„æ ·å­äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦åé¢çš„æ‰€æœ‰ä½ç½®éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªæ—§ä½ç½®ä¹‹å‰çš„æ ‡è®°ã€‚åŒæ ·ï¼Œå¦‚æœåˆ é™¤æ–‡æ¡£ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œåˆ™æŒ‡å‘è¯¥å†…å®¹çš„æ‰€æœ‰ä½ç½®ç°åœ¨éƒ½ä¼šå¤±æ•ˆ&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ç»å¸¸éœ€è¦ä¿ç•™æ–‡æ¡£æ›´æ”¹çš„ä½ç½®ï¼Œä¾‹å¦‚é€‰åŒºè¾¹ç•Œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ­¥éª¤å¯ä»¥ä¸ºä½ æä¾›ä¸€ä¸ªå­—å…¸æ˜ å°„ï¼Œå¯ä»¥åœ¨åº”ç”¨è¯¥æ­¥éª¤ä¹‹å‰å’Œä¹‹åè¿›è¡Œè½¬æ¢å¹¶ä¸”åº”ç”¨åº”è¯¥æ­¥éª¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let step = new ReplaceStep(4, 6, Slice.empty) // Delete 4-5
let map = step.getMap()
console.log(map.map(8)) // â†’ 6
console.log(map.map(2)) // â†’ 2 (nothing changes before the change)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è½¬æ¢å¯¹è±¡ä¼šè‡ªåŠ¨å¯¹å…¶ä¸­çš„æ­¥éª¤ï¼ˆstepï¼‰ç´¯åŠ ä¸€ç³»åˆ—çš„å­—å…¸ï¼Œä½¿ç”¨ä¸€ç§å«åšÂ &lt;strong&gt;æ˜ å°„&lt;/strong&gt;Â çš„æŠ½è±¡ï¼Œå®ƒæ”¶é›†äº†ä¸€ç³»åˆ—çš„æ­¥éª¤å­—å…¸æ¥å¸®åŠ©ä½ ä¸€æ¬¡æ€§æ˜ å°„å®ƒä»¬&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;let tr = new Transaction(myDoc)
tr.split(10)    // split a node, +2 tokens at 10
tr.delete(2, 5) // -3 tokens at 2
console.log(tr.mapping.map(15)) // â†’ 14
console.log(tr.mapping.map(6))  // â†’ 3
console.log(tr.mapping.map(10)) // â†’ 9
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¹¶ä¸æ˜¯å®Œå…¨æ¸…æ¥šåº”è¯¥å°†ç»™å®šä½ç½®æ˜ å°„åˆ°ä»€ä¹ˆä½ç½®ã€‚è€ƒè™‘ä¸Šé¢ç¤ºä¾‹çš„æœ€åä¸€è¡Œä»£ç ã€‚ä½ç½® 10 æ°å¥½æŒ‡å‘æˆ‘ä»¬åˆ†å‰²èŠ‚ç‚¹çš„åœ°æ–¹ï¼Œæ’å…¥ä¸¤ä¸ªæ ‡è¯†ã€‚å®ƒåº”è¯¥è¢«æ˜ å°„åˆ°æ’å…¥å†…å®¹åé¢è¿˜æ˜¯å‰é¢ï¼Ÿä¾‹å­ä¸­æ˜æ˜¾æ˜¯æ˜ å°„åˆ°æ’å…¥å†…å®¹åé¢&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯æœ‰æ—¶å€™ä½ éœ€è¦ä¸€äº›å…¶å®ƒçš„è¡Œä¸ºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ map æ–¹æ³•æœ‰ç¬¬äºŒä¸ªå‚æ•° &lt;code&gt;bias&lt;/code&gt; çš„åŸå› ï¼Œä½ å¯ä»¥è®¾ç½®æˆ -1 å½“å†…å®¹è¢«æ’å…¥åˆ°å‰é¢æ—¶ä¿æŒä½ çš„ä½ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;console.log(tr.mapping.map(10, -1)) // â†’ 7
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;rebasing&#34;&gt;Rebasing&lt;/h3&gt;

&lt;p&gt;å½“ä½¿ç”¨æ­¥éª¤å’Œä½ç½®æ˜ å°„æ—¶ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªå˜æ›´è¿½è¸ªçš„åŠŸèƒ½ï¼Œæˆ–è€…ç»™åä½œç¼–è¾‘ç¬¦åŠ ä¸€äº›åŠŸèƒ½ï¼Œä½ å¯èƒ½å°±ä¼šé‡åˆ°ä½¿ç”¨ rebase æ­¥éª¤çš„åœºæ™¯&lt;/p&gt;

&lt;p&gt;â€¦ï¼ˆæœ¬å°èŠ‚è¯‘è€…å¹¶æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œæš‚ä¸ç¿»è¯‘ï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒ&lt;a href=&#34;http://prosemirror.net/docs/guide/#transform.rebasing&#34; title=&#34;prosemirror - transform.rebasing&#34;&gt;åŸæ–‡&lt;/a&gt;ï¼‰&lt;/p&gt;

&lt;h2 id=&#34;ç¼–è¾‘å™¨çŠ¶æ€-the-editor-state&#34;&gt;ç¼–è¾‘å™¨çŠ¶æ€ The editor state&lt;/h2&gt;

&lt;p&gt;ç¼–è¾‘çš„çŠ¶æ€ç”±ä»€ä¹ˆæ„æˆï¼Ÿå½“ç„¶ï¼Œä½ æœ‰è‡ªå·±çš„æ–‡æ¡£ã€‚è¿˜æœ‰å½“å‰çš„é€‰åŒºã€‚ä¾‹å¦‚å½“ä½ éœ€è¦ç¦ç”¨æˆ–å¯ç”¨ä¸€ä¸ªæ ‡è®°ä½†è¿˜æ²¡åœ¨è¯¥æ ‡è®°ä¸Šè¾“å…¥å†…å®¹æ—¶ï¼Œéœ€è¦æœ‰ä¸€ç§æ–¹æ³•æ¥å­˜å‚¨å½“å‰æ ‡è®°é›†å·²æ›´æ”¹çš„æƒ…å†µ&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªÂ ProseMirror çš„çŠ¶æ€ç”±ä¸‰ä¸ªä¸»è¦çš„ç»„ä»¶æ„æˆï¼š&lt;code&gt;doc&lt;/code&gt;, &lt;code&gt;selection&lt;/code&gt;Â å’Œ &lt;code&gt;storedMarks&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;import {schema} from &amp;quot;prosemirror-schema-basic&amp;quot;
import {EditorState} from &amp;quot;prosemirror-state&amp;quot;

let state = EditorState.create({schema})
console.log(state.doc.toString()) // An empty paragraph
console.log(state.selection.from) // 1, the start of the paragraph
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯æ’ä»¶å¯èƒ½ä¹Ÿæœ‰å­˜å‚¨çŠ¶æ€çš„éœ€æ±‚ â€” ä¾‹å¦‚ï¼Œæ’¤æ¶ˆå†å²è®°å½•å¿…é¡»ä¿ç•™å…¶å˜æ›´è®°å½•ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‰€æœ‰æ¿€æ´»çš„æ’ä»¶ä¹Ÿè¢«å­˜æ”¾åœ¨çŠ¶æ€ä¸­çš„åŸå› ï¼Œå¹¶ä¸”è¿™äº›æ’ä»¶å¯ä»¥ç”¨äºå­˜å‚¨è‡ªèº«çŠ¶æ€çš„æ§½ï¼ˆslotsï¼‰&lt;/p&gt;

&lt;h3 id=&#34;é€‰åŒº-selection&#34;&gt;é€‰åŒºÂ Selection&lt;/h3&gt;

&lt;p&gt;ProseMirror æ”¯æŒå‡ ç§é€‰åŒºç±»å‹ï¼ˆå¹¶å…è®¸ä¸‰æ–¹ä»£ç å®šä¹‰æ–°çš„é€‰åŒºç±»å‹ï¼‰ã€‚é€‰åŒºå°±æ˜¯Â &lt;code&gt;Selection&lt;/code&gt; ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚å°±åƒæ–‡æ¡£å’Œå…¶å®ƒçŠ¶æ€ç›¸å…³çš„å€¼ä¸€æ ·ï¼Œå®ƒä»¬æ˜¯ä¸å¯å˜çš„ â€” æƒ³æ”¹å˜é€‰åŒºï¼Œå°±å¾—åˆ›å»ºä¸€ä¸ªæ–°çš„é€‰åŒºå¯¹è±¡è®©æ–°çš„çŠ¶æ€å…³è”å®ƒ&lt;/p&gt;

&lt;p&gt;é€‰åŒºè‡³å°‘åŒ…å«ä¸€ä¸ªå¼€å§‹ï¼ˆ&lt;code&gt;.from&lt;/code&gt;ï¼‰å’Œä¸€ä¸ªç»“æŸï¼ˆ&lt;code&gt;.to&lt;/code&gt;ï¼‰åšä¸ºå½“å‰æ–‡æ¡£çš„ä½ç½®æŒ‡é’ˆã€‚è®¸å¤šé€‰åŒºè¿˜åŒºåˆ†é€‰åŒºçš„ &lt;code&gt;anchor&lt;/code&gt;ï¼ˆä¸å¯ç§»åŠ¨çš„ï¼‰å’Œ &lt;code&gt;head&lt;/code&gt;ï¼ˆå¯ç§»åŠ¨çš„ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå±æ€§åœ¨æ¯ä¸ªé€‰åŒºå¯¹è±¡ä¸Šéƒ½å­˜åœ¨&lt;/p&gt;

&lt;p&gt;æœ€å¸¸è§çš„é€‰åŒºç±»å‹æ˜¯æ–‡æœ¬é€‰åŒºï¼ˆtext selectionï¼‰ï¼Œå®ƒç”¨äºå¸¸è§„çš„å…‰æ ‡ï¼ˆå½“ &lt;code&gt;anchor&lt;/code&gt; å’Œ &lt;code&gt;head&lt;/code&gt; ä¸€æ ·æ—¶ï¼‰æˆ–è€…é€‰æ‹©çš„æ–‡æœ¬ã€‚æ–‡æœ¬é€‰åŒºä¸¤ç«¯å¿…é¡»æ˜¯å†…è”ä½ç½®ï¼Œæ¯”å¦‚ æŒ‡å‘å†…è”å†…å®¹çš„èŠ‚ç‚¹&lt;/p&gt;

&lt;p&gt;æ ¸å¿ƒåº“åŒæ ·ä¹Ÿæ”¯æŒèŠ‚ç‚¹é€‰åŒºï¼ˆnode selectionsï¼‰ï¼Œå½“ä¸€ä¸ªæ–‡æ¡£èŠ‚ç‚¹è¢«é€‰æ‹©ï¼Œä½ å°±èƒ½å¾—åˆ°å®ƒï¼Œæ¯”å¦‚ï¼Œå½“ä½ æŒ‰ä¸‹ ctrl æˆ–è€… cmd é”®çš„åŒæ—¶å†ç”¨é¼ æ ‡ç‚¹å‡»ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹åˆ°ç»“æŸçš„é€‰åŒº&lt;/p&gt;

&lt;h3 id=&#34;äº‹åŠ¡-transactions-1&#34;&gt;äº‹åŠ¡Â Transactions&lt;/h3&gt;

&lt;p&gt;åœ¨æ­£å¸¸çš„ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œæ–°çŠ¶æ€å°†ä»å®ƒä»¬ä¹‹å‰çš„çŠ¶æ€æ´¾ç”Ÿè€Œæ¥ã€‚ä½†æ˜¯æŸäº›æƒ…å†µä¾‹å¤–ï¼Œä¾‹å¦‚ ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„çŠ¶æ€æ¥åˆåŒ–åŒ–ä¸€ä¸ªæ–°æ–‡æ¡£&lt;/p&gt;

&lt;p&gt;é€šè¿‡å°†ä¸€ä¸ªäº‹åŠ¡åº”ç”¨äºç°æœ‰çŠ¶æ€ï¼Œæ¥ç”Ÿæˆæ–°çŠ¶ç„¶åè¿›è¡ŒçŠ¶æ€æ›´æ–°ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå®ƒä»¬åªå‘ç”Ÿä¸€æ¬¡ï¼šç»™å®šæ—§çŠ¶æ€å’Œäº‹åŠ¡ï¼Œä¸ºçŠ¶æ€ä¸­çš„æ¯ä¸ªç»„ä»¶è®¡ç®—ä¸€ä¸ªæ–°å€¼ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªæ–°çš„çŠ¶æ€å€¼ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let tr = state.tr
console.log(tr.doc.content.size) // 25
tr.insertText(&amp;quot;hello&amp;quot;) // Replaces selection with &#39;hello&#39;
let newState = state.apply(tr)
console.log(tr.doc.content.size) // 30
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;Transaction&lt;/code&gt; æ˜¯Â &lt;code&gt;Transform&lt;/code&gt; çš„å­ç±»ï¼Œå®ƒç»§æ‰¿äº†æ„å»ºä¸€ä¸ªæ–‡æ¡£çš„æ–¹æ³•ï¼Œå³ åº”ç”¨æ­¥éª¤åˆ°åˆå§‹æ–‡æ¡£ä¸­ã€‚å¦å¤–ä¸€ç‚¹ï¼Œäº‹åŠ¡ä¼šè¿½è¸ªé€‰åŒºå’Œå…¶å®ƒçŠ¶æ€ç›¸å…³çš„ç»„ä»¶ï¼Œå®ƒæä¾›äº†ä¸€äº›å’Œé€‰åŒºç›¸å…³çš„ä¾¿æ·æ–¹æ³•ï¼Œä¾‹å¦‚ &lt;code&gt;replaceSelection&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åˆ›å»ºäº‹åŠ¡çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ç¼–è¾‘å™¨çŠ¶æ€å¯¹è±¡ä¸Šçš„ &lt;code&gt;tr getter&lt;/code&gt;ã€‚è¿™å°†åŸºäºå½“å‰çŠ¶æ€åˆ›å»ºä¸€ä¸ªç©ºäº‹åŠ¡ï¼Œç„¶åä½ å¯ä»¥å‘å…¶æ·»åŠ æ­¥éª¤å’Œå…¶ä»–æ›´æ–°&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—§é€‰åŒºé€šè¿‡æ¯ä¸ªæ­¥éª¤æ˜ å°„ä»¥ç”Ÿæˆæ–°é€‰åŒºï¼Œä½†å¯ä»¥ä½¿ç”¨ &lt;code&gt;setSelection&lt;/code&gt; æ˜¾å¼è®¾ç½®æ–°é€‰åŒº&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let tr = state.tr
console.log(tr.selection.from) // â†’ 10
tr.delete(6, 8)
console.log(tr.selection.from) // â†’ 8 (moved back)
tr.setSelection(TextSelection.create(tr.doc, 3))
console.log(tr.selection.from) // â†’ 3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ ·åœ°ï¼Œåœ¨æ–‡æ¡£æˆ–é€‰åŒºæ›´æ”¹åä¼šè‡ªåŠ¨æ¸…é™¤æ¿€æ´»çš„æ ‡è®°é›†ï¼Œå¹¶å¯ä½¿ç”¨ &lt;code&gt;setStoredMarks&lt;/code&gt; æˆ–Â &lt;code&gt;ensureMarks&lt;/code&gt;Â æ–¹æ³•è®¾ç½®&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œ&lt;code&gt;scrollIntoView&lt;/code&gt; æ–¹æ³•å¯ç”¨äºç¡®ä¿åœ¨ä¸‹æ¬¡ç»˜åˆ¶çŠ¶æ€æ—¶ï¼Œé€‰åŒºå†…å®¹å°†æ»šåŠ¨åˆ°è§†å›¾ä¸­ã€‚å¤§å¤šæƒ…å†µä¸‹éƒ½éœ€è¦æ‰§è¡Œæ­¤æ“ä½œ&lt;/p&gt;

&lt;p&gt;ä¸ &lt;code&gt;Transform&lt;/code&gt; æ–¹æ³•ä¸€æ ·ï¼Œè®¸å¤š &lt;code&gt;Transaction&lt;/code&gt; æ–¹æ³•éƒ½ä¼šè¿”å›äº‹åŠ¡æœ¬èº«ï¼Œä»¥æ–¹ä¾¿é“¾å¼è°ƒç”¨&lt;/p&gt;

&lt;h3 id=&#34;æ’ä»¶-plugins-1&#34;&gt;æ’ä»¶Â Plugins&lt;/h3&gt;

&lt;p&gt;å½“åˆ›å»ºä¸€ä¸ªæ–°çŠ¶æ€æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæ’ä»¶æ•°ç»„æŒ‚è½½åˆ°ä¸Šé¢ã€‚è¿™äº›æ’ä»¶å°†è¢«åº”ç”¨åœ¨è¿™ä¸ªæ–°çŠ¶æ€ä»¥åŠå®ƒçš„æ´¾ç”ŸçŠ¶æ€ä¸Šï¼Œè¿™ä¼šå½±å“åˆ°äº‹åŠ¡çš„åº”ç”¨ä»¥åŠåŸºäºè¿™ä¸ªçŠ¶æ€çš„ç¼–è¾‘å™¨è¡Œä¸º&lt;/p&gt;

&lt;p&gt;æ’ä»¶æ˜¯ &lt;code&gt;Plugin&lt;/code&gt;Â ç±»çš„å®ä¾‹ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œæœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ç»™ç¼–è¾‘å™¨è§†å›¾æ·»åŠ ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚ å¤„ç†æŸäº›äº‹ä»¶ã€‚å¤æ‚ä¸€ç‚¹çš„å°±å¦‚æ·»åŠ ä¸€ä¸ªæ–°çš„çŠ¶æ€åˆ°ç¼–è¾‘å™¨å¹¶åŸºäºäº‹åŠ¡æ›´æ–°å®ƒ&lt;/p&gt;

&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡æ¥æŒ‡å®šå®ƒçš„è¡Œä¸ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let myPlugin = new Plugin({
  props: {
    handleKeyDown(view, event) {
      console.log(&amp;quot;A key was pressed!&amp;quot;)
      return false // We did not handle this
    }
  }
})

let state = EditorState.create({schema, plugins: [myPlugin]})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ä¸€ä¸ªæ’ä»¶éœ€è¦ä»–è‡ªå·±çš„çŠ¶æ€æ§½æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª &lt;code&gt;state&lt;/code&gt; å±æ€§ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let transactionCounter = new Plugin({
  state: {
    init() { return 0 },
    apply(tr, value) { return value + 1 }
  }
})

function getTransactionCount(state) {
  return transactionCounter.getState(state)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¤ºä¾‹ä¸­çš„æ’ä»¶å®šä¹‰äº†ä¸€ä¸ªéå¸¸ç®€å•çš„çŠ¶æ€ï¼Œå®ƒåªè®¡ç®—å·²ç»åº”ç”¨äºæŸä¸ªçŠ¶æ€çš„äº‹åŠ¡æ•°ã€‚è¾…åŠ©å‡½æ•°ä½¿ç”¨æ’ä»¶çš„ &lt;code&gt;getState&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºä»ç¼–è¾‘å™¨çš„çŠ¶æ€å¯¹è±¡ä¸­ï¼ˆæ’ä»¶ä½œç”¨åŸŸå¤–ï¼‰è·å–æ’ä»¶çŠ¶æ€&lt;/p&gt;

&lt;p&gt;å› ä¸ºç¼–è¾‘å™¨çŠ¶æ€æ˜¯æŒä¹…åŒ–ï¼ˆä¸å¯å˜ï¼‰çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ’ä»¶çŠ¶æ€æ˜¯è¯¥å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æ’ä»¶çŠ¶æ€å€¼å¿…é¡»æ˜¯ä¸å¯å˜çš„ã€‚å³éœ€è¦æ›´æ”¹ï¼Œä»–ä»¬çš„ &lt;code&gt;apply&lt;/code&gt; æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªæ–°å€¼ï¼Œè€Œä¸æ˜¯æ›´æ”¹æ—§å€¼ï¼Œå¹¶ä¸”å…¶ä»–ä»£ç æ˜¯ä¸å¯ä»¥æ›´æ”¹å®ƒä»¬çš„&lt;/p&gt;

&lt;p&gt;å¯å¯¹äºæ’ä»¶è€Œè¨€å‘äº‹åŠ¡æ·»åŠ ä¸€äº›é¢å¤–ä¿¡æ¯æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œæ’¤é”€å†å²è®°å½•åœ¨æ‰§è¡Œå®é™…æ’¤æ¶ˆæ—¶ä¼šæ ‡è®°ç”Ÿæˆçš„äº‹åŠ¡ï¼Œä»¥ä¾¿åœ¨æ’ä»¶å¯ä»¥è¯†åˆ«åˆ°ï¼Œè€Œä¸ä»…ä»…æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°æ’¤æ¶ˆå †æ ˆï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬å¤„ç†å®ƒï¼Œä»æ’¤æ¶ˆï¼ˆundoï¼‰å †æ ˆä¸­åˆ é™¤é¡¶éƒ¨é¡¹ï¼Œç„¶ååŒæ—¶å°†æ­¤äº‹åŠ¡æ·»åŠ åˆ°é‡åšï¼ˆredoï¼‰å †æ ˆ&lt;/p&gt;

&lt;p&gt;ä¸ºæ­¤ï¼Œäº‹åŠ¡å…è®¸é™„åŠ å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ–°æˆ‘ä»¬çš„äº‹åŠ¡è®¡æ•°å™¨æ’ä»¶ï¼Œè¿‡æ»¤é‚£äº›è¢«æ ‡è®°è¿‡çš„äº‹åŠ¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let transactionCounter = new Plugin({
  state: {
    init() { return 0 },
    apply(tr, value) {
      if (tr.getMeta(transactionCounter)) return value
      else return value + 1
    }
  }
})

function markAsUncounted(tr) {
  tr.setMeta(transactionCounter, true)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;metadata çš„å±æ€§é”®å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¦é¿å…å‘½åå†²çªï¼Œå»ºè®®ä½¿ç”¨æ’ä»¶å¯¹è±¡ã€‚æœ‰ä¸€äº›å±æ€§ååº“ä¸­å·²ç»å®šä¹‰è¿‡äº†ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;addToHistory&lt;/code&gt;Â å¯ä»¥è®¾ç½®æˆ &lt;code&gt;false&lt;/code&gt;Â è¡¨ç¤ºäº‹åŠ¡ä¸å¯ä»¥è¢«æ’¤æ¶ˆï¼Œå½“å¤„ç†ä¸€ä¸ªç²˜è´´åŠ¨ä½œæ—¶ï¼Œç¼–è¾‘å™¨å°†åœ¨äº‹åŠ¡ä¸Šè®¾ç½® &lt;code&gt;paste&lt;/code&gt;Â å±æ€§ä¸º &lt;code&gt;true&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;è§†å›¾ç»„ä»¶-the-view-component&#34;&gt;è§†å›¾ç»„ä»¶ The view component&lt;/h2&gt;

&lt;p&gt;ProseMirror ç¼–è¾‘å™¨è§†å›¾æ˜¯ä¸€ä¸ª UI ç»„ä»¶ï¼Œå®ƒå‘ç”¨æˆ·æ˜¾ç¤ºç¼–è¾‘å™¨çŠ¶æ€ï¼Œå¹¶å…è®¸å®ƒä»¬è¿›&lt;/p&gt;

&lt;p&gt;æ ¸å¿ƒè§†å›¾ç»„ä»¶ä½¿ç”¨çš„ &lt;em&gt;ç¼–è¾‘æ“ä½œ&lt;/em&gt; çš„å®šä¹‰ç›¸å½“ç‹­ä¹‰ â€” å®ƒç”¨æ¥ç›´æ¥å¤„ç†ä¸ç¼–è¾‘å™¨ç•Œé¢çš„äº¤äº’ï¼Œæ¯”å¦‚ è¾“å…¥ã€ç‚¹å‡»ã€å¤åˆ¶ã€ç²˜è´´ã€æ‹–æ‹½ï¼Œé™¤æ­¤ä¹‹å¤–å°±æ²¡äº†ã€‚è¿™è¡¨ç¤ºæ ¸å¿ƒè§†å›¾ç»„ä»¶å¹¶ä¸æ”¯æŒä¸€äº›é«˜çº§ä¸€ç‚¹çš„åŠŸèƒ½ï¼Œåƒ èœå•ã€å¿«æ·é”®ç»‘å®š ç­‰ã€‚æƒ³å®ç°è¿™ç±»åŠŸèƒ½å¿…é¡»ä½¿ç”¨æ’ä»¶&lt;/p&gt;

&lt;h3 id=&#34;å¯ç¼–è¾‘çš„-dom-editable-dom&#34;&gt;å¯ç¼–è¾‘çš„ DOM Editable DOM&lt;/h3&gt;

&lt;p&gt;æµè§ˆå™¨å…è®¸æˆ‘ä»¬æŒ‡å®š DOM çš„æŸäº›éƒ¨åˆ†æ˜¯å¯ç¼–è¾‘çš„ï¼Œè¿™å…·æœ‰å…è®¸æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢èšç„¦æˆ–è€…åˆ›å»ºé€‰åŒºï¼Œå¹¶ä¸”å¯ä»¥è¾“å…¥å†…å®¹ã€‚è§†å›¾åˆ›å»ºå…¶æ–‡æ¡£çš„ DOM å±•ç¤ºï¼ˆé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æ¨¡å¼çš„ &lt;code&gt;toDOM&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œå¹¶ä½¿å…¶å¯ç¼–è¾‘ã€‚å½“èšç„¦åˆ°å¯ç¼–è¾‘çš„å…ƒç´ æ—¶ï¼ŒProseMirror ç¡®ä¿ DOM é€‰åŒºå¯¹åº”äºç¼–è¾‘å™¨çŠ¶æ€ä¸­çš„é€‰åŒº&lt;/p&gt;

&lt;p&gt;å®ƒè¿˜ä¼šæ³¨å†Œå¾ˆå¤šæˆ‘DOMåœ¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶å°†äº‹ä»¶è½¬æ¢ä¸ºé€‚å½“çš„äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼Œç²˜è´´æ—¶ï¼Œç²˜è´´çš„å†…å®¹å°†è¢«è§£æä¸º ProseMirror æ–‡æ¡£åˆ‡ç‰‡ï¼Œç„¶åæ’å…¥åˆ°æ–‡æ¡£ä¸­&lt;/p&gt;

&lt;p&gt;å¾ˆå¤šäº‹ä»¶ä¹Ÿä¼šæŒ‰åŸç”Ÿæ–¹å¼è§¦å‘ï¼Œç„¶åæ‰ä¼šç”± ProseMirror çš„æ•°æ®æ¨¡å‹é‡æ–°è§£é‡Šã€‚æµè§ˆå™¨å¾ˆæ“…é•¿å¤„ç†å…‰æ ‡å’Œé€‰åŒºç­‰é—®é¢˜ï¼ˆå½“éœ€è¦ä¸¤å‘æ“ä½œæ—¶åˆ™å˜å¾—å›°éš¾æ— æ¯”ï¼‰ï¼Œæ‰€ä»¥å¤§å¤šæ•°ä¸å…‰æ ‡ç›¸å…³çš„é”®å’Œé¼ æ ‡æ“ä½œéƒ½ç”±æµè§ˆå™¨å¤„ç†ï¼Œä¹‹å ProseMirror ä¼šæ£€æŸ¥å½“å‰ DOM é€‰åŒºå¯¹åº”ç€ä»€ä¹ˆæ ·çš„æ–‡æœ¬é€‰åŒºç±»å‹ã€‚å¦‚æœè¯¥é€‰åŒºä¸å½“å‰é€‰åŒºä¸åŒï¼Œåˆ™é€šè¿‡è°ƒåº¦ä¸€æ¬¡äº‹åŠ¡æ¥æ›´æ–°é€‰åŒº&lt;/p&gt;

&lt;p&gt;ç”šè‡³åƒè¾“å…¥è¿™ç§åŠ¨ä½œé€šå¸¸éƒ½ç•™ç»™æµè§ˆå™¨å¤„ç†ï¼Œå› ä¸ºå¹²æ‰°å®ƒå¾€å¾€ä¼šç ´åè¯¸å¦‚ æ‹¼å†™æ£€æŸ¥ï¼ŒæŸäº›æ‰‹æœºä¸Šå•è¯è‡ªåŠ¨é¦–å­—æ¯å¤§å†™ï¼Œä»¥åŠå…¶å®ƒä¸€äº›è®¾é…åŸç”Ÿçš„åŠŸèƒ½ã€‚å½“æµè§ˆå™¨æ›´æ–° DOM æ—¶ï¼Œç¼–è¾‘å™¨ä¼šæ³¨æ„åˆ°ï¼Œå¹¶é‡æ–°è§£ææ–‡æ¡£çš„æ›´æ”¹çš„éƒ¨åˆ†ï¼Œå¹¶å°†å·®å¼‚è½¬æ¢ä¸ºä¸€æ¬¡äº‹åŠ¡&lt;/p&gt;

&lt;h3 id=&#34;æ•°æ®æµ-data-flow&#34;&gt;æ•°æ®æµ Data flow&lt;/h3&gt;

&lt;p&gt;ç¼–è¾‘å™¨è§†å›¾å±•ç¤ºç»™å®šçš„ç¼–è¾‘å™¨çŠ¶æ€ï¼Œå½“å‘ç”ŸæŸäº›äº‹ä»¶æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡å¹¶å¹¿æ’­å®ƒã€‚ç„¶åï¼Œè¿™ä¸ªäº‹åŠ¡é€šå¸¸ç”¨äºåˆ›å»ºæ–°çŠ¶æ€ï¼Œè¯¥çŠ¶æ€è°ƒç”¨å®ƒçš„Â &lt;code&gt;updateState&lt;/code&gt; æ–¹æ³•å°†çŠ¶æ€è¿”å›ç»™è§†å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://img13.360buyimg.com/devfe/jfs/t1/28003/16/976/56676/5c0e39efEba5293ce/3ad15f7825aa70c8.png&#34; alt=&#34;prosemirror-4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å¾ªç¯æ•°æ®æµï¼Œåœ¨ JavaScript çš„ä¸–ç•Œï¼Œé€šå¸¸ä¼šç«‹å³å¤„ç†äº‹ä»¶å¤„ç†å™¨ï¼ˆå¯ä»¥ç†è§£æˆå‘½ä»¤å¼çš„è§¦å‘äº‹ä»¶åç›´æ¥æ“ä½œ DOMï¼‰ï¼Œåè€…å¾€å¾€ä¼šåˆ›å»ºæ›´å¤æ‚çš„æ•°æ®æµç½‘ç»œï¼ˆæ•°æ®æµå¯èƒ½æ˜¯åŒå‘çš„ï¼Œä¸å®¹æ˜“ç†è§£ä¸ç»´æŠ¤ï¼‰&lt;/p&gt;

&lt;p&gt;ç”±äºäº‹åŠ¡æ˜¯é€šè¿‡Â &lt;code&gt;dispatchTransaction&lt;/code&gt; å±æ€§æ¥è°ƒåº¦çš„ï¼Œæ‰€ä»¥æ‹¦è½½äº‹åŠ¡æ˜¯å¯ä»¥çš„åšåˆ°çš„ï¼Œä¸ºäº†å°†è¿™ä¸ªå¾ªç¯æ•°æ®æµè¿æ¥åˆ°ä¸€ä¸ªæ›´å¤§çš„å‘¨æœŸ â€”Â å¦‚æœä½ çš„æ•´ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨è¿™æ ·çš„æ•°æ®æµæ¨¡å‹ï¼Œå°±åƒç±»ä¼¼ Redux çš„ä½“ç³»ç»“æ„ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ ProseMirror çš„äº‹åŠ¡ä¸ä¸»åŠ¨ä½œè°ƒåº¦ï¼ˆmain action-dispatchingï¼‰å‘¨æœŸé›†æˆèµ·æ¥ï¼Œå°† ProseMirror çš„çŠ¶æ€ä¿ç•™åœ¨ä½ åº”ç”¨ç¨‹åºçš„ &lt;code&gt;store&lt;/code&gt; ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;// The app&#39;s state
let appState = {
  editor: EditorState.create({schema}),
  score: 0
}

let view = new EditorView(document.body, {
  state: appState.editor,
  dispatchTransaction(transaction) {
    update({type: &amp;quot;EDITOR_TRANSACTION&amp;quot;, transaction})
  }
})

// A crude app state update function, which takes an update object,
// updates the `appState`, and then refreshes the UI.
function update(event) {
  if (event.type == &amp;quot;EDITOR_TRANSACTION&amp;quot;)
    appState.editor = appState.editor.apply(event.transaction)
  else if (event.type == &amp;quot;SCORE_POINT&amp;quot;)
    appState.score++
  draw()
}

// An even cruder drawing function
function draw() {
  document.querySelector(&amp;quot;#score&amp;quot;).textContent = appState.score
  view.updateState(appState.editor)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;é«˜æ•ˆæ›´æ–°-efficient-updating&#34;&gt;é«˜æ•ˆæ›´æ–° Efficient updating&lt;/h3&gt;

&lt;p&gt;ä¸€ç§ç®€å•çš„å®ç° &lt;code&gt;updateState&lt;/code&gt; çš„æ–¹æ³•æ˜¯åœ¨æ¯æ¬¡è°ƒç”¨æ–‡æ¡£æ—¶é‡ç»˜æ–‡æ¡£ã€‚ä½†å¯¹äºå¤§å‹æ–‡æ¡£è€Œè¨€ï¼Œè¿™ä¼šå˜å¾—å¾ˆæ…¢&lt;/p&gt;

&lt;p&gt;ç”±äºåœ¨æ›´æ–°æœŸé—´ï¼Œè§†å›¾å¯ä»¥è®¿é—®åˆ°æ—§æ–‡æ¡£å’Œæ–°æ–‡æ¡£ï¼Œå¯ä»¥ç”¨å®ƒä»¬æ¥åšå¯¹æ¯”ï¼Œå•ç‹¬ä¿ç•™æ²¡å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹å¯¹åº”çš„ DOM éƒ¨åˆ†ã€‚ ProseMirror å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œè¿™å°†ä½¿å¾—å¸¸è§„çš„æ›´æ–°åŠ¨ä½œåªéœ€è¦åšå¾ˆå°‘çš„å·¥ä½œ&lt;/p&gt;

&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ é€šè¿‡æµè§ˆå™¨çš„ç¼–è¾‘æ“ä½œæ·»åŠ åˆ° DOM çš„æ›´æ–°æ–‡æœ¬ã€‚ç¡®ä¿DOM å’ŒçŠ¶æ€ä¸€è‡´ï¼Œæ ¹æœ¬ä¸éœ€è¦ä»»ä½• DOM æ›´æ”¹ï¼ˆå½“ä»¥ä¸€ä¸ªäº‹åŠ¡è¢«å–æ¶ˆï¼Œä¿®æ”¹æ—¶ï¼Œè§†å›¾å°†æ’¤æ¶ˆ DOM æ›´æ”¹ä»¥ç¡®ä¿ DOM å’ŒçŠ¶æ€ä¿æŒåŒæ­¥ï¼‰&lt;/p&gt;

&lt;p&gt;ç±»ä¼¼åœ°ï¼ŒDOM é€‰åŒºä»…åœ¨å®é™…ä¸çŠ¶æ€ä¸­çš„é€‰åŒºä¸åŒæ­¥æ—¶æ‰ä¼šæ›´æ–°ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ç ´åæµè§ˆå™¨åœ¨é€‰åŒºä¸­çš„å„ç§ã€Œéšè— hiddenã€çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨å‘ä¸‹æˆ–å‘ä¸Šç®­å¤´ç©ºè¿‡çŸ­è¡Œæ—¶ï¼Œä½ çš„æ°´å¹³ä½ç½®ä¼šå›åˆ°ä½ è¿›å…¥ä¸‹ä¸€æ¡é•¿è¡Œçš„ä½ç½®ï¼‰&lt;/p&gt;

&lt;h3 id=&#34;å±æ€§-props&#34;&gt;å±æ€§ Props&lt;/h3&gt;

&lt;p&gt;å¤§ä½“ä¸Šè®² Props å¾ˆæœ‰ç”¨ï¼Œè¿™æ˜¯ä» React å­¦è¿‡æ¥çš„ã€‚å±æ€§å°±åƒæ˜¯ UI ç»„ä»¶ä¸­çš„å‚æ•°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç»„ä»¶çš„å±æ€§å®Œå…¨å®šä¹‰å…¶è¡Œä¸º&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let view = new EditorView({
  state: myState,
  editable() { return false }, // Enables read-only behavior
  handleDoubleClick() { console.log(&amp;quot;Double click!&amp;quot;) }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å› æ­¤ï¼Œå½“å‰çš„çŠ¶æ€å°±æ˜¯ä¸€ä¸ªå±æ€§ã€‚å³ä½¿ä¸€æ®µä»£ç æ§åˆ¶äº†ç»„ä»¶å¹¶æ›´æ–°æŸå±æ€§ï¼Œå®ƒä¹Ÿä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çŠ¶æ€ï¼Œå› ä¸ºç»„ä»¶Â &lt;strong&gt;è‡ªå·±&lt;/strong&gt;Â å¹¶æ²¡æœ‰æ”¹å˜å®ƒä»¬ï¼Œ&lt;code&gt;updateState&lt;/code&gt; æ–¹æ³•ä¹Ÿåªæ˜¯æ›´æ–°çŠ¶æ€ä¸­æŸä¸ªå±æ€§çš„ä¸€ç§ç®€å†™&lt;/p&gt;

&lt;p&gt;æ’ä»¶å¯ä»¥å£°æ˜é™¤äº† &lt;code&gt;state&lt;/code&gt; å’Œ &lt;code&gt;dispatchTransaction&lt;/code&gt; ä»¥å¤–çš„ä»»æ„å±æ€§ï¼Œå®ƒä»¬å¯ä»¥ç›´æ¥ä¼ ç»™è§†å›¾&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;function maxSizePlugin(max) {
  return new Plugin({
    props: {
      editable(state) { return state.doc.content.size &amp;lt; max }
    }
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ä¸€ä¸ªç»™å®šçš„å±æ€§è¢«å¤šæ¬¡å£°æ˜æ—¶ï¼Œå®ƒçš„å¤„ç†æ–¹å¼å–å†³äºå±æ€§ç±»å‹ã€‚ç›´æ¥ä¼ å…¥çš„çš„å±æ€§ä¼˜å…ˆï¼Œç„¶åæ¯ä¸ªæ’ä»¶æŒ‰é¡ºåºæ‰§è¡Œã€‚å¯¹äºä¸€äº›å±æ€§è€Œè¨€ï¼Œæ¯”å¦‚Â &lt;code&gt;domParser&lt;/code&gt;ï¼Œåªä¼šä½¿ç”¨ç¬¬ä¸€æ¬¡å£°æ˜çš„å€¼ã€‚å¦‚æœæ˜¯äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æ¥å‘Šè¯‰åº•å±‚äº‹ä»¶ç³»ç»Ÿæ˜¯å¦è¦æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ï¼ˆæ¯”å¦‚ äº‹ä»¶å¤„ç†å‡½æ•°åå› falseï¼Œè¿™è¡¨ç¤ºåº•å±‚äº‹ä»¶ä¸Šç»‘å®šçš„ç›¸åŒäº‹ä»¶å¤„ç†å‡½æ•°å°†ä¸ä¼šè¢«å¤„ç†ï¼‰ï¼Œæœ‰çš„å±æ€§ï¼Œåƒ attributes åˆ™ä¼šåšåˆå¹¶ç„¶åä½¿ç”¨&lt;/p&gt;

&lt;h3 id=&#34;è£…é¥°å™¨-decorations&#34;&gt;è£…é¥°å™¨ Decorations&lt;/h3&gt;

&lt;p&gt;è£…é¥°ä½¿ä½ å¯ä»¥æ§åˆ¶è§†å›¾ç»˜åˆ¶æ–‡æ¡£çš„æ–¹å¼ã€‚å®ƒä»¬æ˜¯é€šè¿‡ä» è£…é¥°å™¨ å±æ€§è¿”å›å€¼åˆ›å»ºçš„ï¼Œæœ‰ä¸‰ç§ç±»å‹&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹è£…é¥°å™¨&lt;/strong&gt; Node decorations - å°†æ ·å¼æˆ–å…¶ä»– DOM å±æ€§æ·»åŠ åˆ°å•ä¸ªèŠ‚ç‚¹çš„ DOM å±•ç¤ºä¸­&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‚ä»¶è£…é¥°å™¨&lt;/strong&gt;Â Widget decorations - åœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸æ˜¯å®é™…æ–‡æ¡£çš„ä¸€éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…è”è£…é¥°å™¨&lt;/strong&gt;Â Inline decorations - æ·»åŠ æ ·å¼æˆ–å±æ€§ï¼Œå°±åƒèŠ‚ç‚¹è£…é¥°å™¨ä¸€æ ·ï¼Œä½†æ˜¯ä¼šæ·»åŠ åˆ°ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å†…è”èŠ‚ç‚¹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿæœ‰æ•ˆåœ°ç»˜åˆ¶å’Œæ¯”è¾ƒè£…é¥°å™¨ï¼Œå®ƒä»¬éœ€è¦ä½œä¸ºè£…é¥°æ•°ç»„æä¾›ï¼ˆè¿™æ˜¯ä¸€ç§æ¨¡ä»¿å®é™…æ–‡æ¡£çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨é™æ€ &lt;code&gt;create&lt;/code&gt; æ–¹æ³•åˆ›å»ºï¼Œæä¾›æ–‡æ¡£å’Œè£…é¥°å¯¹è±¡æ•°ç»„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let purplePlugin = new Plugin({
  props: {
    decorations(state) {
      return DecorationSet.create(state.doc, [
        Decoration.inline(0, state.doc.content.size, {style: &amp;quot;color: purple&amp;quot;})
      ])
    }
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½ æœ‰å¾ˆå¤šè£…é¥°å™¨ï¼Œé‚£ä¹ˆæ¯æ¬¡é‡æ–°ç»˜åˆ¶æ—¶éƒ½è¦é‡æ–°åˆ›å»ºè¿™äº›è£…ç½®æˆæœ¬ä¼šå¾ˆé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç»´æŠ¤è£…é¥°å™¨çš„æ¨èæ–¹æ³•æ˜¯å°†æ•°ç»„æ”¾åœ¨æ’ä»¶çš„çŠ¶æ€ä¸­ï¼Œé€šè¿‡æ›´æ”¹å°†å…¶æ˜ å°„åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œå¹¶ä¸”åªåœ¨éœ€è¦æ—¶è¿›è¡Œæ›´æ”¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let specklePlugin = new Plugin({
  state: {
    init(_, {doc}) {
      let speckles = []
      for (let pos = 1; pos &amp;lt; doc.content.size; pos += 4)
        speckles.push(Decoration.inline(pos - 1, pos, {style: &amp;quot;background: yellow&amp;quot;}))
      return DecorationSet.create(doc, speckles)
    },
    apply(tr, set) { return set.map(tr.mapping, tr.doc) }
  },
  props: {
    decorations(state) { return specklePlugin.getState(state) }
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„æ’ä»¶å°†å…¶çŠ¶æ€åˆå§‹åŒ–ä¸ºè£…é¥°å™¨æ•°ç»„ï¼Œè¯¥è£…é¥°å™¨æ•°ç»„å°†ä¼šæ‰§è¡Œæ¯ 4 ä¸ªä½ç½®æ·»åŠ é»„è‰²èƒŒæ™¯ã€‚è¿™ä¸ªä¾‹å­å¯èƒ½å¹¶ä¸æ˜¯éå¸¸æœ‰ç”¨ï¼Œä½†æœ‰ç‚¹ç±»ä¼¼äºçªå‡ºæ˜¾ç¤ºæœç´¢åŒ¹é…æˆ–æ³¨é‡ŠåŒºåŸŸçš„åœºæ™¯&lt;/p&gt;

&lt;p&gt;å½“äº‹åŠ¡åº”ç”¨äºçŠ¶æ€æ—¶ï¼Œæ’ä»¶çŠ¶æ€çš„ apply æ–¹æ³•å°†è£…é¥°å™¨æ•°ç»„å‘å‰æ˜ å°„ï¼Œä½¿è£…é¥°å™¨ä¿æŒåŸä½å¹¶ã€Œé€‚åº”ã€æ–°æ–‡æ¡£å½¢çŠ¶ã€‚é€šè¿‡åˆ©ç”¨è£…é¥°å™¨æ•°ç»„çš„æ ‘å½¢ç»“æ„ä½¿å¾—æ˜ å°„æ–¹æ³•ï¼ˆå…¸å‹çš„å±€éƒ¨å˜åŒ–ï¼‰å˜å¾—é«˜æ•ˆ - æ ‘å½¢ç»“æ„ä¸­åªæœ‰å˜åŒ–çš„éƒ¨åˆ†æ‰ä¼šè¢«å¤„ç†æˆ–è€…é‡å»º&lt;/p&gt;

&lt;p&gt;åœ¨æ’ä»¶çš„å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œapply æ–¹æ³•ä¹Ÿå¯ä»¥æ ¹æ®ä½ åŸºäºæ–°äº‹ä»¶æ·»åŠ æˆ–åˆ é™¤è£…é¥°çš„ä½ç½®è€Œå®šï¼Œæˆ–è€…æ˜¯é€šè¿‡æ£€æµ‹äº‹åŠ¡ä¸­çš„æ›´æ–°ï¼Œæˆ–åŸºäºç‰¹å®šçš„é™„åŠ åˆ°äº‹åŠ¡çš„æ’ä»¶å…ƒæ•°æ®&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œè£…é¥°å±æ€§åªæ˜¯è¿”å›æ’ä»¶çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´è£…é¥°å™¨ä¼šå±•ç¤ºåœ¨è§†å›¾ä¸­&lt;/p&gt;

&lt;h3 id=&#34;èŠ‚ç‚¹è§†å›¾-node-views&#34;&gt;èŠ‚ç‚¹è§†å›¾ Node views&lt;/h3&gt;

&lt;p&gt;è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å½±å“ç¼–è¾‘å™¨è§†å›¾ç»˜åˆ¶æ–‡æ¡£çš„æ–¹å¼ã€‚èŠ‚ç‚¹è§†å›¾å¯ä»¥ä¸ºæ–‡æ¡£ä¸­çš„å„ä¸ªèŠ‚ç‚¹å®šä¹‰ä¸€ç§å¾®å‹çš„ UI ç»„ä»¶ã€‚å®ƒä»¬å…è®¸ä½ å±•ç¤º DOMï¼Œå®šä¹‰æ›´æ–°æ–¹å¼ï¼Œå¹¶ç¼–å†™è‡ªå®šä¹‰ä»£ç ä»¥åŠå“åº”äº‹ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let view = new EditorView({
  state,
  nodeViews: {
    image(node) { return new ImageView(node) }
  }
})

class ImageView {
  constructor(node) {
    // The editor will use this as the node&#39;s DOM representation
    this.dom = document.createElement(&amp;quot;img&amp;quot;)
    this.dom.src = node.attrs.src
    this.dom.addEventListener(&amp;quot;click&amp;quot;, e =&amp;gt; {
      console.log(&amp;quot;You clicked me!&amp;quot;)
      e.preventDefault()
    })
  }

  stopEvent() { return true }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ç¤ºä¾‹ä¸ºå›¾ç‰‡èŠ‚ç‚¹å®šä¹‰äº†è§†å›¾å¯¹è±¡ï¼Œä¸ºå›¾åƒåˆ›å»ºäº†è‡ªå®šä¹‰çš„ DOM èŠ‚ç‚¹ï¼Œæ·»åŠ äº†äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶ä½¿ç”¨ stopEvent æ–¹æ³•å£°æ˜ ProseMirror åº”å¿½ç•¥æ¥è‡ªè¯¥DOM èŠ‚ç‚¹çš„äº‹ä»¶&lt;/p&gt;

&lt;p&gt;é€šå¸¸ä½ å¯èƒ½ä¼šæœ‰ä¸èŠ‚ç‚¹äº¤äº’ä»¥å½±å“æ–‡æ¡£ä¸­çš„å®é™…èŠ‚ç‚¹çš„éœ€æ±‚ã€‚ä½†æ˜¯è¦åˆ›å»ºæ›´æ”¹èŠ‚ç‚¹çš„äº‹åŠ¡ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“è¯¥èŠ‚ç‚¹çš„ä½ç½®ã€‚ä¸ºæ­¤ï¼ŒèŠ‚ç‚¹è§†å›¾å°†ä¼ é€’ä¸€ä¸ª getter å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ç”¨äºæŸ¥è¯¢æ–‡æ¡£ä¸­å½“å‰èŠ‚ç‚¹çš„ä½ç½®ã€‚è®©æˆ‘ä»¬ä¿®æ”¹ç¤ºä¾‹ï¼Œå®ç°å•å‡»èŠ‚ç‚¹æŸ¥è¯¢ä½ è¾“å…¥å›¾åƒçš„ alt æ–‡æœ¬ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let view = new EditorView({
  state,
  nodeViews: {
    image(node, view, getPos) { return new ImageView(node, view, getPos) }
  }
})

class ImageView {
  constructor(node, view, getPos) {
    this.dom = document.createElement(&amp;quot;img&amp;quot;)
    this.dom.src = node.attrs.src
    this.dom.alt = node.attrs.alt
    this.dom.addEventListener(&amp;quot;click&amp;quot;, e =&amp;gt; {
      e.preventDefault()
      let alt = prompt(&amp;quot;New alt text:&amp;quot;, &amp;quot;&amp;quot;)
      if (alt) view.dispatch(view.state.tr.setNodeMarkup(getPos(), null, {
        src: node.attrs.src,
        alt
      }))
    })
  }

  stopEvent() { return true }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;setNodeMarkup&lt;/code&gt; æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ç”¨äºæ›´æ”¹ç»™å®šä½ç½®çš„èŠ‚ç‚¹çš„ç±»å‹æˆ–å±æ€§é›†ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ getPos æŸ¥æ‰¾å›¾åƒçš„å½“å‰ä½ç½®ï¼Œå¹¶ä½¿ç”¨æ–°çš„ alt æ–‡æœ¬ä¸ºå…¶æä¾›æ–°çš„å±æ€§å¯¹è±¡&lt;/p&gt;

&lt;p&gt;èŠ‚ç‚¹æ›´æ–°åï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ä¿æŒèŠ‚ç‚¹å¤–éƒ¨ DOM ç»“æ„ä¸å˜ï¼Œå¹¶å°†å…¶å­é¡¹ä¸æ–°çš„å­å…ƒç´ é›†è¿›è¡Œæ¯”è¾ƒï¼Œæ ¹æ®éœ€è¦æ›´æ–°æˆ–æ›¿æ¢å®ƒä»¬ã€‚èŠ‚ç‚¹è§†å›¾å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰è¡Œä¸ºè¦†ç›–å®ƒï¼Œè¿™å…è®¸æˆ‘ä»¬æ‰§è¡Œç±»ä¼¼äºæ ¹æ®å†…å®¹æ›´æ”¹æ®µè½ç±»ï¼ˆcss classï¼‰å±æ€§çš„æ“ä½œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;let view = new EditorView({
  state,
  nodeViews: {
    paragraph(node) { return new ParagraphView(node) }
  }
})

class ParagraphView {
  constructor(node) {
    this.dom = this.contentDOM = document.createElement(&amp;quot;p&amp;quot;)
    if (node.content.size == 0) this.dom.classList.add(&amp;quot;empty&amp;quot;)
  }

  update(node) {
    if (node.type.name != &amp;quot;paragraph&amp;quot;) return false
    if (node.content.size &amp;gt; 0) this.dom.classList.remove(&amp;quot;empty&amp;quot;)
    else this.dom.classList.add(&amp;quot;empty&amp;quot;)
    return true
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å›¾ç‰‡æ ‡ç­¾ä¸ä¼šæœ‰å­å†…å®¹ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒå®ƒæ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Œä½†æ˜¯æ®µè½æœ‰å­å†…å®¹ã€‚Node view æ”¯æŒä¸¤ç§å¤„ç†å†…å®¹çš„æ–¹å¼ï¼šè¦ä¹ˆä½ è®©Â ProseMirror åº“æ¥ç®¡ç†å®ƒï¼Œè¦ä¹ˆå®Œå…¨ç”±ä½ è‡ªå·±æ¥ç®¡ç†ã€‚å¦‚æœä½ æä¾›ä¸€ä¸ªÂ &lt;code&gt;contentDOM&lt;/code&gt; å±æ€§ï¼ŒProseMirror å°†æŠŠèŠ‚ç‚¹æ¸²æŸ“åˆ°è¿™é‡Œå¹¶å¤„ç†å†…å®¹æ›´æ–°ã€‚å¦‚æœä½ ä¸æä¾›è¿™ä¸ªå±æ€§ï¼Œå†…å®¹å¯¹äºç¼–è¾‘å™¨å°†å˜æˆä¸€ä¸ªé»‘ç›’ï¼Œå†…å®¹å¦‚ä½•å±•ç¤ºå¦‚ä½•äº¤äº’éƒ½å°†å–å†³äºä½ &lt;/p&gt;

&lt;p&gt;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ®µè½å†…å®¹çš„è¡Œä¸ºç±»ä¼¼äºå¸¸è§„å¯ç¼–è¾‘æ–‡æœ¬ï¼Œå› æ­¤contentDOM å±æ€§è¢«å®šä¹‰ä¸ºä¸ dom å±æ€§ç›¸åŒï¼Œå› ä¸ºå†…å®¹éœ€è¦ç›´æ¥æ¸²æŸ“åˆ°å¤–éƒ¨èŠ‚ç‚¹ä¸­&lt;/p&gt;

&lt;p&gt;é­”æœ¯å‘ç”Ÿåœ¨ &lt;code&gt;update&lt;/code&gt; æ–¹æ³•ä¸­ã€‚é¦–å…ˆï¼Œè¯¥æ–¹æ³•è´Ÿè´£å†³å®šæ˜¯å¦å¯ä»¥æ›´æ–°èŠ‚ç‚¹è§†å›¾ä»¥æ˜¾ç¤ºæ–°èŠ‚ç‚¹ã€‚æ­¤æ–°èŠ‚ç‚¹å¯èƒ½æ˜¯ç¼–è¾‘å™¨æ›´æ–°ç®—æ³•å°è¯•ç»˜åˆ¶çš„ä»»ä½•å†…å®¹ï¼Œå› æ­¤ä½ å¿…é¡»éªŒè¯æ­¤èŠ‚ç‚¹æœ‰å¯¹åº”çš„èŠ‚ç‚¹è§†å›¾æ¥å¤„ç†å®ƒ&lt;/p&gt;

&lt;p&gt;ç¤ºä¾‹ä¸­çš„ &lt;code&gt;update&lt;/code&gt; æ–¹æ³•é¦–å…ˆæ£€æŸ¥æ–°èŠ‚ç‚¹æ˜¯å¦ä¸ºæ®µè½ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±é€€å‡ºã€‚ç„¶åå®ƒç¡®ä¿ &lt;code&gt;empty&lt;/code&gt; ç±»å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼Œå…·ä½“å–å†³äºæ–°èŠ‚ç‚¹çš„å†…å®¹ï¼Œè¿”å›trueï¼Œåˆ™è¡¨ç¤ºæ›´æ–°æˆåŠŸï¼ˆæ­¤æ—¶èŠ‚ç‚¹çš„å†…å®¹å°†è¢«æ›´æ–°ï¼‰&lt;/p&gt;

&lt;h2 id=&#34;å‘½ä»¤-commands-1&#34;&gt;å‘½ä»¤ Commands&lt;/h2&gt;

&lt;p&gt;åœ¨ ProseMirror çš„æœ¯è¯­ä¸­ï¼Œå‘½ä»¤æ˜¯å®ç°ç¼–è¾‘æ“ä½œçš„åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŒ‰æŸäº›ç»„åˆé”®æˆ–ä¸èœå•äº¤äº’æ¥æ‰§è¡Œå‘½ä»¤&lt;/p&gt;

&lt;p&gt;å‡ºäºå®é™…åŸå› è€ƒè™‘ï¼Œå‘½ä»¤çš„æ¥å£ç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚ä¸€ä¸ªæ¥æ”¶ &lt;code&gt;state&lt;/code&gt; å’Œ &lt;code&gt;dispatch&lt;/code&gt; å‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;function deleteSelection(state, dispatch) {
  if (state.selection.empty) return false
  dispatch(state.tr.deleteSelection())
  return true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ä¸€ä¸ªå‘½ä»¤éæ­£å¸¸æ‰§è¡Œæ—¶åº”è¯¥è¿”å› falseï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚ç›¸åå¦‚æœè¿”æ­£å¸¸æ‰§è¡Œï¼Œåˆ™åº”è¯¥è°ƒåº¦ä¸€ä¸ªäº‹åŠ¡å¹¶ä¸”è¿”å› trueã€‚ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œå½“ä¸€ä¸ªå‘½ä»¤è¢«ç»‘å®šåˆ°ä¸€ä¸ªå¥ä½å¹¶æ‰§è¡Œæ—¶ï¼Œkeymap æ’ä»¶ä¸­å¯¹åº”äºè¿™ä¸ªå¥ä½çš„äº‹ä»¶å°†ä¼šè¢«é˜»æ­¢&lt;/p&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤ŸæŸ¥è¯¢ä¸€ä¸ªå‘½ä»¤å¯¹äºä¸€ä¸ªçŠ¶æ€ä¸‹æ˜¯å¦å…·æœ‰&lt;strong&gt;å¯æ‰§è¡Œæ€§&lt;/strong&gt;ï¼ˆå¯æ‰§è¡Œä½†åˆä¸é€šè¿‡æ‰§è¡Œæ¥éªŒè¯ï¼‰ï¼Œ&lt;code&gt;dispatch&lt;/code&gt;Â å‚æ•°æ˜¯å¯é€‰çš„ â€” å½“å‘½ä»¤è¢«è°ƒç”¨å¹¶ä¸”æ²¡ä¼ å…¥ dispatch å‚æ•°æ—¶ï¼Œå¦‚æœå‘½ä»¤å…·æœ‰å¯æ‰§è¡Œæ€§ï¼Œé‚£å°±åº”è¯¥ä»€ä¹ˆä¹Ÿä¸åšå¹¶è¿”å› true&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;function deleteSelection(state, dispatch) {
  if (state.selection.empty) return false
  if (dispatch) dispatch(state.tr.deleteSelection())
  return true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªé€‰åŒºå¦å¯ä»¥è¢«åˆ é™¤ï¼Œä½ å¯ä»¥è°ƒç”¨Â &lt;code&gt;deleteSelection(view.state, null)&lt;/code&gt;ï¼Œç„¶è€Œå¦‚æœä½ æƒ³çœŸæ­£æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°±åº”è¯¥è¿™æ ·è°ƒÂ &lt;code&gt;deleteSelection(view.state, view.dispatch)&lt;/code&gt;ã€‚èœå•æ å°±æ˜¯ç”¨è¿™ä¸ªæ¥å†³å®šèœå•æŒ‰é’®çš„å¯ç”¨æ€§çš„&lt;/p&gt;

&lt;p&gt;è¿™ç§è¡Œå¼ä¸‹ï¼Œå‘½ä»¤å¹¶ä¸éœ€è¦è®¿é—®å®é™…çš„ç¼–è¾‘å™¨è§†å›¾ â€” å¤§å¤šæ•°å‘½ä»¤éƒ½ä¸éœ€è¦ï¼Œè¿™æ ·çš„è¯å‘½ä»¤å°±å¯ä»¥åœ¨è®¾ç½®ä¸­åº”ç”¨å’Œæµ‹è¯•è€Œä¸å¿…å…³å¿ƒè§†å›¾æ˜¯å¦å¯ç”¨ã€‚ä½†æ˜¯æœ‰çš„å‘½ä»¤åˆ™ååéœ€è¦ä¸ DOM äº¤äº’ â€” å¯èƒ½éœ€è¦æŸ¥è¯¢æŒ‡å®šçš„ä½ç½®æ˜¯å¦åœ¨æ–‡æœ¬å—å„¿åé¢ï¼Œæˆ–è€…æ‰“å¼€ä¸€ä¸ªç›¸å¯¹äºè§†å›¾å®šä½çš„å¯¹è¯æ¡†ã€‚ä¸ºäº†è§£å†³è¿™ç§éœ€æ±‚ï¼Œå‘½ä»¤è¿˜æä¾›äº†ç¬¬ä¸‰ä¸ªï¼ˆæ•´ä¸ªç¼–è¾‘å™¨è§†å›¾ï¼‰å‚æ•°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;function blinkView(_state, dispatch, view) {
  if (dispatch) {
    view.dom.style.background = &amp;quot;yellow&amp;quot;
    setTimeout(() =&amp;gt; view.dom.style.background = &amp;quot;&amp;quot;, 1000)
  }
  return true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä¾‹å­å¯èƒ½å¹¶ä¸æ˜¯åˆé€‚ï¼Œå› ä¸ºå‘½ä»¤å¹¶æ²¡æœ‰è°ƒåº¦ä¸€æ¬¡äº‹åŠ¡ â€” è°ƒç”¨ä»–ä»¬å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œæ‰€ä»¥Â *é€šå¸¸*Â éœ€è¦è°ƒåº¦ä¸€æ¬¡äº‹åŠ¡ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¸éœ€è¦ï¼Œæ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå±‚ï¼ˆå› ä¸ºè¿™ä¸ªå±‚ä¸åœ¨ç¼–è¾‘å™¨è§†å›¾é‡Œé¢ï¼Œå¹¶ä¸å±äºç¼–è¾‘å™¨çš„çŠ¶æ€ï¼Œæ‰€ä»¥è°ƒåº¦äº‹åŠ¡å°±æ˜¾å¾—å¤šä½™äº†ï¼‰&lt;/p&gt;

&lt;p&gt;prosemirror-commands æ¨¡å—æä¾›äº†å¾ˆå¤šç¼–è¾‘å™¨å‘½ä»¤ï¼Œä»ç®€å•å¦‚Â &lt;code&gt;deleteSelection&lt;/code&gt;Â å‘½ä»¤åˆ°å¤æ‚å¦‚Â &lt;code&gt;joinBackward&lt;/code&gt;Â å‘½ä»¤ï¼Œåè€…å®ç°äº†å—çº§èŠ‚ç‚¹çš„æ‹¼åˆï¼Œå½“ä½ åœ¨æ–‡æœ¬å—å¼€å§‹çš„åœ°æ–¹è§¦å‘ backspace é”®çš„æ—¶å€™å°±ä¼šå‘ç”Ÿã€‚å®ƒä¹Ÿä¼šé™„åŠ ä¸€äº›åŸºæœ¬çš„å¿«æ·é”®ç»‘å®š&lt;/p&gt;

&lt;p&gt;&lt;code&gt;chainCommands&lt;/code&gt; å‡½æ•°å¯ä»¥åˆå¹¶ä¸€ç³»åˆ—çš„å‘½ä»¤å¹¶æ‰§è¡Œç›´åˆ°æŸä¸ªå‘½ä»¤è¿”å› true&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼ŒåŸºç¡€çš„å¿«æ·é”®ç»‘å®šæ¨¡å—ä¸­ï¼Œbackspace ä¼šè¢«ç»‘å®šåˆ°ä¸€ä¸ª&lt;code&gt;å‘½ä»¤é“¾&lt;/code&gt;ä¸Šï¼š1. &lt;code&gt;deleteSelection&lt;/code&gt; å½“é€‰åŒºä¸ä¸ºç©ºæ—¶åˆ é™¤é€‰åŒºï¼›2.Â joinBackward å½“å…‰æ ‡åœ¨æ–‡æœ¬å—å¼€å§‹çš„åœ°æ–¹æ—¶ï¼›3.Â selectNodeBackward é€‰æ‹©é€‰åŒºå‰çš„èŠ‚ç‚¹ï¼Œä»¥é˜²éª¨æ¶ä¸­ä¸å…è®¸æœ‰å¸¸è§„çš„æ‹¼åˆæ“ä½œã€‚å½“è¿™äº›éƒ½ä¸é€‚ç”¨æ—¶ï¼Œå…è®¸æµè§ˆå™¨è¿è¡Œè‡ªå·±çš„ backspace è¡Œä¸ºï¼Œè¿™å¯¹äºæ¸…é™¤æ–‡æœ¬å—å†…å®¹æ˜¯åˆç†çš„&lt;/p&gt;

&lt;p&gt;å‘½ä»¤æ¨¡å—è¿˜å¯¼å‡ºè®¸å¤šå‘½ä»¤æ„é€ å™¨ï¼Œä¾‹å¦‚ &lt;code&gt;toggleMark&lt;/code&gt;ï¼Œå®ƒé‡‡ç”¨æ ‡è®°ç±»å‹å’Œå¯é€‰çš„ä¸€ç»„å±æ€§ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‘½ä»¤å‡½æ•°ï¼Œç”¨äºåˆ‡æ¢å½“å‰é€‰åŒºä¸Šçš„æ ‡è®°&lt;/p&gt;

&lt;p&gt;å…¶ä»–ä¸€äº›æ¨¡å—ä¹Ÿä¼šå¯¼å‡ºå‘½ä»¤å‡½æ•° â€” ä¾‹å¦‚ï¼Œä» history æ¨¡å—ä¸­ &lt;code&gt;undo&lt;/code&gt; å’Œ &lt;code&gt;redo&lt;/code&gt;ã€‚è¦è‡ªå®šä¹‰ç¼–è¾‘å™¨ï¼Œæˆ–å…è®¸ç”¨æˆ·ä¸è‡ªå®šä¹‰æ–‡æ¡£èŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œä½ å¯èƒ½è¿˜éœ€è¦ç¼–å†™è‡ªå®šä¹‰å‘½ä»¤&lt;/p&gt;

&lt;h2 id=&#34;åä½œç¼–è¾‘-collaborative-editing&#34;&gt;åä½œç¼–è¾‘ Collaborative editing&lt;/h2&gt;

&lt;p&gt;å®æ—¶åä½œç¼–è¾‘å…è®¸å¤šäººåŒæ—¶ç¼–è¾‘åŒä¸€æ–‡æ¡£ã€‚å®ƒä»¬æ‰€åšçš„æ›´æ”¹ä¼šç«‹å³åº”ç”¨åˆ°æœ¬åœ°æ–‡æ¡£ï¼Œç„¶åå‘é€ç»™å¯¹ç­‰ï¼ˆpearsï¼‰æ–¹ï¼Œè¿™äº›å¯¹ç­‰æ–¹ä¼šè‡ªåŠ¨åˆå¹¶è¿™äº›æ›´æ”¹ï¼ˆæ— éœ€æ‰‹åŠ¨è§£å†³å†²çªï¼‰ï¼Œä»¥ä¾¿ç¼–è¾‘åŠ¨ä½œå¯ä»¥ä¸é—´æ–­åœ°è¿›è¡Œï¼Œæ–‡æ¡£ä¹Ÿä¼šä¸æ–­åœ°è¢«åˆå¹¶&lt;/p&gt;

&lt;p&gt;è¿™ä¸€èŠ‚å°†ä»‹ç»å¦‚ä½•ç»™ ProseMirror å«æ¥ä¸Šåä½œç¼–è¾‘çš„åŠŸèƒ½&lt;/p&gt;

&lt;h3 id=&#34;ç®—æ³•-algorithm&#34;&gt;ç®—æ³•Â Algorithm&lt;/h3&gt;

&lt;p&gt;ProseMirror çš„åä½œç¼–è¾‘ä½¿ç”¨äº†ä¸€ç§ä¸­å¤®é›†æƒå¼çš„ç³»ç»Ÿï¼Œå®ƒä¼šå†³å®šå“ªä¸ªå˜æ›´ä¼šè¢«åº”ç”¨ã€‚å¦‚æœä¸¤ä¸ªç¼–è¾‘å™¨åŒæ—¶å‘ç”Ÿå˜æ›´ï¼Œä»–ä»¬ä¸¤éƒ½å°†å¸¦ç€è‡ªå·±çš„å˜æ›´è¿›å…¥ç³»ç»Ÿï¼Œç³»ç»Ÿä¼šæ¥å—å…¶ä¸­ä¹‹ä¸€ï¼Œå¹¶ä¸”å¹¿æ’­åˆ°å…¶å®ƒç¼–è¾‘å™¨ä¸­ï¼Œå¦å¤–ä¸€æ–¹çš„å˜æ›´å°†ä¸ä¼šè¢«åº”ç”¨ï¼Œå½“è¿™ä¸ªç¼–è¾‘å™¨æ¥æ”¶åˆ°æ–°çš„å˜æ›´æ—¶ï¼Œå®ƒå°†è¢«åŸºäºå…¶å®ƒç¼–è¾‘å™¨ä¹‹ä¸Šæ‰§è¡Œæœ¬åœ°å˜æ›´çš„ rebase æ“ä½œï¼Œç„¶åå†æ¬¡æäº¤æ›´æ–°&lt;/p&gt;

&lt;h3 id=&#34;æƒé‰´-the-authority&#34;&gt;æƒé‰´ The Authority&lt;/h3&gt;

&lt;p&gt;é›†æƒå¼çš„ç³»ç»Ÿçš„è§’è‰²å…¶å®æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå®ƒåªé¡»åšåˆ°ä»¥ä¸‹å‡ ç‚¹â€¦&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è·Ÿè¸ªå½“å‰æ–‡æ¡£çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æ¥å—ç¼–è¾‘å™¨çš„å˜æ›´ï¼Œå½“å˜æ›´è¢«åº”ç”¨æ—¶ï¼Œæ·»åŠ åˆ°å˜æ›´åˆ—è¡¨ä¸­&lt;/li&gt;
&lt;li&gt;å½“ç»™å®šä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œæä¾›ä¸€ç§ç¼–è¾‘å™¨æ¥å—å˜æ›´çš„æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„é›†æƒå¼çš„ç³»ç»Ÿï¼Œå®ƒåœ¨ä¸ç¼–è¾‘å™¨ç›¸åŒçš„ JavaScript ç¯å¢ƒä¸­è¿è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;class Authority {
  constructor(doc) {
    this.doc = doc
    this.steps = []
    this.stepClientIDs = []
    this.onNewSteps = []
  }

  receiveSteps(version, steps, clientID) {
    if (version != this.steps.length) return

    // Apply and accumulate new steps
    steps.forEach(step =&amp;gt; {
      this.doc = step.apply(this.doc).doc
      this.steps.push(step)
      this.stepClientIDs.push(clientID)
    })
    // Signal listeners
    this.onNewSteps.forEach(function(f) { f() })
  }

  stepsSince(version) {
    return {
      steps: this.steps.slice(version),
      clientIDs: this.stepClientIDs.slice(version)
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç¼–è¾‘å™¨è¯•ç€æäº¤ä»–ä»¬çš„å˜æ›´åˆ°ç³»ç»Ÿæ—¶ï¼Œå¯ä»¥è°ƒç”¨Â &lt;code&gt;receiveSteps&lt;/code&gt;Â æ–¹æ³•ï¼Œä¼ é€’ä»–ä»¬æ¥æ”¶åˆ°çš„æœ€æ–°ç‰ˆæœ¬å·ï¼ŒåŒæ—¶æºå¸¦ç€æ–°çš„å˜æ›´åŠä»–ä»¬è‡ªå·±çš„ client IDï¼ˆç”¨æ¥è¯†åˆ«å˜æ›´æ¥è‡ªå“ªé‡Œï¼‰&lt;/p&gt;

&lt;p&gt;å½“è¿™æ­¥éª¤è¢«æ¥æ”¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šçŸ¥é“è¢«æ¥æ”¶äº†ã€‚å› ä¸ºç³»ç»Ÿä¼šé€šçŸ¥ä»–ä»¬æ–°çš„å¯ç”¨æ­¥éª¤ï¼Œç„¶åå‘é€ç»™ä»–ä»¬è‡ªå·±çš„æ­¥éª¤ã€‚çœŸæ­£çš„å®ç°ä¸­ï¼Œåšä¸ºä¼˜åŒ–é¡¹ï¼Œä½ ä¹Ÿå¯ä»¥è°ƒç”¨Â &lt;code&gt;receiveSteps&lt;/code&gt;Â è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œç„¶åç«‹å³ç¡®è®¤å‘é€çš„æ­¥éª¤ï¼Œä½†æ˜¯è¿™é‡Œç”¨åˆ°çš„ä¸œè¥¿å¿…é¡»è¦åœ¨ä¸å¯é çš„ç½‘ç»œç¯å¢ƒä¸‹ä¿è¯åŒæ­¥&lt;/p&gt;

&lt;p&gt;è¿™ç§æƒé™çš„å®ç°ä¿æŒäº†ä¸€ç³»åˆ—ä¸æ–­å¢é•¿çš„æ­¥éª¤ï¼Œå…¶é•¿åº¦è¡¨ç¤ºå½“å‰ç‰ˆæœ¬&lt;/p&gt;

&lt;h3 id=&#34;åä½œæ¨¡å—-the-collab-module&#34;&gt;åä½œæ¨¡å— The &lt;code&gt;collab&lt;/code&gt; Module&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;collab&lt;/code&gt;Â æ¨¡å—å¯¼å‡ºä¸€ä¸ªÂ &lt;code&gt;collab&lt;/code&gt; å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ’ä»¶ï¼Œè´Ÿè´£è·Ÿè¸ªæœ¬åœ°å˜æ›´ï¼Œæ¥æ”¶è¿œç¨‹å˜æ›´ï¼Œå¹¶å¯¹äºä½•æ—¶å¿…é¡»å°†æŸäº›å†…å®¹å‘é€åˆ°ä¸­å¤®æœºæ„åšå‡ºæŒ‡ç¤º&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;import {EditorState} from &amp;quot;prosemirror-state&amp;quot;
import {EditorView} from &amp;quot;prosemirror-view&amp;quot;
import {schema} from &amp;quot;prosemirror-schema-basic&amp;quot;
import collab from &amp;quot;prosemirror-collab&amp;quot;

function collabEditor(authority, place) {
  let view = new EditorView(place, {
    state: EditorState.create({schema, plugins: [collab.collab()]}),
    dispatchTransaction(transaction) {
      let newState = view.state.apply(transaction)
      view.updateState(newState)
      let sendable = collab.sendableSteps(newState)
      if (sendable)
        authority.receiveSteps(sendable.version, sendable.steps,
                               sendable.clientID)
    }
  })

  authority.onNewSteps.push(function() {
    let newData = authority.stepsSince(collab.getVersion(view.state))
    view.dispatch(
      collab.receiveTransaction(view.state, newData.steps, newData.clientIDs))
  })

  return view
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;collabEditor&lt;/code&gt; å‡½æ•°åˆ›å»ºä¸€ä¸ªåŠ è½½äº†&lt;code&gt;collab&lt;/code&gt; æ’ä»¶çš„ç¼–è¾‘å™¨è§†å›¾ã€‚æ¯å½“çŠ¶æ€æ›´æ–°æ—¶ï¼Œå®ƒéƒ½ä¼šæ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å†…å®¹è¦å‘é€ç»™ç³»ç»Ÿã€‚å¦‚æœæœ‰ï¼Œå°±å‘é€&lt;/p&gt;

&lt;p&gt;å®ƒè¿˜æ³¨å†Œäº†ä¸€ä¸ªå½“æ–°çš„æ­¥éª¤å¯ç”¨æ—¶ç³»ç»Ÿåº”è¯¥è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ¥æ›´æ–°æˆ‘ä»¬çš„æœ¬åœ°ç¼–è¾‘å™¨åæ˜ è¿™äº›æ­¥éª¤çš„çŠ¶æ€&lt;/p&gt;

&lt;p&gt;å½“ä¸€ç»„æ­¥éª¤è¢«ç³»ç»Ÿæ‹’ç»æ—¶ï¼Œå®ƒä»¬å°†ä¸€ç›´ä¿æŒæœªç¡®è®¤çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶é—´æ®µåº”è¯¥ä¼šæ¯”è¾ƒçŸ­ï¼ŒæŒç»­åˆ°æˆ‘ä»¬ä»ç³»ç»Ÿæ”¶åˆ°æ–°çš„æ­¥éª¤ä¹‹åã€‚æ¥ç€ï¼Œå› ä¸º &lt;code&gt;onNewSteps&lt;/code&gt; å›è°ƒè°ƒç”¨ &lt;code&gt;dispatch&lt;/code&gt;ï¼Œ&lt;code&gt;dispatch&lt;/code&gt;Â å†è°ƒç”¨æˆ‘ä»¬çš„ &lt;code&gt;dispatchTransaction&lt;/code&gt; å‡½æ•°ï¼Œä»£ç æ‰ä¼šå°†å°è¯•å†æ¬¡æäº¤å…¶æ›´æ”¹&lt;/p&gt;

&lt;p&gt;è¿™åŸºæœ¬ä¸Šå°±æ˜¯çš„æ‰€æœ‰åä½œæ¨¡å—çš„åŠŸèƒ½äº†ã€‚å½“ç„¶ï¼Œå¯¹äºå¼‚æ­¥æ•°æ®é€šé“ï¼ˆä¾‹å¦‚ä¸Šé¢çš„æ¼”ç¤ºä»£ç ä¸­çš„é•¿è½®è¯¢æˆ– Webå¥—æ¥å­—ï¼‰ï¼Œä½ éœ€è¦æ›´å¤æ‚çš„é€šä¿¡å’ŒåŒæ­¥ä»£ç ï¼Œè€Œä¸”ä½ ä¹Ÿå¯èƒ½éœ€è¦é›†æƒç³»ç»Ÿåœ¨æŸäº›æƒ…å†µä¸‹å¼€å§‹æŠ›å‡ºæ­¥éª¤ï¼Œè€Œä¸è‡³äºå†…å­˜è¢«æ¶ˆè€—å®Œã€‚ä½†æ˜¯è¿™ä¸ªå°ä¾‹å­å¤§æ¦‚ä¹Ÿæè¿°æ¸…æ¥šäº†å®ç°è¿‡ç¨‹&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>jQuery ajax æ–¹æ³• data å‚æ•°é»˜è®¤ encode å¤±è´¥çš„ bug</title>
      <link>https://keelii.com/2018/05/25/jquery-ajax-data-param-auto-encode-bug/</link>
      <pubDate>Fri, 25 May 2018 19:20:04 -0700</pubDate>
      
      <guid>https://keelii.com/2018/05/25/jquery-ajax-data-param-auto-encode-bug/</guid>
      <description>&lt;p&gt;ä½¿ç”¨ jQuery ajax æ–¹æ³•è°ƒç”¨å¼‚æ­¥æ¥å£æ—¶ data å‚æ•°é»˜è®¤ä¼šè¢«æ·»åŠ è½¬ç  &lt;code&gt;encodeURIComponent&lt;/code&gt;ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;$.ajax({
    url: &#39;http://your.domain.com/action&#39;,
    dataType: &#39;jsonp&#39;,
    data: {
        spaces: &#39;a b&#39;,
        other: &#39;&amp;amp;&#39;
    }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä»£ç ä¼šå‘ &lt;code&gt;http://your.domain.com/action?spaces=a+b&amp;amp;other=%26&lt;/code&gt; å‘é€ get è¯·æ±‚ï¼Œå¥‡æ€ªçš„æ˜¯å‚æ•°ä¸­çš„ &lt;code&gt;&amp;amp;&lt;/code&gt; è¢«æ­£ç¡®è½¬ç æˆ &lt;code&gt;%26&lt;/code&gt;ï¼Œä½†æ˜¯  è¢«è½¬æˆäº† &lt;code&gt;+&lt;/code&gt; è€Œä¸æ˜¯ &lt;code&gt;%20&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;çœ‹çœ‹æ­£ç¡®çš„è½¬ç ç»“æœé•¿å•¥æ ·&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;encodeURIComponent(&#39;&amp;amp;&#39;) // =&amp;gt; &amp;quot;%26&amp;quot;
encodeURIComponent(&#39; &#39;) // =&amp;gt; &amp;quot;%20&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ—¢ç„¶ data å‚æ•°é‡Œé¢çš„ key,value éƒ½è¦è¢« encodeURIComponentï¼Œé‚£ä¹ˆå‡ºç°è¿™ç§æƒ…å†µåªèƒ½å»æŸ¥ jQuery æºä»£ç äº†ã€‚jQuery ä¼šè°ƒç”¨ $.param æ–¹æ³•æ¥ç¼–ç  data å‚æ•°ï¼Œå¤§æ¦‚åœ¨ &lt;strong&gt;jQuery-1.7.2&lt;/strong&gt; çš„ &lt;em&gt;(7736)&lt;/em&gt; è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;param: function( a, traditional ) {
    // ...
    } else {
        // If traditional, encode the &amp;quot;old&amp;quot; way (the way 1.3.2 or older
        // did it), otherwise encode params recursively.
        for ( var prefix in a ) {
            buildParams( prefix, a[ prefix ], traditional, add );
        }
    }

    // Return the resulting serialization
    return s.join( &amp;quot;&amp;amp;&amp;quot; ).replace( r20, &amp;quot;+&amp;quot; );
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;param æ–¹æ³•å†…éƒ¨ä¼šå†è°ƒç”¨ &lt;code&gt;buildParams&lt;/code&gt; æ¥æŠŠ data å¯¹è±¡é”®å€¼å¯¹æ·»åŠ ç¼–ç ï¼Œä¸€åˆ‡éƒ½å¾ˆæ­£å¸¸&lt;/p&gt;

&lt;p&gt;ç„¶é¥¿æœ€åä¸€è¡Œ &lt;code&gt;replace( r20, &amp;quot;+&amp;quot; )&lt;/code&gt; æ˜¯ä»€ä¹ˆé¬¼ï¼&lt;code&gt;r20&lt;/code&gt; å˜é‡æ˜¯å†…éƒ¨çš„ä¸€ä¸ªç©ºç™½è½¬ä¹‰ç¬¦çš„æ­£åˆ™ &lt;code&gt;/%20/g&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿™å°±æœ‰ç‚¹æ„æ€äº†ï¼Œä¸ºå•¥æŠŠæ­£ç¡®çš„ç©ºæ ¼ç¼–ç å†è½¬å› &lt;code&gt;+&lt;/code&gt; å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å¤–äº‹ä¸å†³é—® Googleï¼Œæœç´¢ &lt;code&gt;why jquery ajax convert %20 to +&lt;/code&gt; ç»“æœå‘ç°æœ‰ä¸€æ¡ jQuery å®˜æ–¹çš„ github issue: &lt;a href=&#34;https://github.com/jquery/jquery/issues/2658&#34;&gt;Only change %20 to + for application/x-www-form-urlencoded&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;//img11.360buyimg.com/devfe/jfs/t20344/242/259059096/183424/9e8e0f30/5b078bbdN06c75a01.png&#34; alt=&#34;google-why-jquery-convert-space-to-plus&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ ¹æ® issue çš„æè¿°å¤§æ„æ˜¯è¯´ &lt;code&gt;convert %20 to +&lt;/code&gt; è¿™ä¸ªé€»è¾‘åªåº”è¯¥åœ¨ POST è¯·æ±‚çš„æ—¶å€™åšè½¬æ¢ï¼Œè€Œä¸æ˜¯æ‰€æœ‰è¯·æ±‚ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­çš„ jsonp åˆšå¥½æ˜¯ get è¯·æ±‚&lt;/p&gt;

&lt;p&gt;ç»§ç»­å¾€ä¸‹çœ‹æ‰¾åˆ°äº†ä¸€ä¸ª &lt;a href=&#34;https://github.com/dmethvin/jquery/commit/60453ce299a0c84550e70010ceea12d538226bf5&#34;&gt;commit(60453ce)&lt;/a&gt; ä¿®å¤äº†è¿™ä¸ªé—®é¢˜&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;//img14.360buyimg.com/devfe/jfs/t20692/166/263146843/79735/7f45adb2/5b078b49N8f97629d.png&#34; alt=&#34;jquery-param-encode-bug&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ³¨æ„ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç®€å•çš„åœ¨ data å¯¹è±¡ä¼ å…¥çš„æ—¶å€™æ‰‹åŠ¨æ·»åŠ  &lt;code&gt;encodeURIComponent&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;$.ajax({
    url: &#39;http://your.domain.com/action&#39;,
    dataType: &#39;jsonp&#39;,
    data: {
        // é”™è¯¯çš„åšæ³•
        spaces: encodeURIComponent(&#39;a b&#39;),
        other: &#39;&amp;amp;&#39;
    }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœ spaces å‚æ•°æœ‰åˆ«çš„åº”è¯¥è¢«æ­£å¸¸ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ­£å¸¸çš„è¢«ç¼–ç çš„å­—ç¬¦è¢« &lt;strong&gt;ä¸¤æ¬¡&lt;/strong&gt; encodeURIComponentã€‚æ‰€ä»¥è¦æ­£ç¡®è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦ä¿®æ”¹ jQuery æºä»£ç ï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒä¸Šé¢çš„é‚£ä¸ª fix commit&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è§£å†³ seajs parseDependencies æ–¹æ³•å¼•èµ·çš„ä¾èµ–è§£æé”™è¯¯é—®é¢˜</title>
      <link>https://keelii.com/2017/11/03/fix-seajs-parse-dep-bug/</link>
      <pubDate>Fri, 03 Nov 2017 15:51:27 +0000</pubDate>
      
      <guid>https://keelii.com/2017/11/03/fix-seajs-parse-dep-bug/</guid>
      <description>&lt;p&gt;ä½¿ç”¨ seajs çš„è¿‡ç¨‹ä¸­å¶å°”ä¼šå‘ç° require è¿›æ¥çš„æ¨¡å—ç”šè‡³éƒ½æ²¡æœ‰åŠ è½½ã€‚æŸ¥çœ‹æºä»£ç ä¹‹åå‘ç° seajs æ˜¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‡ºäº†æ¨¡å— factory ä¸­çš„ require è·¯å¾„&lt;/p&gt;

&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸‹é¢è¿™ä¸ªæ¨¡å—é‡Œé¢ require çš„å¤–éƒ¨æ¨¡å—ä¼šè§£æå‡ºä¾èµ– &lt;code&gt;GLOBAL_ROOT/base/cookie&lt;/code&gt; å’Œ &lt;code&gt;GLOBAL_ROOT/base/utils&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;define(&#39;moduleName&#39;, function() {
    var a = require(&#39;GLOBAL_ROOT/base/cookie&#39;)
    var b = require(&#39;GLOBAL_ROOT/base/utils&#39;)
    // æ­£å¸¸æƒ…å†µ a åº”è¯¥æ˜¯ä¸ªå¯¹è±¡ï¼Œ
    console.log(a)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯å¦‚æœ cookie æ¨¡å—åŠ è½½å¤±è´¥ï¼Œa å°±ä¼šè¿”å› null è¿™æ—¶å€™å†è°ƒ a ä¸Šé¢çš„æ–¹æ³•å°±ä¼šæŠ¥é”™ã€‚å½“ seajs å†…éƒ¨è§£æä¾èµ–æ—¶å‘ç”Ÿäº†é”™è¯¯æ—¶å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¯”è¾ƒè€çš„ seajs ç‰ˆæœ¬ï¼ˆ2.2.0ï¼‰ï¼Œå»æŸ¥çœ‹æºä»£ç å‘ç° parseDependencies æ–¹æ³•ä½¿ç”¨äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var REQUIRE_RE = /&amp;quot;(?:\\&amp;quot;|[^&amp;quot;])*&amp;quot;|&#39;(?:\\&#39;|[^&#39;])*&#39;|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^\/\r\n])+\/(?=[^\/])|\/\/.*|\.\s*require|(?:^|[^$])\brequire\s*\(\s*([&amp;quot;&#39;])(.+?)\1\s*\)/g
var SLASH_RE = /\\\\/g

function parseDependencies(code) {
  var ret = []

  code.replace(SLASH_RE, &amp;quot;&amp;quot;)
      .replace(REQUIRE_RE, function(m, m1, m2) {
        if (m2) {
          ret.push(m2)
        }
      })

  return ret
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬åœ¨æ§åˆ¶å°é‡Œé¢è·‘ä¸€ä¸‹çœ‹çœ‹ç»“æœï¼Œä¸Šé¢çš„æ¨¡å—è§£ææ­£ç¡®ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;//img30.360buyimg.com/devfe/jfs/t11401/113/1005903134/64122/b08677b9/59fc23d6N998f2848.png&#34; alt=&#34;seajs-works-well&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯æˆ‘è‡ªå·±çš„åœºæ™¯å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæˆ‘è´´ä¸Šè‡ªå·±çš„ä»£ç æ—¶å°±å¼‚å¸¸äº†ï¼Œç”±äºæºç æ¯”è¾ƒå¤šæˆ‘å°±æ”¾åˆ° jsbin ä¸Šäº†&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://jsbin.com/bowazakosu/edit?html,js,console,output&#34;&gt;å‹ç¼©æˆä¸€è¡Œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://jsbin.com/likonikoye/edit?html,js,console,output&#34;&gt;æ ¼å¼åŒ–å‹ç¼©ä»£ç å&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ‰æ„æ€çš„åœ°æ–¹å°±åœ¨äº å‹ç¼©æˆä¸€è¡Œ çš„ä»£ç ä¸­æ˜¯å¼‚å¸¸çš„ï¼Œä½†æ˜¯å½“æˆ‘æŠŠä»£ç æ ¼å¼åŒ–åå°±æ­£å¸¸äº†ï¼Ÿï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;seajs 3.x ç‰ˆæœ¬ä»¥å &lt;a href=&#34;https://github.com/seajs/seajs/blob/3.0.0/src/util-deps.js&#34;&gt;util-deps.js&lt;/a&gt; å¼•å…¥äº†ä¸€ä¸ªä¾èµ–è§£æå™¨æ–¹æ³•ï¼Œç›´æ¥ç”¨è¿™ä¸ªæ›¿ä»£åŸæ¥çš„å³å¯ã€‚è‡³äºä¸ºä»€ä¹ˆé‚£ä¸ªæ­£åˆ™å¯¹äºå‹ç¼©åçš„ä»£ç æ²¡èµ·ä½œç”¨æˆ‘æš‚è¿˜æ²¡è¯¦ç»†ç ”ç©¶ï¼Œä¸è¿‡æ„Ÿè§‰åƒè·å–æ¨¡å—ä¾èµ–å…³ç³»è¿™ç§é™æ€åˆ†æä»»åŠ¡è¿˜æ˜¯ç”¨è§£æå™¨é è°±ç‚¹ï¼Œæ­£åˆ™æœ‰å¤ªå¤šçš„ä¸ç¡®å®šæ€§ï¼Œè™½ç„¶å®ƒèƒ½èŠ‚çœå¾ˆå¤šä»£ç &lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>jQuery data æ–¹æ³•çš„ä¸€ä¸ªå°ç‰¹æŠ€</title>
      <link>https://keelii.com/2017/05/03/a-trick-from-jquery-data-method/</link>
      <pubDate>Wed, 03 May 2017 17:59:45 +0800</pubDate>
      
      <guid>https://keelii.com/2017/05/03/a-trick-from-jquery-data-method/</guid>
      <description>&lt;p&gt;é€šå¸¸æˆ‘ä»¬åœ¨ç”¨ JavaScript æ“ä½œ DOM å…ƒç´ çš„æ—¶å€™ä¼šå¾€ DOM ä¸Šä¸´æ—¶æ·»åŠ ä¸€äº›å‚æ•°ï¼Œç”¨æ¥è®°ä½ä¸€äº›çŠ¶æ€ï¼Œæˆ–è€…ä»åç«¯å–å‚æ•°å€¼ç­‰&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬é€šè¿‡åœ¨ HTML æ ‡ç­¾ä¸Šæ·»åŠ è‡ªå®šä¹‰å±æ€§æ¥å®ç°ï¼Œä½†æ˜¯è¿™æ ·ä¼šä¸å¯é¿å…çš„è®¿é—® DOMï¼Œæ€§èƒ½ä¸Šå¹¶ä¸å¥½ã€‚å¦‚æœä½ ä½¿ç”¨ jQuery çš„è¯å»ºè®®ä½¿ç”¨ &lt;code&gt;$el.data()&lt;/code&gt; æ–¹æ³•æ¥å–å…ƒç´ ä¸Š &lt;code&gt;data-*&lt;/code&gt; çš„å€¼ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div id=&amp;quot;demo&amp;quot; data-key=&amp;quot;value&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script&amp;gt;
    $(&#39;#demo&#39;).attr(&#39;data-key&#39;)
    $(&#39;#demo&#39;).data(&#39;key&#39;)  // ç¬¬ä¸€æ¬¡è®¿é—® DOMï¼Œä»¥åä»ç¼“å­˜å–
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äº attr æ¯æ¬¡éƒ½ä¼šç›´æ¥è®¿é—® DOM å…ƒç´ ï¼Œè€Œ data æ–¹æ³•ä¼šç¼“å­˜ç¬¬ä¸€æ¬¡çš„æŸ¥æ‰¾ï¼Œåç»­è°ƒç”¨ä¸éœ€è¦è®¿é—® DOM&lt;/p&gt;

&lt;p&gt;å¾ˆæ˜æ˜¾å»ºè®®ä½¿ç”¨åè€…ï¼Œä½†æ˜¯åœ¨ &lt;strong&gt;ä½ç‰ˆæœ¬çš„ jQuery&lt;/strong&gt; ä¸­é»˜è®¤ä¼šå¯¹ data æ–¹æ³•å–åˆ°çš„å€¼è¿›è¡Œç²—æš´çš„å¼ºåˆ¶æ•°æ®ç±»å‹è½¬æ¢ã€ŒparseFloatã€ã€‚çœ‹ä¸‹é¢ä»£ç &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div id=&amp;quot;demo0&amp;quot; data-key=&amp;quot;abc&amp;quot;&amp;gt;å­—ç¬¦ä¸²&amp;lt;/div&amp;gt;
&amp;lt;div id=&amp;quot;demo1&amp;quot; data-key=&amp;quot;123&amp;quot;&amp;gt;æ•°å­—&amp;lt;/div&amp;gt;
&amp;lt;div id=&amp;quot;demo2&amp;quot; data-key=&amp;quot;123e456&amp;quot;&amp;gt;ç§‘å­¦è®¡æ•°æ³•&amp;lt;/div&amp;gt;
&amp;lt;div id=&amp;quot;demo3&amp;quot; data-key=&amp;quot;0000123&amp;quot;&amp;gt;å…«è¿›åˆ¶æ•°å­—&amp;lt;/div&amp;gt;
&amp;lt;script src=&amp;quot;jquery-1.6.4&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
    $(&#39;#demo0&#39;).data(&#39;key&#39;)  // &amp;quot;abc&amp;quot;
    $(&#39;#demo1&#39;).data(&#39;key&#39;)  // 123
    $(&#39;#demo2&#39;).data(&#39;key&#39;)  // Infinity
    $(&#39;#demo3&#39;).data(&#39;key&#39;)  // 83
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åé¢ä¸¤ç§æ˜¾ç„¶å‡ºé”™äº†ï¼Œå°±æ˜¯å› ä¸º jQuery å¯¹å±æ€§å€¼è¿›è¡Œäº†å¼ºåˆ¶ parseFloat æ“ä½œã€‚è¿™ç§è½¬æ¢æ˜¯æ–¹ä¾¿äº†ä½¿ç”¨è€…ï¼Œå¦‚æœæ˜¯æ•°å­—çš„è¯æˆ‘ä»¬å–åˆ°è¿™ä¸ªå€¼è¿›è¡Œè®¡ç®—ä»€ä¹ˆçš„å°±ä¸ç”¨å†è½¬æ•°æ®ç±»å‹äº†ï¼Œä½†æ˜¯ä¸€ä¸å°å¿ƒå°±ä¼šå‡º bug&lt;/p&gt;

&lt;p&gt;å‘ç°è¿™ä¸ª bug çš„æ—¶å€™ç¬¬ä¸€æ„Ÿè§‰æ˜¯ jQuery ä¸åº”è¯¥æ²¡è€ƒè™‘åˆ°è¿™ä¸€ç‚¹å‘€ã€‚åæ¥æœæ–­å»æŸ¥äº†ä¸‹æœ€æ–°ç‰ˆçš„ jQuery æºä»£ç ï¼Œå‘ç°å·²ç»ä¿®å¤äº†ã€‚æ ¸å¿ƒä»£ç åœ¨ &lt;a href=&#34;https://github.com/jquery/jquery/blob/master/src/data.js#L36&#34;&gt;data.js 35 è¡Œ&lt;/a&gt;ï¼Œå¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function getData( data ) {
    if ( data === &amp;quot;true&amp;quot; ) {
        return true;
    }

    if ( data === &amp;quot;false&amp;quot; ) {
        return false;
    }

    if ( data === &amp;quot;null&amp;quot; ) {
        return null;
    }

    // Only convert to a number if it doesn&#39;t change the string
    // é‡ç‚¹å°±åœ¨è¿™é‡Œ â†’_â†’
    if ( data === +data + &amp;quot;&amp;quot; ) {
        return +data;
    }

    if ( rbrace.test( data ) ) {
        return JSON.parse( data );
    }

    return data;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;getData æ–¹æ³•å°±è¿”å›äº†èŠ‚ç‚¹å±æ€§çš„å€¼ï¼Œåªä¸è¿‡åŠ äº†ä¸€äº›ç‰¹æ®Šå¤„ç†ä½¿å¾—æˆ‘ä»¬å–åˆ°äº†æ²¡æœ‰ bug çš„å€¼ï¼Œå…³é”®åœ°æ–¹å°±åœ¨è¿™é‡Œï¼š &lt;code&gt;data === +data + &amp;quot;&amp;quot;&lt;/code&gt; ã€‚è¿™è¡Œä»£ç åšäº†äº›ä»€ä¹ˆç¥å¥‡çš„äº‹æƒ…&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å°†èŠ‚ç‚¹çš„å±æ€§å€¼å¼ºåˆ¶è½¬æ¢æˆæ•°å­—ã€Œ+dataã€åå†è½¬æˆå­—ç¬¦ä¸²ã€Œ+ &amp;ldquo;&amp;ldquo;ã€ï¼Œå¦‚æœè½¬æ¢åçš„å€¼ä¸åŸæ¥ç›¸ç­‰å°±å–è½¬æ¢åçš„å€¼&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥ç®€å•çš„è¿™ä¹ˆç†è§£ï¼šjQuery ä¼šå°è¯•è½¬æ¢æ•°æ®ç±»å‹ï¼Œå¦‚æœè½¬æ¢åå’Œè½¬æ¢å‰çš„ &lt;strong&gt;é•¿å¾—ä¸€æ ·&lt;/strong&gt; é‚£ä¹ˆ jQuery å°±è®¤ä¸ºå®ƒæ˜¯éœ€è¦è¢«è½¬æ¢æˆæ•°å­—çš„ã€‚è¿™æ ·å°±å¯ä»¥å®Œç¾è§„é¿ä¸Šé¢ä¾‹å­ä¸­çš„ä¸¤ç§é—®é¢˜ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;var data = &#39;abc&#39;
console.log(data === +data + &amp;quot;&amp;quot;)        // false ä¸è½¬æ¢ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²åŸå€¼

var data = &#39;123&#39;
console.log(data === +data + &amp;quot;&amp;quot;)        // true è½¬æ¢ï¼Œä½¿ç”¨è½¬æ¢åçš„æ•°å­—ç±»å‹å€¼

var data = &#39;123e456&#39;
console.log(data === +data + &amp;quot;&amp;quot;)        // false ä¸è½¬æ¢ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²åŸå€¼

var data = &#39;0000123&#39;
console.log(data === +data + &amp;quot;&amp;quot;)        // false ä¸è½¬æ¢ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²åŸå€¼
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>TrimPath æ¨¡æ¿å¼•æ“ä½¿ç”¨æŒ‡å—</title>
      <link>https://keelii.com/2016/11/21/trimpath-template-engine/</link>
      <pubDate>Mon, 21 Nov 2016 12:39:49 +0800</pubDate>
      
      <guid>https://keelii.com/2016/11/21/trimpath-template-engine/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.summitdowntown.org/site_media/media/javascript/private/trimpath-template-docs/JavaScriptTemplates.html&#34;&gt;TrimPath&lt;/a&gt; æ˜¯ä¸€æ¬¾è½»é‡çº§çš„å‰ç«¯ JavaScript æ¨¡æ¿å¼•æ“ï¼Œè¯­æ³•ç±»ä¼¼ &lt;a href=&#34;http://freemarker.org/&#34;&gt;FreeMarker&lt;/a&gt;, &lt;a href=&#34;https://velocity.apache.org/&#34;&gt;Velocity&lt;/a&gt;ï¼Œä¸»è¦ç”¨äºæ–¹ä¾¿åœ°æ¸²æŸ“ json æ•°æ®&lt;/p&gt;

&lt;h2 id=&#34;è¯­æ³•-syntax&#34;&gt;è¯­æ³• Syntax&lt;/h2&gt;

&lt;h3 id=&#34;è¡¨è¾¾å¼-expressions&#34;&gt;è¡¨è¾¾å¼ Expressions&lt;/h3&gt;

&lt;p&gt;è¡¨è¾¾å¼å’Œä¿®é¥°ç¬¦ï¼ˆå…¶å®ƒæ¨¡æ¿è¯­è¨€ä¸­å«åšè¿‡æ»¤å™¨ filterï¼‰ä¸­é—´ç”¨ &lt;code&gt;|&lt;/code&gt; åˆ†å‰²ä¸” &lt;strong&gt;ä¸èƒ½æœ‰ç©ºæ ¼&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;${expr}
${expr|modifier}
${expr|modifier1:arg1,arg2|modifier2:arg1,arg2|...|modifierN:arg1,arg2}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;è¯­å¥-statements&#34;&gt;è¯­å¥ Statements&lt;/h3&gt;

&lt;h4 id=&#34;æ§åˆ¶æµ-control-flow&#34;&gt;æ§åˆ¶æµ Control Flow&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;{if testExpr}
    {elseif testExpr}
    {else}
{/if}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å¾ªç¯-loops&#34;&gt;å¾ªç¯ Loops&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;{for varName in listExpr}
{/for}

{for varName in listExpr}
    ...å¾ªç¯ä¸»ä½“...
{forelse}
    ...å½“ listExpr æ˜¯ null æˆ–è€… length ä¸º 0 ...
{/for}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å˜é‡å£°æ˜-variable-declarations&#34;&gt;å˜é‡å£°æ˜ Variable Declarations&lt;/h4&gt;

&lt;p&gt;å˜é‡å£°æ˜è¯­å¥ç”¨èŠ±æ‹¬å· &lt;code&gt;{}&lt;/code&gt; æ‹¬èµ·æ¥ï¼Œä¸éœ€è¦å…³é—­ã€‚ç±»ä¼¼ JavaScript ä¸­çš„èµ‹å€¼è¯­å¥&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{var varName}
{var varName = varInitExpr}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å®å£°æ˜-macro-declarations&#34;&gt;å®å£°æ˜ Macro Declarations&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;{macro macroName(arg1, arg2, ...argN)}
    ...macro ä¸»ä½“...
{/macro}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;cdata-éƒ¨åˆ†-cdata-text-sections&#34;&gt;CDATA éƒ¨åˆ† CDATA Text Sections&lt;/h4&gt;

&lt;p&gt;CDATA éƒ¨åˆ†ç”¨æ¥å‘Šè¯‰æ¨¡æ¿å¼•æ“ä¸ç”¨åšä»»ä½•è§£ææ¸²æŸ“ï¼Œç›´æ¥è¾“å‡ºã€‚æ¯”å¦‚å±•ç¤ºä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{cdata}
    ${customer.firstName} ${customer.lastName}
{/cdata}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;in-line-javascript&#34;&gt;In-line JavaScript&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;eval blocks&lt;/strong&gt; ç”¨æ¥æ‰§è¡Œ JavaScript ä»£ç ç‰‡æ®µ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{eval}
    ...æ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œçš„ JavaScript ä»£ç ...
{/eval
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;minify blocks&lt;/strong&gt; ç”¨æ¥å‹ç¼©å†…å®¹ä¸­çš„æ¢è¡Œç¬¦ï¼Œæ¯”å¦‚å‹ç¼© HTML å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;div id=&amp;quot;commentPanel&amp;quot; style=&amp;quot;{minify}
      display:none;
      margin: 1em;
      border: 1px solid #333;
      background: #eee;
      padding: 1em;
    {/minify}&amp;quot;&amp;gt;
  ...
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ä¿®é¥°ç¬¦-modifier&#34;&gt;ä¿®é¥°ç¬¦ Modifier&lt;/h2&gt;

&lt;p&gt;ä¿®é¥°ç¬¦ç”¨æ¥å¤„ç†ä¸Šä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœï¼Œå¹¶è¾“å‡ºå†…å®¹ã€‚ç±»ä¼¼äº Linux shell ä¸­çš„ç®¡é“æ“ä½œç¬¦ï¼Œä½¿ç”¨ã€Œ|ã€åˆ†å‰²ä¸åŒä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä¸²è”ä½¿ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;${name|capitalize}
${name|default:&amp;quot;noname&amp;quot;|capitalize}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;å†…ç½®ä¿®é¥°ç¬¦&#34;&gt;å†…ç½®ä¿®é¥°ç¬¦&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;capitalize&lt;/strong&gt; è¿”å›å¤§å†™å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;default:valueWhenNull&lt;/strong&gt; å¦‚æœå†…å®¹ä¸º nullï¼Œè¿”å› valueWhenNull&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eat&lt;/strong&gt; è¿”å›ç©ºå†…å®¹ï¼Œä¸€èˆ¬ç”¨äºè¡¨è¾¾å¼æ±‚å€¼ååˆä¸æƒ³å±•ç¤ºè¾“å‡ºçš„å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;escape&lt;/strong&gt; è½¬æ¢ HTML å­—ç¬¦å®ä½“ï¼Œæ¯”å¦‚ï¼š &amp;amp; è½¬æ¢æˆ &amp;amp;amp;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;h&lt;/strong&gt; å’Œ escape æ•ˆæœä¸€æ ·&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;è‡ªå®šä¹‰ä¿®é¥°ç¬¦&#34;&gt;è‡ªå®šä¹‰ä¿®é¥°ç¬¦&lt;/h3&gt;

&lt;p&gt;è‡ªå®šä¹‰ä¿®é¥°ç¬¦å¯ä»¥æŒ‚è½½åˆ° contextObject ä¸Šçš„ &lt;code&gt;_MODIFIERS&lt;/code&gt; å±æ€§ä¸Š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var Modifiers = {
  toFixed: function(value, num) {
    return value.toFixed(num)
  }
}
var out = &#39;${num|toFixed:2}&#39;.process({
  _MODIFIERS: Modifiers,
  num: 1024
})
// =&amp;gt; &amp;quot;1024.00&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å®-macro&#34;&gt;å® Macro&lt;/h2&gt;

&lt;p&gt;macro ä¸€èˆ¬ç”¨æ¥å°è£…å¯å¤ç”¨ HTML æ¨¡æ¿ï¼Œç±»ä¼¼å‡½æ•°çš„åŠŸèƒ½ã€‚å¯¹äºæ¯ä¸ªæ¨¡æ¿æ¥è¯´ macro æ˜¯ç§ç”¨çš„ã€‚å¦‚æœæƒ³å…¬ç”¨ macroï¼Œå¯ä»¥ä¿å­˜ macro å¼•ç”¨åˆ° contextObject ä¸Šï¼ˆä¸‹æ¬¡è°ƒç”¨ process() æ–¹æ³•çš„æ—¶å€™å†æ‰‹åŠ¨æŒ‚è½½ä¸Š!? ï¼‰ã€‚éœ€è¦åœ¨è°ƒç”¨ process() æ–¹æ³•ä¹‹å‰ç»™ contextObject è®¾ç½®ä¸€ä¸ªç©ºçš„ exported å±æ€§ï¼š&lt;code&gt;contextObject[&#39;exported&#39;] = {}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªå…¬ç”¨çš„ macro è®¾è®¡çš„æœ‰ç‚¹å¥‡è‘©ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª &lt;a href=&#34;http://codepen.io/keelii/pen/dOvgOJ&#34;&gt;ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{macro link(href, name)}
    &amp;lt;a href=&amp;quot;${href}&amp;quot;&amp;gt;${name}&amp;lt;/a&amp;gt;
{/macro}

${link(&#39;http://google.com&#39;, &#39;google&#39;)}      =&amp;gt; &amp;lt;a href=&amp;quot;http://google.com&amp;quot;&amp;gt;google&amp;lt;/a&amp;gt;
${link(&#39;http://facebook.com&#39;, &#39;facebook&#39;)}  =&amp;gt; &amp;lt;a href=&amp;quot;http://facebook.com&amp;quot;&amp;gt;facebook&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;var data = {
    name: &#39;iPhone 6 Plus&#39;,
    weight: 480,
    ram: &#39;16gb&#39;,
    networks: [
        &#39;ç§»åŠ¨ï¼ˆTD-LTE)&#39;,
        &#39;è”é€š(TD-LTE)&#39;,
        &#39;ç”µä¿¡(FDD-LTE)&#39;
    ]
}

data._MODIFIERS = {
    toFixed: function(n, num) {
        return n.toFixed(num)
    }
}

var template = &#39;\
åç§°: ${name}&amp;lt;br&amp;gt;\
é‡é‡ï¼š${weight|toFixed:2}&amp;lt;br&amp;gt;\
å†…å­˜ï¼š${ram|capitalize}&amp;lt;br&amp;gt;\
ç½‘ç»œï¼š\
{for item in networks}\
  {if item_index!=0}|{/if}\
  ${item}\
{/for}&#39;;

template.process(data)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä»£ç è¾“å‡ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;åç§°: iPhone 6 Plus&amp;lt;br&amp;gt;
é‡é‡ï¼š480.00&amp;lt;br&amp;gt;
å†…å­˜ï¼š16GB&amp;lt;br&amp;gt;
ç½‘ç»œï¼š
  ç§»åŠ¨ï¼ˆTD-LTE)
 | è”é€š(TD-LTE)
 | ç”µä¿¡(FDD-LTE)
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>PhantomJS &amp; NodeJS åœ¨äº¬ä¸œç½‘ç«™å‰ç«¯ç›‘æ§å¹³å°çš„æœ€ä½³å®è·µ</title>
      <link>https://keelii.com/2016/11/17/best-practice-for-phantomjs-and-nodejs-at-jd-s-webdev-front-end-monitor-platform/</link>
      <pubDate>Thu, 17 Nov 2016 09:55:41 +0800</pubDate>
      
      <guid>https://keelii.com/2016/11/17/best-practice-for-phantomjs-and-nodejs-at-jd-s-webdev-front-end-monitor-platform/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡é¦–å‘äº &lt;a href=&#34;http://www.infoq.com/cn/articles/practise-of-phantomjs-and-nodejs-in-jingdong&#34;&gt;infoQ&lt;/a&gt; åŠã€Œå‰ç«¯ä¹‹å·…ã€å¾®ä¿¡å…¬ä¼—å·ï¼ˆ&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzIwNjQwMzUwMQ==&amp;amp;mid=2247484138&amp;amp;idx=1&amp;amp;sn=431702ee926dd3a92403bb58417d88d4&amp;amp;scene=2&amp;amp;srcid=0831H070dVHqyZ5Gg62tZRsl&amp;amp;from=timeline&amp;amp;isappinstalled=0&amp;amp;pass_ticket=UAxLVHRLr%2B46hzwgDjfAanLKPSIcnzOQLPJZtqRkoQeHy03khyC2aD7Lat9WgyiL&#34;&gt;å¾®ä¿¡ç¾¤ç›´æ’­è®°å½•&lt;/a&gt;ï¼‰ï¼Œæ„Ÿè°¢ infoQ å‰ç«¯ä¹‹å·…å°¾å°¾åŒå­¦å¯¹æ–‡ç« çš„æ•´ç†å’Œæ ¡å¯¹ã€å¾®ä¿¡ç¾¤ç›´æ’­çš„ç»„ç»‡ç­–åˆ’ã€‚ã€Œå‰ç«¯ä¹‹å·…ã€æ˜¯ä¸ªéå¸¸æ£’çš„å‰ç«¯çŸ¥è¯†åˆ†äº«å¹³å°ï¼Œæƒ³äº†è§£æœ€å‰æ²¿çš„å‰ç«¯çŸ¥è¯†èµ„è®¯æœæ–­å…³æ³¨å§&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªå‰ç«¯ç›‘æ§ç³»ç»Ÿ&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªå‰ç«¯ç›‘æ§ç³»ç»Ÿ&lt;/h2&gt;

&lt;p&gt;é€šå¸¸åœ¨ä¸€ä¸ªå¤§å‹çš„ Web é¡¹ç›®ä¸­æœ‰å¾ˆå¤šç›‘æ§ï¼Œæ¯”å¦‚åç«¯çš„æœåŠ¡ API ç›‘æ§ï¼Œæ¥å£å­˜æ´»ã€è°ƒç”¨ã€å»¶è¿Ÿç­‰ç›‘æ§ï¼Œè¿™äº›ä¸€èˆ¬éƒ½ç”¨æ¥ç›‘æ§åå°æ¥å£æ•°æ®å±‚é¢çš„ä¿¡æ¯ã€‚è€Œä¸”å¯¹äºå¤§å‹ç½‘ç«™ç³»ç»Ÿæ¥è¯´ï¼Œä»åç«¯æœåŠ¡åˆ°å‰å°å±•ç¤ºä¼šæœ‰å¾ˆå¤šå±‚ï¼šå†…ç½‘ VIPã€CDN ç­‰ã€‚ä½†æ˜¯è¿™äº›ç›‘æ§å¹¶ä¸èƒ½å‡†ç¡®åœ°ååº”ç”¨æˆ·çœ‹åˆ°çš„å‰ç«¯é¡µé¢çŠ¶æ€ï¼Œæ¯”å¦‚ï¼šé¡µé¢ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®è°ƒç”¨å¤±è´¥ï¼Œæ¨¡å—åŠ è½½å¼‚å¸¸ï¼Œæ•°æ®ä¸æ­£ç¡®ï¼Œç©ºç™½å¼€å¤©çª—ç­‰ã€‚è¿™æ—¶å€™å°±éœ€è¦ä»å‰ç«¯ DOM å±•ç¤ºçš„è§’åº¦å»åˆ†æå’Œæ”¶é›†ç”¨æˆ·çœŸæ­£çœ‹åˆ°çš„ä¸œè¥¿ï¼Œä»è€Œæ£€æµ‹å‡ºé¡µé¢æ˜¯å¦å‡ºç°å¼‚å¸¸é—®é¢˜&lt;/p&gt;

&lt;h2 id=&#34;éœ€è¦ç›‘æ§ç³»ç»Ÿè§£å†³çš„é—®é¢˜&#34;&gt;éœ€è¦ç›‘æ§ç³»ç»Ÿè§£å†³çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;é¡µé¢é€šå¸¸å‡ºç°ä»¥ä¸‹é—®é¢˜æ—¶éœ€è¦ä½¿ç”¨é‚®ä»¶ã€çŸ­ä¿¡é€šçŸ¥ç›¸å…³äººå‘˜ä¿®å¤é—®é¢˜&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;çŠ¶æ€ç è¿”å›é”™è¯¯ï¼ˆ50x, 40xï¼‰æ— æ³•æ‰“å¼€&lt;/li&gt;
&lt;li&gt;æ¨¡å—åŠ è½½å¤±è´¥&lt;/li&gt;
&lt;li&gt;é¡µé¢ä¹±ç &lt;/li&gt;
&lt;li&gt;æ•°æ®æ­£ç¡®æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è§¦å‘æŠ¥è­¦æ—¶è¦æœ‰ç°åœºå¿«ç…§ï¼Œä»¥ä¾¿å¤ç°é—®é¢˜&lt;/p&gt;

&lt;h2 id=&#34;æŠ€æœ¯é€‰å‹&#34;&gt;æŠ€æœ¯é€‰å‹&lt;/h2&gt;

&lt;p&gt;ç›‘æ§çš„æ„ä¹‰å’Œå›å½’æµ‹è¯•çš„åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å¯¹å·²ä¸Šçº¿åŠŸèƒ½è¿›è¡Œå›å½’æµ‹è¯•ï¼Œä½†ä¸åŒçš„æ˜¯ç›‘æ§éœ€è¦åšé•¿æœŸçš„å¯æŒç»­å¯å¾ªç¯çš„å›å½’æµ‹è¯•ï¼Œè€Œæµ‹è¯•ä»…ä»…éœ€è¦åœ¨ä¸Šçº¿ä¹‹ååšä¸€æ¬¡å›å½’&lt;/p&gt;

&lt;p&gt;æ—¢ç„¶ç›‘æ§å’Œæµ‹è¯•çš„æœ¬è´¨ä¸€è‡´ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥é‡‡ç”¨æµ‹è¯•çš„æ–¹å¼æ¥åšç›‘æ§ç³»ç»Ÿã€‚åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯éåœ°å¼€èŠ±çš„æ—¶ä»£ï¼Œä¸ä¹å¾ˆå¤šå¥½ç”¨çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™äº›è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œæ•´åˆä¸ºæˆ‘ä»¬æ‰€ç”¨å³å¯&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;NodeJS - ç‰¹åˆ«é€‚ç”¨äºç½‘ç»œå¯†é›†å‹ä»»åŠ¡&lt;/li&gt;
&lt;li&gt;PhantomJS - æ¨¡æ‹Ÿæ— ç•Œé¢çš„æµè§ˆå™¨ï¼Œæä¾›ä¸°å¯Œçš„å†…æ ¸äº¤äº’ API&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;nodejs&#34;&gt;NodeJS&lt;/h3&gt;

&lt;p&gt;NodeJS æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œç¯å¢ƒï¼Œéé˜»å¡ I/O å’Œå¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨ï¼Œè¿™å‡ ç‚¹å¯¹äºæˆ‘ä»¬æ„å»ºåŸºäº DOM å…ƒç´ çš„ç›‘æ§æ˜¯éå¸¸é‡è¦çš„&lt;/p&gt;

&lt;h3 id=&#34;phantomjs&#34;&gt;PhantomJS&lt;/h3&gt;

&lt;p&gt;PhantomJS æ˜¯ä¸€ä¸ªåŸºäº webkit çš„æµè§ˆå™¨å¼•æ“ï¼Œå¯ä»¥ä½¿ç”¨ JavaScript API æ¥æ¨¡æ‹Ÿæµè§ˆå™¨çš„æ“ä½œã€‚å®ƒä½¿ç”¨ QtWebKit ä½œä¸ºå®ƒçš„æµè§ˆå™¨æ ¸å¿ƒï¼Œä½¿ç”¨ webkit æ¥ç¼–è¯‘è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ä»»ä½•ä½ å¯ä»¥åœ¨ webkit æµè§ˆå™¨é‡Œåšçš„äº‹æƒ…ï¼Œå®ƒéƒ½èƒ½åšåˆ°&lt;/p&gt;

&lt;p&gt;å®ƒä¸ä»…æ˜¯ä¸ªéšå½¢çš„æµè§ˆå™¨ï¼Œæä¾›äº†è¯¸å¦‚ CSS é€‰æ‹©å™¨ã€æ”¯æŒ Web æ ‡å‡†ã€DOM æ“ä½œã€JSONã€HTML5ã€Canvasã€SVG ç­‰ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å¤„ç†æ–‡ä»¶ I/O çš„æ“ä½œç­‰ã€‚PhantomJS çš„ç”¨å¤„å¯è°“éå¸¸å¹¿æ³›ï¼Œè¯¸å¦‚ç½‘ç»œç›‘æµ‹ã€ç½‘é¡µæˆªå±ã€æ— æµè§ˆå™¨çš„ Web æµ‹è¯•ã€é¡µé¢è®¿é—®è‡ªåŠ¨åŒ–ç­‰&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸æ˜¯ Selenium&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åšè‡ªåŠ¨åŒ–æµ‹è¯•çš„åŒå­¦è‚¯å®šéƒ½çŸ¥é“ Seleniumã€‚å¯ä»¥ä½¿ç”¨ Selenium å°†æµ‹è¯•ç”¨ä¾‹åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œè€Œä¸” Selenium å¯¹å„ç§å¹³å°å’Œå¸¸è§æµè§ˆå™¨æ”¯æŒæ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ Selenium ä¸Šæ‰‹éš¾åº¦ç³»æ•°ç•¥é«˜ï¼Œè€Œä¸”ä½¿ç”¨Selenium éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å®‰è£…æµè§ˆå™¨&lt;/p&gt;

&lt;p&gt;è€ƒè™‘åˆ°ç›‘æ§ä¸»è¦ä»»åŠ¡åœ¨ç›‘æ§ä¸åœ¨æµ‹è¯•ã€‚ç³»ç»Ÿå¹¶ä¸éœ€è¦å¤ªå¤šè€ƒè™‘å…¼å®¹æ€§ï¼Œè€Œä¸”ç›‘æ§åŠŸèƒ½ç›¸å¯¹å•ä¸€ï¼Œä¸»è¦å¯¹é¡µé¢è¿›è¡ŒåŠŸèƒ½ä¸Šçš„å›å½’æµ‹è¯•ï¼Œæ‰€ä»¥é€‰æ‹©äº† PhantomJS&lt;/p&gt;

&lt;h2 id=&#34;æ¶æ„è®¾è®¡&#34;&gt;æ¶æ„è®¾è®¡&lt;/h2&gt;

&lt;h3 id=&#34;æ¶æ„æ¦‚è§ˆ&#34;&gt;æ¶æ„æ¦‚è§ˆ&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://cloud.githubusercontent.com/assets/458894/17013271/ec2bc29e-4f4f-11e6-9591-0838a0243206.png&#34; alt=&#34;4&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;æ¶æ„ç®€è¿°&#34;&gt;æ¶æ„ç®€è¿°&lt;/h3&gt;

&lt;p&gt;å¯¹äº DOM ç›‘æ§æœåŠ¡ï¼Œåœ¨åº”ç”¨å±‚é¢ä¸Šè¿›è¡Œäº†å‚ç›´åˆ’åˆ†ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è§„åˆ™ç®¡ç†ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;è§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨&lt;/li&gt;
&lt;li&gt;é•¿æ—¶æŒç»­å¤„ç†å™¨&lt;/li&gt;
&lt;li&gt;PhantomJS æœåŠ¡&lt;/li&gt;
&lt;li&gt;æœåŠ¡åŒ– API&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨åº”ç”¨å±‚é¢ä¸Šè¿›è¡Œçš„å‚ç›´åˆ’åˆ†å¯ä»¥å¯¹åº”ç”¨åšåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæé«˜å¤„ç†èƒ½åŠ›ã€‚åæœŸä¹Ÿæ–¹ä¾¿åšæ€§èƒ½ä¼˜åŒ–ã€ç³»ç»Ÿæ”¹é€ æ‰©å±•ç­‰&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;

&lt;h3 id=&#34;å‰å°è§„åˆ™å½•å…¥&#34;&gt;å‰å°è§„åˆ™å½•å…¥&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Web ç³»ç»Ÿï¼Œç³»ç»Ÿä¸»è¦ç”¨æ¥æ”¶é›†ç”¨æˆ·å½•å…¥çš„é¡µé¢ä¿¡æ¯ã€é¡µé¢å¯¹åº”çš„è§„åˆ™ã€å±•ç¤ºé”™è¯¯ä¿¡æ¯ã€‚é€šè¿‡è°ƒç”¨åç«¯é¡µé¢æŠ“å–æœåŠ¡æ¥å®Œæˆé¡µé¢æ£€æµ‹çš„ä»»åŠ¡ï¼Œç³»ç»Ÿå¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„æ£€æµ‹é¡µé¢ï¼šå¸¸è§„ç›‘æ§ã€é«˜çº§ç›‘æ§ã€å¯ç”¨æ€§ç›‘æ§&lt;/p&gt;

&lt;h4 id=&#34;å¸¸è§„ç›‘æ§&#34;&gt;å¸¸è§„ç›‘æ§&lt;/h4&gt;

&lt;p&gt;å½•å…¥ä¸€ä¸ªé¡µé¢åœ°å€ï¼Œå’Œè‹¥å¹²æ£€æµ‹è§„åˆ™ã€‚æ³¨æ„è¿™é‡Œçš„æ£€æµ‹è§„åˆ™ï¼Œæˆ‘ä»¬æŠŠå¸¸ç”¨çš„ä¸€äº›æ£€æµ‹ç‚¹æŠ½è±¡æˆäº†ä¸€æ¡ç±»ä¼¼æµ‹è¯•ç”¨ä¾‹çš„è¯­å¥ã€‚æ¯æ¡è§„åˆ™ç”¨æ¥åŒ¹é…é¡µé¢ä¸Šçš„ä¸€ä¸ª DOM å…ƒç´ ï¼Œç”¨ DOM å…ƒç´ çš„å±æ€§æ¥å’Œé¢„æœŸåšåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ç³»ç»Ÿå°±ä¼šäº§ç”Ÿä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼Œåç»­äº¤ç”±æŠ¥è­¦ç³»ç»Ÿå¤„ç†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åŒ¹é…ç±»å‹&lt;/strong&gt; ä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ç§ï¼š&lt;code&gt;é•¿åº¦ã€æ–‡æœ¬ã€HTMLã€å±æ€§&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¤„ç†å™¨&lt;/strong&gt; ç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„æ“ä½œç¬¦ï¼š&lt;code&gt;å¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºã€ç­‰äºã€æ­£åˆ™&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ ·åšçš„å¤„å°±æ˜¯ï¼Œå½•å…¥è§„åˆ™çš„äººåªè¦äº†è§£ä¸€ç‚¹ DOM é€‰æ‹©å™¨çš„çŸ¥è¯†å°±å¯ä»¥ä¸Šæ‰‹æ“ä½œäº†ï¼Œåœ¨æˆ‘ä»¬å†…éƒ¨é€šå¸¸æ˜¯äº¤ç”±æµ‹è¯•å·¥ç¨‹å¸ˆç»Ÿä¸€å®Œæˆè§„åˆ™çš„å½•å…¥&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://cloud.githubusercontent.com/assets/458894/17012424/2963f11e-4f4a-11e6-96f1-a962c767e651.png&#34; alt=&#34;1&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;é«˜çº§ç›‘æ§&#34;&gt;é«˜çº§ç›‘æ§&lt;/h4&gt;

&lt;p&gt;ä¸»è¦ç”¨æ¥æä¾›é«˜çº§é¡µé¢æµ‹è¯•çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”±æœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆæ¥æ’°å†™æµ‹è¯•ç”¨ä¾‹ã€‚è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å†™èµ·æ¥ä¼šæœ‰ä¸€äº›å­¦ä¹ æˆæœ¬ï¼Œä½†æ˜¯å¯ä»¥æ¨¡æ‹Ÿ Web é¡µé¢æ“ä½œï¼Œå¦‚ï¼šç‚¹å‡»ã€é¼ æ ‡ç§»åŠ¨ç­‰äº‹ä»¶ä»è€Œåšåˆ°ç²¾ç¡®æ•æ‰é¡µé¢ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://cloud.githubusercontent.com/assets/458894/17012590/324509de-4f4b-11e6-9ddc-63e5a140b208.png&#34; alt=&#34;2&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;å¯ç”¨æ€§ç›‘æ§&#34;&gt;å¯ç”¨æ€§ç›‘æ§&lt;/h4&gt;

&lt;p&gt;å¯ç”¨æ€§ç›‘æ§ä¾§é‡äºå¯¹é¡µé¢çš„å¯è®¿é—®æ€§ã€å†…å®¹æ­£ç¡®æ€§ç­‰æ¯”è¾ƒ &lt;strong&gt;ä¸¥é‡çš„é—®é¢˜&lt;/strong&gt; åšå³æ—¶ç›‘æ§ã€‚é€šå¸¸è¿™ç±»é¡µé¢æˆ‘ä»¬åªéœ€è¦åœ¨ç¨‹åºé‡Œé¢å¯ä¸€ä¸ª Worker ä¸æ–­çš„å»è·å–é¡µé¢ HTML å°±å¯ä»¥å¯¹ç»“æœè¿›è¡Œæ£€æµ‹åŒ¹é…äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº† NodeJS æ¥åšå¼‚æ­¥çš„é¡µé¢æŠ“å–é˜Ÿåˆ—ï¼Œé«˜æ•ˆå¿«é€Ÿçš„å®Œæˆè¿™ç§ç½‘ç»œå¯†é›†å‹ä»»åŠ¡&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://cloud.githubusercontent.com/assets/458894/17012775/7ccfad00-4f4c-11e6-80b6-60186069bdac.png&#34; alt=&#34;3&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;ä¸»åŠ¨é”™è¯¯ä¸ŠæŠ¥&#34;&gt;ä¸»åŠ¨é”™è¯¯ä¸ŠæŠ¥&lt;/h3&gt;

&lt;h4 id=&#34;é¡µé¢è„šæœ¬æ‰§è¡Œé”™è¯¯ç›‘æ§&#34;&gt;é¡µé¢è„šæœ¬æ‰§è¡Œé”™è¯¯ç›‘æ§&lt;/h4&gt;

&lt;p&gt;é¡µé¢å¼•å…¥ä¸€æ®µç›‘æ§è„šæœ¬æ¥æ”¶é›†é¡µé¢äº§æˆ error äº‹ä»¶è¿”å›çš„é”™è¯¯ä¿¡æ¯ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥ç»™åç«¯æœåŠ¡ï¼Œåœ¨ç³»ç»Ÿé‡Œé¢å¯ä»¥æ±‡æ€»æ‰€æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œä»¥åŠå¯¹åº”çš„å®¢æˆ·ç«¯æµè§ˆå™¨ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿã€IP åœ°å€ç­‰&lt;/p&gt;

&lt;h4 id=&#34;é¡µé¢ä¸»åŠ¨ä¸ŠæŠ¥&#34;&gt;é¡µé¢ä¸»åŠ¨ä¸ŠæŠ¥&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªåŠŸèƒ½éœ€è¦å¯¹åº”çš„å‰ç«¯å·¥ç¨‹å¸ˆåœ¨ä»£ç ä¸­è°ƒç”¨é”™è¯¯ä¸ŠæŠ¥ APIï¼Œæ¥ä¸»åŠ¨æäº¤é”™è¯¯ä¿¡æ¯ã€‚ä¸»è¦ä½¿ç”¨çš„åœºæ™¯æœ‰ï¼Œé¡µé¢å¼‚æ­¥æœåŠ¡å»¶æ—¶æ— å“åº”ã€æ¨¡å—é™çº§å…œåº•ä¸»åŠ¨é€šçŸ¥ç­‰ã€‚ç›‘æ§è„šæœ¬æä¾›å‡ ä¸ªç®€å•çš„ API æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;// error æ–¹æ³•è°ƒç”¨åç«‹å³ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯å¹¶å‘å‡ºé‚®ä»¶ã€çŸ­ä¿¡é€šçŸ¥
errorTracker.error(&#39;é”™è¯¯æè¿°&#39;)
// info æ–¹æ³•è°ƒç”¨åç«‹å³ä¸ŠæŠ¥ä¿¡æ¯ï¼Œå¹¶åœ¨å•ä½æ—¶é—´å†…ä»…äº§ç”Ÿä¸€æ¡é‚®ä»¶ã€çŸ­ä¿¡é€šçŸ¥
errorTracker.info(&#39;ä¿¡æ¯æè¿°&#39;)
// log æ–¹æ³•è°ƒç”¨åç”±æŠ¥é”™æ£€æµ‹æ˜¯å¦è¾¾åˆ°è®¾ç½®é˜€å€¼ï¼Œæœ€ç»ˆç¡®è®¤æ˜¯å¦æŠ¥é”™
errorTracker.log(&#39;æ—¥å¿—ä¿¡æ¯&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åç«¯é¡µé¢æŠ“å–æœåŠ¡&#34;&gt;åç«¯é¡µé¢æŠ“å–æœåŠ¡&lt;/h3&gt;

&lt;p&gt;ç”±äºäº¬ä¸œå¾ˆå¤šé¡µé¢å†…å®¹æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œåƒé¦–é¡µã€å•å“ç­‰ç³»ç»Ÿæœ‰è®¸å¤šç¬¬ä¸‰æ–¹å¼‚æ­¥æ¥å£è°ƒç”¨ï¼Œä½¿ç”¨åç«¯ç¨‹åºæŠ“å–åˆ°çš„é¡µé¢æ•°æ®æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸èƒ½å–åˆ°åŠ¨æ€çš„ JavaScript æ¸²æŸ“çš„å†…å®¹ï¼Œæ‰€ä»¥å°±å¿…é¡»ä½¿ç”¨åƒ PhantomJS è¿™ç§èƒ½æ¨¡æ‹Ÿæµè§ˆå™¨çš„å·¥å…·&lt;/p&gt;

&lt;p&gt;å¸¸è§„ç›‘æ§æˆ‘ä»¬ä½¿ç”¨ PhantomJS æ¨¡æ‹Ÿæµè§ˆå™¨æ‰“å¼€é¡µé¢è¿›è¡ŒæŠ“å–ï¼Œç„¶åå°†ç›‘æ§è§„åˆ™è§£ææˆ JavaScript ä»£ç ç‰‡æ®µæ‰§è¡Œå¹¶æ”¶é›†ç»“æœ&lt;/p&gt;

&lt;p&gt;é«˜çº§ç›‘æ§æˆ‘ä»¬ä½¿ç”¨ PhantomJS æ‰“å¼€é¡µé¢åå‘é¡µé¢æ³¨å…¥åƒ jasmine, mocha ç­‰ç±»ä¼¼çš„å‰ç«¯ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œç„¶ååœ¨é¡µé¢æ‰§è¡Œå¯¹åº”çš„å½•å…¥æµ‹è¯•ç”¨ä¾‹å¹¶è¿”å›ç»“æœ&lt;/p&gt;

&lt;h4 id=&#34;è§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨&#34;&gt;è§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨&lt;/h4&gt;

&lt;p&gt;è§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨ä¼šå°†é‡‡é›†çš„è§„åˆ™è½¬åŒ–ç±»æˆæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åäº¤ç”±é•¿æ—¶æŒç»­å¤„ç†å™¨ä¸€æ¬¡å¤„ç†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆé‡‡ç”¨ç±»æ¶ˆæ¯é˜Ÿåˆ—çš„å¤„ç†æ–¹å¼ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™å’Œ PhantomJS çš„æ€§èƒ½æ˜¯å¯†ä¸å¯åˆ†çš„ï¼Œç”±å¤šæ¬¡å®è·µå‘ç°ï¼ŒPhantomJS å¹¶ä¸èƒ½å¾ˆå¥½åœ°è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œå½“å¹¶å‘è¿‡å¤šï¼Œä¼šå¯¼è‡´ CPU è¿‡è½½ï¼Œä»è€Œå¯¼è‡´æœºå™¨å®•æœº&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬æœºç¯å¢ƒä¸‹çš„è™šæ‹Ÿæœºä¸­è¿›è¡Œå¹¶å‘æµ‹è¯•ï¼Œæ•°æ®å¹¶ä¸ç†æƒ³ï¼Œæé™åŸºæœ¬åœ¨ ab -n 100 -c 50 å·¦å³ã€‚ æ‰€ä»¥ä¸ºäº†é˜²æ­¢å¹¶å‘å¯¼è‡´çš„é—®é¢˜ï¼Œå°±é€‰æ‹©äº†ä½¿ç”¨ç±»æ¶ˆæ¯é˜Ÿåˆ—æ¥é¿å…å› ä¸ºå¹¶å‘è¿‡é«˜å¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨&lt;/p&gt;

&lt;h4 id=&#34;ç±»æ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°&#34;&gt;ç±»æ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬è¿™é‡Œé€šè¿‡è°ƒç”¨å†…éƒ¨çš„åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿç”Ÿæˆç±»æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„ç”Ÿæˆå…¶å®å¯ä»¥å‚è€ƒæ•°æ®ç»“æ„&amp;ndash;é˜Ÿåˆ—ã€‚æœ€åŸºæœ¬çš„æ¨¡å‹å°±æ˜¯åœ¨ç¼“å­˜ä¸­åˆ›å»ºä¸€ä¸ª KEY ï¼Œç„¶åæ ¹æ®é˜Ÿåˆ—æ•°æ®ç»“æ„çš„æ¨¡å¼è¿›è¡Œæ•°æ®çš„æ’å…¥å’Œè¯»å–&lt;/p&gt;

&lt;p&gt;å½“ç„¶ï¼Œç±»æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸­é—´ä»‹è´¨å¯æ ¹æ®ä½ å®é™…çš„æ¡ä»¶æ¥é€‰æ‹©ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºå†…å­˜å®ç°ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å’Œç±»æ¶ˆæ¯é˜Ÿåˆ—ç«äº‰å†…å­˜&lt;/p&gt;

&lt;h4 id=&#34;é•¿æ—¶æŒç»­å¤„ç†å™¨&#34;&gt;é•¿æ—¶æŒç»­å¤„ç†å™¨&lt;/h4&gt;

&lt;p&gt;é•¿æ—¶æŒç»­å¤„ç†å™¨æ˜¯è¦åŠŸèƒ½å°±æ˜¯æ¶ˆè´¹è§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨ç”Ÿæˆçš„ç±»æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;

&lt;h4 id=&#34;é•¿æ—¶æŒç»­å¤„ç†å®ç°&#34;&gt;é•¿æ—¶æŒç»­å¤„ç†å®ç°&lt;/h4&gt;

&lt;p&gt;åœ¨é•¿æ—¶æŒç»­å¤„ç†å™¨çš„å…·ä½“å®ç°ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† JavaScript çš„ setInterval æ–¹æ³•æ¥æŒç»­è·å–ç´¯æ¶ˆæ¯é˜Ÿåˆ—çš„å†…å®¹ä¸‹å‘ç»™è§„åˆ™è½¬åŒ–å™¨ï¼Œç„¶åè½¬å‘ç»™è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ã€‚ä¹‹åå†å¯¹è¿”å›çš„ç»“æœè¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚é‚®ä»¶æˆ–è€…çŸ­ä¿¡æŠ¥è­¦&lt;/p&gt;

&lt;h4 id=&#34;api&#34;&gt;API&lt;/h4&gt;

&lt;p&gt;PhantomJS æœåŠ¡å¯ä»¥åšä¸ºå…¬å…± API æä¾›ç»™å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•éœ€æ±‚çš„å¤„ç†ï¼Œ API é€šè¿‡ HTTP æ–¹å¼è°ƒç”¨ã€‚åœ¨ API çš„å¤„ç†ä¸Šéœ€è¦æä¾› HTTP æ•°æ®åˆ°è§„åˆ™å’Œ PhantomJS çš„è½¬æ¢ã€‚ä»è€Œåˆæ¼”åŒ–å‡ºäº† HTTP æ•°æ®åˆ°è§„åˆ™è½¬æ¢å™¨&lt;/p&gt;

&lt;h4 id=&#34;phantomjs-æœåŠ¡&#34;&gt;PhantomJS æœåŠ¡&lt;/h4&gt;

&lt;p&gt;PhantomJS æœåŠ¡æ˜¯æŒ‡å°† PhantomJS ç»“åˆ HTTP æœåŠ¡å’Œå­è¿›ç¨‹è¿›è¡ŒæœåŠ¡åŒ–çš„å¤„ç†&lt;/p&gt;

&lt;p&gt;é¦–å…ˆã€å¯åŠ¨ HTTP æœåŠ¡ï¼Œç„¶åå°†é•¿æ—¶å¤„ç†å™¨ä¸‹å‘çš„è§„åˆ™è¿›è¡Œè¿›ä¸€æ­¥è½¬åŒ–ï¼Œè½¬åŒ–åå¯åŠ¨å­è¿›ç¨‹ï¼ŒHTTP æœåŠ¡ä¼šç›‘å¬å­è¿›ç¨‹çš„å¤„ç†ç»“æœï¼Œå¹¶åœ¨å¤„ç†å®Œæ¯•ä¹‹åè¿”å›&lt;/p&gt;

&lt;h3 id=&#34;æŠ¥è­¦ç³»ç»Ÿ&#34;&gt;æŠ¥è­¦ç³»ç»Ÿ&lt;/h3&gt;

&lt;p&gt;æŠ¥è­¦ç³»ç»Ÿæˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„æ˜¯äº¬ä¸œå†…éƒ¨è‡ªå·±çš„ç»Ÿä¸€ç›‘æ§å¹³å° UMPï¼Œé€šè¿‡è°ƒç”¨å¹³å°æä¾›çš„ä¸€äº› API æ¥å®ç°æŠ¥è­¦é‚®ä»¶ä¸çŸ­ä¿¡é€šçŸ¥&lt;/p&gt;

&lt;h4 id=&#34;å¦‚ä½•æ ¹æ®æŠ¥è­¦å®šä½åˆ°å…·ä½“é¡µé¢&#34;&gt;å¦‚ä½•æ ¹æ®æŠ¥è­¦å®šä½åˆ°å…·ä½“é¡µé¢ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;ç”¨æˆ·é€šè¿‡ç›‘æ§ç®¡ç†ç³»ç»Ÿå½•å…¥è§„åˆ™åï¼Œç›‘æ§ç³»ç»Ÿä¼šæ ¹æ® UMP è§„åˆ™é’ˆå¯¹ç”¨æˆ·å½•å…¥çš„é¡µé¢ç”Ÿæˆ UMP ä½¿ç”¨çš„ keyã€‚å½“é•¿æ—¶æŒç»­å¤„ç†å™¨å‘ç° PhantomJS æœåŠ¡è¿”å›çš„ç»“æœæ ‡ç¤ºä¸ºå¼‚å¸¸åï¼Œå°±ä¼šä½¿ç”¨ key æ¥è¿›è¡Œæ—¥å¿—è®°å½•&lt;/p&gt;

&lt;h4 id=&#34;ä½•æ—¶å‡ºå‘æŠ¥è­¦&#34;&gt;ä½•æ—¶å‡ºå‘æŠ¥è­¦ï¼Ÿ&lt;/h4&gt;

&lt;p&gt;æŠ¥è­¦ä¸»è¦åˆ†ä¸ºäº†çŸ­ä¿¡å’Œé‚®ä»¶æŠ¥è­¦ã€‚é‚®ä»¶æŠ¥è­¦æ˜¯åœ¨æ¯æ¡å¼‚å¸¸ä¹‹åå°±ä¼šå‘ç»™æŒ‡å®šç³»ç»Ÿç”¨æˆ·ã€‚çŸ­ä¿¡åˆ™æ˜¯æ ¹æ®å¼‚å¸¸æ¬¡æ•°æ¥è¿›è¡Œå¤„ç†çš„ï¼Œå½“å¼‚å¸¸æ¬¡æ•°è¿‡å¤§ï¼Œå°±ä¼šä¸‹å‘çŸ­ä¿¡é€šçŸ¥&lt;/p&gt;

&lt;h3 id=&#34;éƒ¨ç½²&#34;&gt;éƒ¨ç½²&lt;/h3&gt;

&lt;p&gt;å¯¹äºç³»ç»Ÿéƒ¨ç½²å¯ä»¥åˆ†ä¸ºä¸¤å¤§å—è¿›è¡Œã€‚å› ä¸ºæœºå™¨èµ„æºæ•°é‡æœ‰é™ï¼Œæ²¡æœ‰å°†æ‰€æœ‰éƒ¨åˆ†éƒ½å•ç‹¬éƒ¨ç½²&lt;/p&gt;

&lt;p&gt;è§„åˆ™ç®¡ç†ç³»ç»Ÿä»¥åŠè§„åˆ™é˜Ÿåˆ—ç”Ÿæˆå™¨å’ŒæŒç»­å¤„ç†å™¨æ•´åˆéƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šï¼ŒPhantomJS æœåŠ¡éƒ¨ç½²åœ¨äº†å…¶ä»–çš„æœºå™¨ä¸Šã€‚è¿›ç¨‹ç®¡ç†ä½¿ç”¨äº†è‘—åçš„ NPM æ¨¡å— â€”â€” PM2&lt;/p&gt;

&lt;p&gt;PM2 æ˜¯ä¸€ä¸ªå¸¦æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½çš„ NodeJS åº”ç”¨çš„è¿›ç¨‹ç®¡ç†å™¨ã€‚å¯å……åˆ†åˆ©ç”¨ CPUï¼Œå¹¶ä¿è¯è¿›ç¨‹ç¨³å®šå­˜æ´»&lt;/p&gt;

&lt;p&gt;PM2 ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å†…å»ºè´Ÿè½½å‡è¡¡ï¼ˆä½¿ç”¨ Node cluster é›†ç¾¤æ¨¡å—ï¼‰&lt;/li&gt;
&lt;li&gt;æ— ç¼é‡å¯ç±»ä¼¼ nginx reload&lt;/li&gt;
&lt;li&gt;å…·æœ‰ Ubuntu å’Œ CentOS çš„å¼€æœºå¯åŠ¨è„šæœ¬&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å°æ£€æµ‹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸è¿‡åœ¨ç›®å‰éƒ¨ç½²ä»»åŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨å†…å»ºè´Ÿè½½å‡è¡¡çš„ç‰¹æ€§ï¼Œæ²¡ç”¨é€šè¿‡é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²ä»£ç†ã€‚ä»…ä½¿ç”¨äº†åå°è¿è¡Œå’Œæ— ç¼é‡å¯çš„ç‰¹æ€§&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“ä¸å±•æœ›&#34;&gt;æ€»ç»“ä¸å±•æœ›&lt;/h2&gt;

&lt;p&gt;å…¶å®æˆ‘ä»¬ç°åœ¨å¼€å‘çš„è¿™å¥—ç›‘æ§ç³»ç»Ÿå¹¶ä¸å¤æ‚ï¼Œåªæ˜¯åˆç†çš„è¿ç”¨äº†ä¸€äº›ç°æœ‰çš„æŠ€æœ¯æ¡†æ¶ã€‚æŠ½è±¡å‡ºæ¥æˆ‘ä»¬è‡ªå·±éœ€è¦çš„ä¸€äº›åŠŸèƒ½ã€‚ä½†å´æœ‰æ•ˆçš„è¾¾åˆ°äº†æˆ‘ä»¬çš„é¢„æœŸåŠŸèƒ½ï¼Œå¹¶ä¸”èŠ‚çœäº†å¾ˆå¤šä¹‹å‰éœ€è¦äººè‚‰æµ‹è¯•çš„æ—¶é—´æˆæœ¬ã€‚ç³»ç»Ÿæœ¬èº«è¿˜æœ‰å¾ˆå¤šé—®é¢˜åœ¨å¾…è§£å†³çŠ¶æ€ï¼Œæ¯”å¦‚æŠ¥è­¦ç³»ç»Ÿçš„è§„åˆ™å¤„ç†ä¸é˜€å€¼è®¾å®šï¼ŒJavaScript æŠ¥é”™çš„å‡†ç¡®è¿‡æ»¤æœºåˆ¶ç­‰ï¼Œè¿™äº›é—®é¢˜æˆ‘ä»¬éƒ½ä¼šé€ä¸ªè§£å†³ï¼Œå¹¶ä¸”æœªæ¥çš„å‰ç«¯ç›‘æ§ç³»ç»Ÿä¼šæˆä¸ºä¸€ä¸ªå¹³å°ï¼Œæ ¸å¿ƒæœåŠ¡åœ¨åç«¯çˆ¬å–é¡µé¢æœåŠ¡ï¼Œåº”ç”¨ç«¯å¯ä»¥æœ‰å¤šç§å½¢å¼ï¼Œæ¯”å¦‚ç›‘æ§ã€æµ‹è¯•å·¥å…·ç­‰&lt;/p&gt;

&lt;p&gt;ä¸€äº›å¯ä»¥æŒç»­ä¼˜åŒ–ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç›‘æ§ç³»ç»Ÿè™½ç„¶åœ¨åº”ç”¨å±‚é¢è¿›è¡Œäº†å‚ç›´åˆ’åˆ†ï¼Œä½†æ˜¯ç”±äºæœºå™¨èµ„æºç­‰é™åˆ¶ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå•ç‹¬åŠŸèƒ½çš„éƒ¨ç½²ã€‚è¿™ç‚¹å¯èƒ½ä¼šåœ¨åæœŸçš„ä½¿ç”¨ä¸­è¿›è¡Œä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;PhantomJS æœåŠ¡è¿˜éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä»¥æ‰¿è½½å¤§å¹¶å‘ï¼Œå¤§å¤„ç†é‡ã€‚æä¾›ç¨³å®šçš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;æŠ¥è­¦ç”±äºä¾èµ–äºå…¬å¸å†…éƒ¨çš„ UMP ç³»ç»Ÿï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ç‰¹åˆ«çµæ´»ï¼ŒåæœŸå¯ä»¥è€ƒè™‘è‡ªå·±å®ç°ä¸€å¥—æŠ¥è­¦æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>JavaScript æµè§ˆå™¨äº‹ä»¶</title>
      <link>https://keelii.com/2016/09/29/javascript-browser-event/</link>
      <pubDate>Thu, 29 Sep 2016 17:22:29 +0800</pubDate>
      
      <guid>https://keelii.com/2016/09/29/javascript-browser-event/</guid>
      <description>&lt;h2 id=&#34;javascript-æµè§ˆå™¨-äº‹ä»¶ä¹‹é—´çš„å…³ç³»&#34;&gt;JavaScriptã€æµè§ˆå™¨ã€äº‹ä»¶ä¹‹é—´çš„å…³ç³»&lt;/h2&gt;

&lt;p&gt;JavaScript ç¨‹åºé‡‡ç”¨äº†å¼‚æ­¥äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼ˆEvent-driven programmingï¼‰æ¨¡å‹ï¼Œç»´åŸºç™¾ç§‘å¯¹å®ƒçš„è§£é‡Šæ˜¯ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;äº‹ä»¶é©±åŠ¨ç¨‹åºè®¾è®¡ï¼ˆè‹±è¯­ï¼šEvent-driven programmingï¼‰æ˜¯ä¸€ç§ç”µè„‘ç¨‹åºè®¾è®¡æ¨¡å‹ã€‚è¿™ç§æ¨¡å‹çš„ç¨‹åºè¿è¡Œæµç¨‹æ˜¯ç”±ç”¨æˆ·çš„åŠ¨ä½œï¼ˆå¦‚é¼ æ ‡çš„æŒ‰é”®ï¼Œé”®ç›˜çš„æŒ‰é”®åŠ¨ä½œï¼‰æˆ–è€…æ˜¯ç”±å…¶ä»–ç¨‹åºçš„æ¶ˆæ¯æ¥å†³å®šçš„ã€‚ç›¸å¯¹äºæ‰¹å¤„ç†ç¨‹åºè®¾è®¡ï¼ˆbatch programmingï¼‰è€Œè¨€ï¼Œç¨‹åºè¿è¡Œçš„æµç¨‹æ˜¯ç”±ç¨‹åºå‘˜æ¥å†³å®šã€‚æ‰¹é‡çš„ç¨‹åºè®¾è®¡åœ¨åˆçº§ç¨‹åºè®¾è®¡æ•™å­¦è¯¾ç¨‹ä¸Šæ˜¯ä¸€ç§æ–¹å¼ã€‚ç„¶è€Œï¼Œäº‹ä»¶é©±åŠ¨ç¨‹åºè®¾è®¡è¿™ç§è®¾è®¡æ¨¡å‹æ˜¯åœ¨äº¤äº’ç¨‹åºï¼ˆInteractive programï¼‰çš„æƒ…å†µä¸‹å­•è‚²è€Œç”Ÿçš„&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç®€é¡µè¨€ä¹‹ï¼Œåœ¨ web å‰ç«¯ç¼–ç¨‹é‡Œé¢ JavaScript é€šè¿‡æµè§ˆå™¨æä¾›çš„äº‹ä»¶æ¨¡å‹ API å’Œç”¨æˆ·äº¤äº’ï¼Œæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥&lt;/p&gt;

&lt;p&gt;ç”±äºç”¨æˆ·çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸çŸ¥é“ç”¨æˆ·ä»€ä¹ˆæ—¶å€™å‘ç”Ÿç‚¹å‡»ã€æ»šåŠ¨è¿™äº›åŠ¨ä½œã€‚è¿™ç§åœºæ™¯æ˜¯ä¼ ç»Ÿçš„åŒæ­¥ç¼–ç¨‹æ¨¡å‹æ²¡æ³•è§£å†³çš„ï¼Œå› ä¸ºä½ ä¸å¯èƒ½ç­‰ç”¨æˆ·æ“ä½œå®Œäº†æ‰æ‰§è¡Œåé¢çš„ä»£ç &lt;/p&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬åœ¨ Python é‡Œé¢è°ƒç”¨æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ–¹æ³• &lt;code&gt;raw_input()&lt;/code&gt; åç»ˆç«¯å°±ä¼šä¸€ç›´ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥ï¼Œç›´åˆ°è¾“å…¥å®Œæˆæ‰ä¼šæ‰§è¡Œåé¢çš„ä»£ç é€»è¾‘ã€‚ä½†æ˜¯åœ¨ä¸‹é¢è¿™æ®µ NodeJS ä»£ç ä¸­ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ–¹æ³• &lt;code&gt;process.stdin.read&lt;/code&gt; æ˜¯åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­è°ƒç”¨çš„ã€‚åé¢çš„ä»£ç ä¸ä¼šè¢«é˜»å¡ï¼ˆblockedï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&#39;use strict&#39;;

process.stdin.on(&#39;readable&#39;, () =&amp;gt; {
    var chunk = process.stdin.read();
    if (chunk !== null) {
        process.stdout.write(`Async output data: ${chunk}`);
    }
});

process.stdin.on(&#39;end&#39;, () =&amp;gt; {
    process.stdout.write(&#39;end&#39;);
});

console.log(&#39;Will not be blocked&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;äº‹ä»¶é©±åŠ¨ç¨‹åºæ¨¡å‹åŸºæœ¬çš„å®ç°åŸç†åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨ &lt;a href=&#34;https://www.youtube.com/watch?v=8aGhZQkoFbQ&#34;&gt;äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰&lt;/a&gt;ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ¶‰åŠæµè§ˆå™¨äº‹ä»¶æ¨¡å‹ã€å›è°ƒåŸç†ï¼Œæœ‰å…´è¶£çš„å»çœ‹é“¾æ¥é‡Œé¢çš„è§†é¢‘å­¦ä¹ ä¸‹&lt;/p&gt;

&lt;p&gt;éœ€è¦è¯´æ˜çš„æ˜¯åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­åƒ setTimeout, XMLHTTPRequest è¿™ç±» API &lt;strong&gt;å¹¶ä¸æ˜¯&lt;/strong&gt; JavaScript è¯­è¨€æœ¬èº«å°±æœ‰çš„ã€‚è€Œæ˜¯ JavaScript çš„å®¿ä¸»ç¯å¢ƒï¼ˆåœ¨å®¢æˆ·ç«¯ JavaScript ä¸­å°±æ˜¯æµè§ˆå™¨ï¼‰ï¼ŒåŒæ ·åƒ DOMã€BOMã€Event API éƒ½æ˜¯æµè§ˆå™¨æä¾›çš„&lt;/p&gt;

&lt;h2 id=&#34;äº‹ä»¶ç»‘å®šçš„æ–¹æ³•&#34;&gt;äº‹ä»¶ç»‘å®šçš„æ–¹æ³•&lt;/h2&gt;

&lt;h3 id=&#34;dom-å…ƒç´ è¡Œå†…ç»‘å®š&#34;&gt;DOM å…ƒç´ è¡Œå†…ç»‘å®š&lt;/h3&gt;

&lt;p&gt;ç›´æ¥åœ¨ DOM å…ƒç´ ä¸Šé€šè¿‡è®¾ç½® &lt;code&gt;on + eventType&lt;/code&gt; æ¥ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;a href=&amp;quot;#none&amp;quot; onclick=&amp;quot;alert(&#39;clicked.&#39;)&amp;quot;&amp;gt;ç‚¹å‡»æˆ‘&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ç§ç»‘å®šæ–¹æ³•æ˜¯æœ€åŸå§‹çš„ï¼Œæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1 äº‹ä»¶å¤„ç†ç¨‹åºå’Œ HTML ç»“æ„æ··æ‚åœ¨ä¸€èµ·&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ—©æœŸåœ¨ç»“æ„ã€æ ·å¼ã€è¡¨ç°åˆ†ç¦»çš„æ—¶ä»£å¾ˆå¿Œè®³è¿™ä¸€ç‚¹ã€‚ç°åœ¨çœ‹æ¥åœ¨å¾ˆå¤š MVX æ¡†æ¶ä¸­å°†äº‹ä»¶ç»‘å®šå’Œ DOM ç»“æ„æ”¾åœ¨ä¸€èµ·å¤„ç†ï¼Œè¿™æ ·ä¼¼ä¹æ›´æ–¹ä¾¿ç»´æŠ¤ï¼ˆä¸ç”¨æ¥å›åˆ‡æ¢ HTML,JavaScript æ–‡ä»¶ï¼‰ï¼Œè€Œä¸”ä¹Ÿç¬¦åˆå¯é¢„è§ï¼ˆpredictableï¼‰æ€§çš„è§„åˆ™&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2 å‘½åç©ºé—´å†²çª&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸º &lt;code&gt;onclick&lt;/code&gt; ä¸­çš„ JavaScript ä»£ç ç‰‡æ®µæ‰§è¡Œç¯å¢ƒæ˜¯å…¨å±€ä½œç”¨åŸŸã€‚ç„¶è€Œåœ¨ JavaScript è¯­è¨€ä¸­å¹¶æ²¡æœ‰ç›¸å…³çš„å‘½åç©ºé—´ç‰¹æ€§ã€‚æ‰€ä»¥å°±å¾ˆå®¹æ˜“é€ æˆå‘½åç©ºé—´çš„å†²çªï¼Œéè¦ç”¨è¿™ç§æ–¹æ³•ç»‘å®šäº‹ä»¶çš„è¯åªèƒ½ç”¨å¯¹è±¡æ¥åšä¸€äº›å°è£…&lt;/p&gt;

&lt;h3 id=&#34;å¤è€çš„ç»‘å®šæ–¹æ³•&#34;&gt;å¤è€çš„ç»‘å®šæ–¹æ³•&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ DOM Element ä¸Šé¢çš„ &lt;code&gt;on + eventType&lt;/code&gt; å±æ€§ API&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;a href=&amp;quot;#none&amp;quot; id=&amp;quot;button&amp;quot;&amp;gt;click me&amp;lt;/a&amp;gt;
&amp;lt;script&amp;gt;
    var el = getElementById(&#39;button&#39;);
    el.onclick = function() { alert(&#39;button clicked.&#39;) };
    el.onclick = function() { alert(&#39;button clicked (Rewrite event handler before).&#39;) };
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ç§æ–¹æ³•ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºå±æ€§èµ‹å€¼ä¼šè¦†ç›–åŸå€¼çš„ã€‚æ‰€ä»¥æ— æ³•ç»‘å®š &lt;strong&gt;å¤šä¸ª&lt;/strong&gt; äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬è¦æ³¨å†Œå¤šä¸ª onload äº‹ä»¶å¤„ç†ç¨‹åºçš„è¯å°±å¾—è‡ªå·±å°è£…ä¸€ä¸ªæ–¹æ³•æ¥é˜²æ­¢è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function addLoadEvent(fn) {
    var oldonLoad = window.onload;
    if (typeof oldonLoad !== &#39;function&#39;) {
        window.onload = fn;
    } else {
        window.onload = function() {
            oldonLoad();
            fn();
        }
    }
}

addLoadEvent(function() { alert(&#39;onload 1&#39;) });
addLoadEvent(function() { alert(&#39;onload 2&#39;) });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ³¨æ„è¿™åªæ˜¯ä¸ªç¤ºä¾‹ï¼Œç”Ÿäº§ç¯å¢ƒå¾ˆå°‘ä¼šç”¨åˆ°ã€‚ä¸€èˆ¬ç”¨ DOM Ready å°±å¯ä»¥äº†ï¼Œå› ä¸º JavaScript çš„æ‰§è¡Œé€šå¸¸ä¸ç”¨ç­‰åˆ°é¡µé¢èµ„æºå…¨éƒ¨åŠ è½½å®Œï¼ŒDOM åŠ è½½å®Œå°±å¯ä»¥äº†&lt;/p&gt;

&lt;h3 id=&#34;ç°ä»£-æ ‡å‡†çš„ç»‘å®šæ–¹æ³•&#34;&gt;ç°ä»£/æ ‡å‡†çš„ç»‘å®šæ–¹æ³•&lt;/h3&gt;

&lt;p&gt;æ ‡å‡†çš„ç»‘å®šæ–¹æ³•æœ‰ä¸¤ç§ï¼Œ&lt;code&gt;addEventListener&lt;/code&gt; å’Œ &lt;code&gt;attachEvent&lt;/code&gt; å‰è€…æ˜¯æ ‡å‡†æµè§ˆå™¨æ”¯æŒçš„ APIï¼Œåè€…æ˜¯ IE 8 ä»¥ä¸‹æµè§ˆå™¨æ”¯æŒçš„ APIã€‚é€šå¸¸éœ€è¦æˆ‘ä»¬åšä¸ªå…¼å®¹å°è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function addEvent(target, type, handler) {
    if (target.addEventListener) {
        target.addEventListener(type, handler, false);
    } else {
        target.attachEvent(&#39;on&#39; + type, handler)
    }
}

addEvent(document, &#39;click&#39;, function() { alert(this === document) });
addEvent(document, &#39;click&#39;, function() { alert(this === document) });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä¾‹å­åœ¨ IE 8 ä»¥ä¸‹å’Œæ ‡å‡†æµè§ˆå™¨çš„æ•ˆæœæ˜¯ä¸ä¸€æ ·çš„ï¼Œé—®é¢˜å°±åœ¨äº &lt;code&gt;addEventListener&lt;/code&gt; ä¸­çš„äº‹ä»¶å›è°ƒå‡½æ•°ä¸­çš„ this æŒ‡å‘å…ƒç´ ï¼ˆtargetï¼‰æœ¬èº«ï¼Œè€Œ &lt;code&gt;attachEvent&lt;/code&gt; åˆ™æŒ‡å‘ &lt;code&gt;window&lt;/code&gt; ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ä¸Šé¢çš„ attachEvent å¯ä»¥åšä¸€ç‚¹å°è°ƒæ•´è®©å…¶ä¿æŒå’Œ &lt;code&gt;addEventListener&lt;/code&gt; çš„æ•ˆæœä¸€æ ·ï¼Œä¸è¿‡è¿™æ ·çš„è¯æ³¨å†Œçš„ handler å°±æ˜¯ä¸ªåŒ¿åå‡½æ•°ï¼Œ&lt;strong&gt;æ— æ³•ç§»é™¤&lt;/strong&gt;ï¼&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function addEvent(target, type, handler) {
    if (target.addEventListener) {
        target.addEventListener(type, handler, false);
    } else {
        target.attachEvent(&#39;on&#39; + type, function() {
            return handler.call(target)
        });
    }
}

addEvent(document, &#39;click&#39;, function() { alert(this === document) });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ä¸Šé¢è¿™å‡ ç§æƒ…å†µåŒæ—¶å‡ºç°çš„æ—¶å€™å°±æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œå¯ä»¥è¯•è¯•ä¸‹é¢è¿™æ®µä»£ç çš„ä½ è¾“å‡º&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;a href=&amp;quot;javascript:alert(1)&amp;quot; onclick=&amp;quot;alert(2)&amp;quot; id=&amp;quot;link&amp;quot;&amp;gt;click me&amp;lt;/a&amp;gt;
&amp;lt;script&amp;gt;
    var link = document.getElementById(&#39;link&#39;);
    link.onclick = function() { alert(3); }

    $(&#39;#link&#39;).bind(&#39;click&#39;, function() { alert(4); });
    $(&#39;#link&#39;).bind(&#39;click&#39;, function() { alert(5); });
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­£ç¡®çš„ç»“æœåº”è¯¥æ˜¯ &lt;code&gt;3,4,5,1&lt;/code&gt;ï¼Œæ ¹æ®ç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é“¾æ¥ä¸Šçš„ href ä¼ª javascript åè®®ç›¸å½“äºåœ¨æµè§ˆå™¨åœ°å€æ æ‰§è¡Œäº†ä¸€æ®µ JavaScript ä»£ç ï¼Œé“¾æ¥å¦‚æœæ˜¯è¿™ç§æ ¼å¼ï¼Œç‚¹å‡»çš„æ—¶å€™ç›¸å½“äºæ‰§è¡Œäº†è¿™æ®µ JavaScript è„šæœ¬&lt;/li&gt;
&lt;li&gt;è¡Œå†…çš„äº‹ä»¶ç»‘å®šå’Œå…ƒç´ è°ƒç”¨ onclick ç»‘å®šäº‹ä»¶ä¼šè¦†ç›–&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ jQueryï¼ˆå†…éƒ¨ä½¿ç”¨æ ‡å‡†äº‹ä»¶æ³¨å†Œ APIï¼‰å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åº&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;äº‹ä»¶å†’æ³¡&#34;&gt;äº‹ä»¶å†’æ³¡&lt;/h2&gt;

&lt;p&gt;å¤§éƒ¨åˆ†äº‹ä»¶ä¼šæ²¿ç€äº‹ä»¶è§¦å‘çš„ç›®æ ‡å…ƒç´ å¾€ä¸Šä¼ æ’­ã€‚æ¯”å¦‚ï¼š&lt;code&gt;body&amp;gt;div&amp;gt;p&amp;gt;span&lt;/code&gt; å¦‚æœä»–ä»¬éƒ½æ³¨å†Œäº†ç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨ span å…ƒç´ ä¸Šè§¦å‘ç‚¹å‡»äº‹ä»¶å p,div,body å„è‡ªçš„ç‚¹å‡»äº‹ä»¶ä¹Ÿä¼šæŒ‰é¡ºåºè§¦å‘&lt;/p&gt;

&lt;p&gt;äº‹ä»¶å†’æ³¡æ˜¯å¯ä»¥è¢«åœæ­¢çš„ï¼Œä¸‹é¢è¿™ä¸ªå‡½æ•°å°é—­äº†åœæ­¢äº‹ä»¶å†’æ³¡çš„æ–¹æ³•ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function stopPropagation(event) {
    event = event || window.event;
    if (event.stopPropagation) {
        event.stopPropagation()
    } else {// IE
        event.cancelBubble = true
    }
}

addEvent(&#39;ele&#39;, &#39;click&#39;, function(e) {
    // click handler
    stopPropagation(e);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;äº‹ä»¶å¯¹è±¡&#34;&gt;äº‹ä»¶å¯¹è±¡&lt;/h2&gt;

&lt;p&gt;æ ‡å‡†æµè§ˆå™¨ä¸­åœ¨äº‹ä»¶å¤„ç†ç¨‹åºè¢«è°ƒç”¨æ—¶ &lt;strong&gt;äº‹ä»¶å¯¹è±¡&lt;/strong&gt; ä¼šé€šè¿‡å‚æ•°ä¼ é€’ç»™å¤„ç†ç¨‹åºï¼ŒIE 8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸­äº‹ä»¶å¯¹è±¡å¯ä»¥é€šè¿‡å…¨å±€çš„ &lt;code&gt;window.event&lt;/code&gt; æ¥è®¿é—®ã€‚æ¯”å¦‚æˆ‘ä»¬è¦è·å–å½“å‰ç‚¹å‡»çš„ DOM Element&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;addEvent(document, &#39;click&#39;, function(event) {
    // IE 8 ä»¥ä¸‹ =&amp;gt; undefined
    console.log(event);
});
addEvent(document, &#39;click&#39;, function(event) {
    event = event || window.event;
    // æ ‡å‡†æµè§ˆå™¨ =&amp;gt; [object HTMLHtmlElement]
    // IE 8 ä»¥ä¸‹ =&amp;gt; undefined
    console.log(event.target);
    var target = event.target || event.srcElement;

    console.log(target.tagName);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;äº‹ä»¶ä»£ç†&#34;&gt;äº‹ä»¶ä»£ç†&lt;/h2&gt;

&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç»™ &lt;strong&gt;ä¸å­˜åœ¨çš„&lt;/strong&gt;ï¼ˆå¯èƒ½å°†æ¥ä¼šæœ‰ï¼‰çš„ä¸€æ®µ DOM å…ƒç´ ç»‘å®šäº‹ä»¶ï¼Œæ¯”å¦‚ç»™ä¸€æ®µ Ajax è¯·æ±‚å®Œæˆåæ¸²æŸ“çš„ DOM èŠ‚ç‚¹ç»‘å®šäº‹ä»¶ã€‚ä¸€èˆ¬ç»‘å®šçš„é€»è¾‘ä¼šåœ¨æ¸²æŸ“å‰æ‰§è¡Œï¼Œç»‘å®šçš„æ—¶å€™æ‰¾ä¸åˆ°å…ƒç´ æ‰€ä»¥å¹¶ä¸èƒ½æˆåŠŸï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠç»‘å®šäº‹ä»¶çš„ä»£ç æ”¾åœ¨ Ajax è¯·æ±‚ä¹‹åã€‚è¿™æ ·åšåœ¨ä¸€äº›äº‹ä»¶é€»è¾‘ç®€å•çš„åº”ç”¨é‡Œé¢æ²¡é—®é¢˜ï¼Œä½†æ˜¯ä¼šåŠ é‡æ•°æ®æ¸²æŸ“é€»è¾‘å’Œäº‹ä»¶å¤„ç†çš„é€»è¾‘è€¦åˆã€‚ä¸€ä½†äº‹ä»¶å¤„ç†ç¨‹åºç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸å»ºè®®æŠŠäº‹ä»¶çš„é€»è¾‘å’Œå…¶å®ƒä»£ç é€»è¾‘åˆ†ç¦»ï¼Œè¿™æ ·æ–¹ä¾¿ç»´æŠ¤ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨äº‹ä»¶ä»£ç†/å§”æ‰˜ï¼ˆEvent Delegation ï¼‰ã€‚è€Œä¸”é€šå¸¸æ¥è¯´ä½¿ç”¨ &lt;strong&gt;äº‹ä»¶ä»£ç†çš„æ€§èƒ½ä¼šæ¯”å•ç‹¬ç»‘å®šäº‹ä»¶é«˜&lt;/strong&gt; å¾ˆå¤šï¼Œæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;ul id=&amp;quot;list&amp;quot;&amp;gt;
    &amp;lt;li id=&amp;quot;item-1&amp;quot;&amp;gt;item1&amp;lt;/li&amp;gt;
    &amp;lt;li id=&amp;quot;item-2&amp;quot;&amp;gt;item2&amp;lt;/li&amp;gt;
    &amp;lt;li id=&amp;quot;item-3&amp;quot;&amp;gt;item3&amp;lt;/li&amp;gt;
    &amp;lt;li id=&amp;quot;item-4&amp;quot;&amp;gt;item4&amp;lt;/li&amp;gt;
    &amp;lt;li id=&amp;quot;item-5&amp;quot;&amp;gt;item5&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‡å¦‚ &lt;code&gt;ul&lt;/code&gt; ä¸­çš„ HTML æ˜¯ Ajax å¼‚æ­¥æ’å…¥çš„ï¼Œé€šå¸¸æˆ‘ä»¬çš„åšæ³•æ˜¯ æ’å…¥å®Œæˆåéå†æ¯ä¸ª li ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;ul id=&amp;quot;list&amp;quot;&amp;gt;&amp;lt;/ul&amp;gt;
&amp;lt;script&amp;gt;
    function bindEvent(el, n) {
        addEvent(lis[i], &#39;click&#39;, function() { console.log(i); });
    }
    // ç”¨ setTimeout æ¨¡æ‹Ÿ Ajax ä¼ªä»£ç 
    setTimeout(function() {
        var ajaxData = &#39;&amp;lt;li id=&amp;quot;item-1&amp;quot;&amp;gt;item1&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-2&amp;quot;&amp;gt;item2&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-3&amp;quot;&amp;gt;item3&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-4&amp;quot;&amp;gt;item4&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-5&amp;quot;&amp;gt;item5&amp;lt;/li&amp;gt;&#39;;
        var ul = document.getElementById(&#39;list&#39;)
        ul.innerHTML(ajaxData);
        var lis = ul.getElementsByTagName(&#39;li&#39;);

        for (var i = 0; i &amp;lt; lis.length; i++) {
            bindEvent(lis[i], i);
        }
    }, 1000);
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å†ä½¿ç”¨äº‹ä»¶ä»£ç†æŠŠäº‹ä»¶ç»‘å®šåˆ° &lt;code&gt;ul&lt;/code&gt; å…ƒç´ ä¸Šï¼Œæˆ‘ä»¬çŸ¥é“å¾ˆå¤šäº‹ä»¶å¯ä»¥å†’å¹¶æ²¿ç€ DOM æ ‘ä¼ æ’­åˆ°æ‰€æœ‰çš„çˆ¶å…ƒç´ ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ç›®æ ‡å…ƒç´ æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³ç»‘å®šçš„çœŸæ­£å…ƒç´ å³å¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;ul id=&amp;quot;list&amp;quot;&amp;gt;&amp;lt;/ul&amp;gt;
&amp;lt;script&amp;gt;
function delegateEvent(el, eventType, fn) {
    addEvent(el, eventType, function(event) {
        event = event || window.event;
        var target = event.target || event.srcElement;
        fn(target);
    });
}

var el = document.getElementById(&#39;list&#39;);
// ç”¨ setTimeout æ¨¡æ‹Ÿ Ajax ä¼ªä»£ç 
setTimeout(function() {
    var ajaxData = &#39;&amp;lt;li id=&amp;quot;item-1&amp;quot;&amp;gt;item1&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-2&amp;quot;&amp;gt;item2&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-3&amp;quot;&amp;gt;item3&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-4&amp;quot;&amp;gt;item4&amp;lt;/li&amp;gt; &amp;lt;li id=&amp;quot;item-5&amp;quot;&amp;gt;item5&amp;lt;/li&amp;gt;&#39;;
    el.innerHTML(ajaxData)
}, 1000);

delegateEvent(el, &#39;click&#39;, function(target) {
    console.log(target.id);
});
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ˜¾ç„¶ä½¿ç”¨äº†äº‹ä»¶ä»£ç†ä¹‹åï¼Œä»£ç å˜å°‘äº†ã€‚é€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå…³é”®æ˜¯ä»¥å‰éœ€è¦ N æ¬¡çš„ç»‘å®šæ“ä½œç°åœ¨åªéœ€è¦ä¸€æ¬¡&lt;/p&gt;

&lt;h2 id=&#34;jquery-ä¸­çš„äº‹ä»¶ç»‘å®š&#34;&gt;jQuery ä¸­çš„äº‹ä»¶ç»‘å®š&lt;/h2&gt;

&lt;p&gt;ä»¥ jQuery1.6.4 ä¸ºä¾‹ï¼ŒjQuery æä¾›äº†å¾ˆå¤šäº‹ä»¶ç»‘å®šçš„ APIã€‚ä¾‹å¦‚ï¼š &lt;code&gt;delegate()&lt;/code&gt;, &lt;code&gt;bind()&lt;/code&gt;, &lt;code&gt;click()&lt;/code&gt;, &lt;code&gt;hover()&lt;/code&gt;, &lt;code&gt;one()&lt;/code&gt;, &lt;code&gt;live()&lt;/code&gt;ï¼Œè¿™äº›æ–¹æ³•å…¶å®éƒ½æ˜¯ä¸€äº›åˆ«åï¼Œæ ¸å¿ƒæ˜¯è°ƒç”¨äº† jQuery åº•å±‚äº‹ä»¶çš„ &lt;code&gt;jQuery.event.add&lt;/code&gt; æ–¹æ³•ã€‚å…¶å®ç°ä¹Ÿæ˜¯ä¸Šæ–‡æåˆ°çš„ &lt;code&gt;addEventListener&lt;/code&gt; å’Œ &lt;code&gt;attachEvent&lt;/code&gt; ä¸¤ä¸ª API&lt;/p&gt;

&lt;p&gt;è¿™äº› API ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ç»‘å®šäº‹ä»¶çš„å„ç§åœºæ™¯ï¼Œå¹¶ä¸”å†…éƒ¨å¤„ç†å¥½äº†å…¼å®¹æ€§é—®é¢˜ã€‚è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½ç”¨çš„åœ°æ–¹å°±æ˜¯ &lt;code&gt;äº‹ä»¶å‘½åç©ºé—´&lt;/code&gt;ã€‚æ¯”å¦‚ï¼šä¸¤ä¸ªå¼¹å‡ºå±‚éƒ½å‘ document ç»‘å®šäº†ç‚¹å‡»å…³é—­äº‹ä»¶ï¼Œä½†æ˜¯å¦‚æœåªæƒ³è§£ç»‘å…¶ä¸­ä¸€ä¸ªã€‚è¿™æ—¶å€™ä½¿ç”¨å‘½åç©ºé—´å†åˆé€‚ä¸è¿‡äº†ã€‚å¯ä»¥è¯•è¯•è¿™ä¸ªå°ä¾‹å­ &lt;a href=&#34;http://jsbin.com/sacinereju/edit?html,output&#34;&gt;Event Binding&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;$(document).bind(&#39;click.handler1&#39;, function() { console.log(1);})
$(document).bind(&#39;click.handler2&#39;, function() { console.log(2);})

$(document).unbind(&#39;click.handler2&#39;);   // è§£é™¤æŒ‡å®šçš„
$(document).unbind(&#39;click&#39;);            // è§£é™¤æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
$(document).unbind()                    // è§£é™¤æ‰€æœ‰äº‹ä»¶
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;è‡ªå®šä¹‰äº‹ä»¶ä¸å‘å¸ƒ-è®¢é˜…è€…è®¾è®¡æ¨¡å¼&#34;&gt;è‡ªå®šä¹‰äº‹ä»¶ä¸å‘å¸ƒ/è®¢é˜…è€…è®¾è®¡æ¨¡å¼&lt;/h2&gt;

&lt;p&gt;è‡ªå®šä¹‰äº‹ä»¶æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„ &lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85&#34;&gt;å‘å¸ƒ/è®¢é˜…è€…&lt;/a&gt; çš„ä¸€ç§å®ç°ã€‚å‘å¸ƒè€…ä¸è®¢é˜…è€…æ¾æ•£åœ°è€¦åˆï¼Œè€Œä¸”ä¸éœ€è¦å…³å¿ƒå¯¹æ–¹çš„å­˜åœ¨ã€‚&lt;a href=&#34;https://www.nczonline.net/blog/2010/03/09/custom-events-in-javascript/&#34;&gt;è¿™é‡Œ&lt;/a&gt;æœ‰ NC å¤§å¸ˆçš„ä¸€ç§å®ç°ã€‚å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸»è¦è¢«è¿ç”¨åœ¨å¼‚æ­¥æ“ä½œæ¯”è¾ƒå¤šçš„åœºæ™¯å’Œä¸åŒç³»ç»Ÿä¹‹é—´æ¶ˆæ¯é€šä¿¡ï¼Œä¹‹å‰çš„&lt;a href=&#34;https://keelii.com/2016/07/31/something-have-to-say-with-JD-item/#TOC-25&#34;&gt;æ–‡ç« &lt;/a&gt;ä¸­æœ‰è¿‡ä¸€äº›å®ä¾‹&lt;/p&gt;

&lt;h2 id=&#34;å¼•ç”¨&#34;&gt;å¼•ç”¨&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BA%8B%E4%BB%B6%E9%A9%85%E5%8B%95%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88&#34;&gt;äº‹ä»¶é©±åŠ¨ç¨‹åºè®¾è®¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.quirksmode.org/js/introevents.html&#34;&gt;Introduction to Events&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nczonline.net/blog/2010/03/09/custom-events-in-javascript/&#34;&gt;Custom events in JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
  </channel>
</rss>